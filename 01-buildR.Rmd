# Model setup with SWATBuildR

The OPTAIN project is using the COCOA approach @schürz2022 and as such, needs to use the `SWATBuildR` package to calculate the connectivity between HRUs in the catchment. This chapter covers this process.

We will define the location of our project here:

```{r}
project_path <- 'model_data/cs10_setup'
```

And give it the name:

```{r}
project_name <- 'optain-cs10'
```

Much of this documentation has been lost to time.

## High-Resolution Digital Elevation Model (DEM)

The high-resolution DEM is the basis for calculation of water connectivity, among other things. Most of the documentation of the creation of the DEM for CS10 has been lost to the sands of time. All we know is that it is located here:

```{r}
dem_path <- "model_data/input/elevation/dtm3_ns_v5.tif"
```

To our knowledge, it has a 10 meter resolution. 1 meter resolution was available but there seems to have been issues with using it. It is definitely preferable to use the 1m DEM as certain important information can be lost with (max allowed resolution) of 10m, see Figure \@ref(fig:dempic).

![#fig:dempic An example of a hydrologically effective landscape features being lost due to coarse DEM resolution. From[@schürz2022]](figures/1mdemvs10.png)

## Basin Boundary

The basin boundary has presumably been created using the defined outlet point of the catchment and the DEM. No more is currently known about this file other than that it is located here:

```{r}
bound_path <- "model_data/input/shape/cs10_basin.shp"
```

We will begin using the `SWATBuildR` Package by initializing its functions. (Note: this package is currently unfinished, which is why this step is necessary).

The following code is from version `1.5.12`, and written by Christoph Schuerz.

Another note: there are currently issues with White box which are being resolved.

```{r, message=FALSE}
source('model_data/swat_buildR/init.R')
```

First, we read in and check the basin boundary

```{r}
# Read and prepare input data --------------------------------------
## Basin boundary
bound <- read_sf(bound_path) %>% select()
set_proj_crs(bound, data_path)
check_polygon_topology(layer = bound, data_path =  data_path, label = 'basin', 
                       n_feat = 1, checks = c(F,T,T,T,F,F,F,F))
```
