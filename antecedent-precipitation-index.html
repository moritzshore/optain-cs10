<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 9 Antecedent Precipitation Index | OPTAIN CS-10</title>
  <meta name="description" content="A description of the project setup for OPTAIN case study 10" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 9 Antecedent Precipitation Index | OPTAIN CS-10" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://moritzshore.github.io/optain-cs10/figures/banner.png" />
  <meta property="og:description" content="A description of the project setup for OPTAIN case study 10" />
  <meta name="github-repo" content="moritzshore/optain-cs10" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 9 Antecedent Precipitation Index | OPTAIN CS-10" />
  
  <meta name="twitter:description" content="A description of the project setup for OPTAIN case study 10" />
  <meta name="twitter:image" content="https://moritzshore.github.io/optain-cs10/figures/banner.png" />

<meta name="author" content="Moritz Shore, Csilla Farkas" />


<meta name="date" content="2023-06-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="field-site-properties.html"/>
<link rel="next" href="model-parameterization.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.28/datatables.js"></script>
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.2/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script src="libs/plotly-binding-4.10.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
<link href="libs/dt-ext-scroller-1.13.4/css/scroller.dataTables.min.css" rel="stylesheet" />
<script src="libs/dt-ext-scroller-1.13.4/js/dataTables.scroller.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The OPTAIN-CS10 Project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="input-data-preparation.html"><a href="input-data-preparation.html"><i class="fa fa-check"></i><b>1</b> Input Data Preparation</a>
<ul>
<li class="chapter" data-level="1.1" data-path="input-data-preparation.html"><a href="input-data-preparation.html#digital-elevation-model"><i class="fa fa-check"></i><b>1.1</b> Digital Elevation Model</a></li>
<li class="chapter" data-level="1.2" data-path="input-data-preparation.html"><a href="input-data-preparation.html#soil-data"><i class="fa fa-check"></i><b>1.2</b> Soil Data</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="input-data-preparation.html"><a href="input-data-preparation.html#high-resolution-soil-maps"><i class="fa fa-check"></i><b>1.2.1</b> High resolution soil maps</a></li>
<li class="chapter" data-level="1.2.2" data-path="input-data-preparation.html"><a href="input-data-preparation.html#data-source"><i class="fa fa-check"></i><b>1.2.2</b> Data source</a></li>
<li class="chapter" data-level="1.2.3" data-path="input-data-preparation.html"><a href="input-data-preparation.html#combining-jordsmonn-and-loesmasser"><i class="fa fa-check"></i><b>1.2.3</b> Combining Jordsmonn and Loesmasser</a></li>
<li class="chapter" data-level="1.2.4" data-path="input-data-preparation.html"><a href="input-data-preparation.html#detailed-soil-map"><i class="fa fa-check"></i><b>1.2.4</b> Detailed Soil Map</a></li>
<li class="chapter" data-level="1.2.5" data-path="input-data-preparation.html"><a href="input-data-preparation.html#reclassification"><i class="fa fa-check"></i><b>1.2.5</b> Reclassification</a></li>
<li class="chapter" data-level="1.2.6" data-path="input-data-preparation.html"><a href="input-data-preparation.html#simplifying-geometries"><i class="fa fa-check"></i><b>1.2.6</b> Simplifying Geometries</a></li>
<li class="chapter" data-level="1.2.7" data-path="input-data-preparation.html"><a href="input-data-preparation.html#lookup-table"><i class="fa fa-check"></i><b>1.2.7</b> Lookup table</a></li>
<li class="chapter" data-level="1.2.8" data-path="input-data-preparation.html"><a href="input-data-preparation.html#rasterization"><i class="fa fa-check"></i><b>1.2.8</b> Rasterization</a></li>
<li class="chapter" data-level="1.2.9" data-path="input-data-preparation.html"><a href="input-data-preparation.html#usersoil"><i class="fa fa-check"></i><b>1.2.9</b> Usersoil</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="input-data-preparation.html"><a href="input-data-preparation.html#watershed-boundary"><i class="fa fa-check"></i><b>1.3</b> Watershed Boundary</a></li>
<li class="chapter" data-level="1.4" data-path="input-data-preparation.html"><a href="input-data-preparation.html#land-object-input"><i class="fa fa-check"></i><b>1.4</b> Land object input</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="input-data-preparation.html"><a href="input-data-preparation.html#data-sources"><i class="fa fa-check"></i><b>1.4.1</b> Data sources</a></li>
<li class="chapter" data-level="1.4.2" data-path="input-data-preparation.html"><a href="input-data-preparation.html#delineation-of-land-objects"><i class="fa fa-check"></i><b>1.4.2</b> Delineation of land objects</a></li>
<li class="chapter" data-level="1.4.3" data-path="input-data-preparation.html"><a href="input-data-preparation.html#standing-water-bodies-and-the-landuse-type-watr"><i class="fa fa-check"></i><b>1.4.3</b> Standing water bodies and the landuse type = ‘watr’</a></li>
<li class="chapter" data-level="1.4.4" data-path="input-data-preparation.html"><a href="input-data-preparation.html#tile-drainage-option"><i class="fa fa-check"></i><b>1.4.4</b> Tile drainage option</a></li>
<li class="chapter" data-level="1.4.5" data-path="input-data-preparation.html"><a href="input-data-preparation.html#existing-and-potential-structures-to-retain-water-and-nutrients"><i class="fa fa-check"></i><b>1.4.5</b> Existing and potential structures to retain water and nutrients</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="input-data-preparation.html"><a href="input-data-preparation.html#channel-object-input"><i class="fa fa-check"></i><b>1.5</b> Channel object input</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="input-data-preparation.html"><a href="input-data-preparation.html#data-sources-and-data-processing"><i class="fa fa-check"></i><b>1.5.1</b> Data sources and data processing</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="input-data-preparation.html"><a href="input-data-preparation.html#point-sources-locations"><i class="fa fa-check"></i><b>1.6</b> Point sources locations</a></li>
<li class="chapter" data-level="1.7" data-path="input-data-preparation.html"><a href="input-data-preparation.html#aquifer-objects"><i class="fa fa-check"></i><b>1.7</b> Aquifer Objects</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html"><i class="fa fa-check"></i><b>2</b> Model setup with SWATBuildR</a>
<ul>
<li class="chapter" data-level="2.1" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#buildr-setup"><i class="fa fa-check"></i><b>2.1</b> BuildR Setup</a></li>
<li class="chapter" data-level="2.2" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#processing-input-data"><i class="fa fa-check"></i><b>2.2</b> Processing input data</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#high-resolution-digital-elevation-model-dem"><i class="fa fa-check"></i><b>2.2.1</b> High-Resolution Digital Elevation Model (DEM)</a></li>
<li class="chapter" data-level="2.2.2" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#processing-the-basin-boundary"><i class="fa fa-check"></i><b>2.2.2</b> Processing the Basin Boundary</a></li>
<li class="chapter" data-level="2.2.3" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#processing-the-land-layer"><i class="fa fa-check"></i><b>2.2.3</b> Processing the Land layer</a></li>
<li class="chapter" data-level="2.2.4" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#processing-the-channels"><i class="fa fa-check"></i><b>2.2.4</b> Processing the Channels</a></li>
<li class="chapter" data-level="2.2.5" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#processing-the-dem"><i class="fa fa-check"></i><b>2.2.5</b> Processing the DEM</a></li>
<li class="chapter" data-level="2.2.6" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#processing-soil-data"><i class="fa fa-check"></i><b>2.2.6</b> Processing soil data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#calculating-contiguous-object-connectivity"><i class="fa fa-check"></i><b>2.3</b> Calculating Contiguous Object Connectivity</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#calculating-land-unit-connectivity"><i class="fa fa-check"></i><b>2.3.1</b> Calculating land unit connectivity</a></li>
<li class="chapter" data-level="2.3.2" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#calculating-channelreservoir-connectivity"><i class="fa fa-check"></i><b>2.3.2</b> Calculating channel/reservoir connectivity</a></li>
<li class="chapter" data-level="2.3.3" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#checking-the-water-objects-for-infinite-loops"><i class="fa fa-check"></i><b>2.3.3</b> Checking the water objects for infinite loops</a></li>
<li class="chapter" data-level="2.3.4" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#terrain-properties"><i class="fa fa-check"></i><b>2.3.4</b> Terrain properties</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#generate-swat-input"><i class="fa fa-check"></i><b>2.4</b> Generate SWAT+ input</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#generate-land-object-swat-input-tables"><i class="fa fa-check"></i><b>2.4.1</b> Generate land object SWAT+ input tables</a></li>
<li class="chapter" data-level="2.4.2" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#generate-water-object-swat-input-tables"><i class="fa fa-check"></i><b>2.4.2</b> Generate water object SWAT+ input tables</a></li>
<li class="chapter" data-level="2.4.3" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#build-aquifer-input"><i class="fa fa-check"></i><b>2.4.3</b> Build aquifer input</a></li>
<li class="chapter" data-level="2.4.4" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#add-point-source-inputs"><i class="fa fa-check"></i><b>2.4.4</b> Add point source inputs</a></li>
<li class="chapter" data-level="2.4.5" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#create-swat-sqlite-database"><i class="fa fa-check"></i><b>2.4.5</b> Create SWAT+ sqlite database</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="climate-inputs-and-weather-generator.html"><a href="climate-inputs-and-weather-generator.html"><i class="fa fa-check"></i><b>3</b> Climate inputs and weather generator</a>
<ul>
<li class="chapter" data-level="3.1" data-path="climate-inputs-and-weather-generator.html"><a href="climate-inputs-and-weather-generator.html#preparation-and-loading-data"><i class="fa fa-check"></i><b>3.1</b> Preparation and loading data</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="climate-inputs-and-weather-generator.html"><a href="climate-inputs-and-weather-generator.html#required-packages"><i class="fa fa-check"></i><b>3.1.1</b> Required packages</a></li>
<li class="chapter" data-level="3.1.2" data-path="climate-inputs-and-weather-generator.html"><a href="climate-inputs-and-weather-generator.html#load-in-the-files-and-load-svatools-template"><i class="fa fa-check"></i><b>3.1.2</b> Load in the file(s) and load svatools template</a></li>
<li class="chapter" data-level="3.1.3" data-path="climate-inputs-and-weather-generator.html"><a href="climate-inputs-and-weather-generator.html#proof-the-station"><i class="fa fa-check"></i><b>3.1.3</b> Proof the station</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="climate-inputs-and-weather-generator.html"><a href="climate-inputs-and-weather-generator.html#creating-the-weather-generator"><i class="fa fa-check"></i><b>3.2</b> Creating the weather generator</a></li>
<li class="chapter" data-level="3.3" data-path="climate-inputs-and-weather-generator.html"><a href="climate-inputs-and-weather-generator.html#adding-weather-data-to-swat-project"><i class="fa fa-check"></i><b>3.3</b> Adding weather data to SWAT+ project</a></li>
<li class="chapter" data-level="3.4" data-path="climate-inputs-and-weather-generator.html"><a href="climate-inputs-and-weather-generator.html#adding-atmospheric-deposition"><i class="fa fa-check"></i><b>3.4</b> Adding Atmospheric deposition</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="writing-swat-input-files.html"><a href="writing-swat-input-files.html"><i class="fa fa-check"></i><b>4</b> Writing SWAT+ Input Files</a>
<ul>
<li class="chapter" data-level="4.1" data-path="writing-swat-input-files.html"><a href="writing-swat-input-files.html#loading-the-project-in-swat-editor"><i class="fa fa-check"></i><b>4.1</b> Loading the project in SWAT+ Editor</a></li>
<li class="chapter" data-level="4.2" data-path="writing-swat-input-files.html"><a href="writing-swat-input-files.html#swat-test-run"><i class="fa fa-check"></i><b>4.2</b> SWAT+ Test Run</a></li>
<li class="chapter" data-level="4.3" data-path="writing-swat-input-files.html"><a href="writing-swat-input-files.html#link-aquifers-and-channels-with-geomorphic-flow"><i class="fa fa-check"></i><b>4.3</b> Link aquifers and channels with geomorphic flow</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="crop-map-generation.html"><a href="crop-map-generation.html"><i class="fa fa-check"></i><b>5</b> Crop Map Generation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="crop-map-generation.html"><a href="crop-map-generation.html#calculating-field-area"><i class="fa fa-check"></i><b>5.1</b> Calculating Field Area</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="crop-map-generation.html"><a href="crop-map-generation.html#calculate-field-area-and-assign-ids"><i class="fa fa-check"></i><b>5.1.1</b> Calculate Field Area and Assign IDs</a></li>
<li class="chapter" data-level="5.1.2" data-path="crop-map-generation.html"><a href="crop-map-generation.html#calculate-field-area-and-assign-ids-1"><i class="fa fa-check"></i><b>5.1.2</b> Calculate Field area and assign IDs</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="crop-map-generation.html"><a href="crop-map-generation.html#generating-the-crop-rotation"><i class="fa fa-check"></i><b>5.2</b> Generating the Crop Rotation</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="crop-map-generation.html"><a href="crop-map-generation.html#tidy-up-the-source-data"><i class="fa fa-check"></i><b>5.2.1</b> Tidy up the source data:</a></li>
<li class="chapter" data-level="5.2.2" data-path="crop-map-generation.html"><a href="crop-map-generation.html#tidy-up-the-buildr-output"><i class="fa fa-check"></i><b>5.2.2</b> Tidy up the BuildR output</a></li>
<li class="chapter" data-level="5.2.3" data-path="crop-map-generation.html"><a href="crop-map-generation.html#field-classification"><i class="fa fa-check"></i><b>5.2.3</b> Field classification</a></li>
<li class="chapter" data-level="5.2.4" data-path="crop-map-generation.html"><a href="crop-map-generation.html#extrapolating-the-crop-rotation"><i class="fa fa-check"></i><b>5.2.4</b> Extrapolating the Crop Rotation</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="crop-map-generation.html"><a href="crop-map-generation.html#merging-crop-rotation-with-buildr-output"><i class="fa fa-check"></i><b>5.3</b> Merging crop rotation with BuildR output</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html"><i class="fa fa-check"></i><b>6</b> Landuse.lum update</a>
<ul>
<li class="chapter" data-level="6.1" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#data-preperation"><i class="fa fa-check"></i><b>6.1</b> Data preperation</a></li>
<li class="chapter" data-level="6.2" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#assigning-landuse-values"><i class="fa fa-check"></i><b>6.2</b> Assigning landuse values</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-cal_group"><i class="fa fa-check"></i><b>6.2.1</b> Setting <code>cal_group</code></a></li>
<li class="chapter" data-level="6.2.2" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-plnt_com"><i class="fa fa-check"></i><b>6.2.2</b> Setting <code>plnt_com</code></a></li>
<li class="chapter" data-level="6.2.3" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-mgt"><i class="fa fa-check"></i><b>6.2.3</b> Setting <code>mgt</code></a></li>
<li class="chapter" data-level="6.2.4" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-urb_ro"><i class="fa fa-check"></i><b>6.2.4</b> Setting <code>urb_ro</code></a></li>
<li class="chapter" data-level="6.2.5" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-urban"><i class="fa fa-check"></i><b>6.2.5</b> Setting <code>urban</code></a></li>
<li class="chapter" data-level="6.2.6" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-mannings-n-ovn"><i class="fa fa-check"></i><b>6.2.6</b> Setting Manning’s n (<code>ovn</code>)</a></li>
<li class="chapter" data-level="6.2.7" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-cn2"><i class="fa fa-check"></i><b>6.2.7</b> Setting <code>cn2</code>:</a></li>
<li class="chapter" data-level="6.2.8" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-cons_prac"><i class="fa fa-check"></i><b>6.2.8</b> Setting <code>cons_prac</code></a></li>
<li class="chapter" data-level="6.2.9" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-tile"><i class="fa fa-check"></i><b>6.2.9</b> Setting <code>tile</code></a></li>
<li class="chapter" data-level="6.2.10" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-sep"><i class="fa fa-check"></i><b>6.2.10</b> Setting <code>sep</code></a></li>
<li class="chapter" data-level="6.2.11" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-vfs"><i class="fa fa-check"></i><b>6.2.11</b> Setting <code>vfs</code></a></li>
<li class="chapter" data-level="6.2.12" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-grww"><i class="fa fa-check"></i><b>6.2.12</b> Setting <code>grww</code></a></li>
<li class="chapter" data-level="6.2.13" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-bmp"><i class="fa fa-check"></i><b>6.2.13</b> Setting <code>bmp</code></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#writing-changes"><i class="fa fa-check"></i><b>6.3</b> Writing Changes</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="field-site-loggers.html"><a href="field-site-loggers.html"><i class="fa fa-check"></i><b>7</b> Field Site Loggers</a>
<ul>
<li class="chapter" data-level="7.1" data-path="field-site-loggers.html"><a href="field-site-loggers.html#introduction-1"><i class="fa fa-check"></i><b>7.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="field-site-loggers.html"><a href="field-site-loggers.html#prerequisites"><i class="fa fa-check"></i><b>7.1.1</b> Prerequisites</a></li>
<li class="chapter" data-level="7.1.2" data-path="field-site-loggers.html"><a href="field-site-loggers.html#locations"><i class="fa fa-check"></i><b>7.1.2</b> Locations</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="field-site-loggers.html"><a href="field-site-loggers.html#data-processing"><i class="fa fa-check"></i><b>7.2</b> Data Processing</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="field-site-loggers.html"><a href="field-site-loggers.html#loading-data"><i class="fa fa-check"></i><b>7.2.1</b> Loading Data</a></li>
<li class="chapter" data-level="7.2.2" data-path="field-site-loggers.html"><a href="field-site-loggers.html#data-re-structuring"><i class="fa fa-check"></i><b>7.2.2</b> Data Re-structuring</a></li>
<li class="chapter" data-level="7.2.3" data-path="field-site-loggers.html"><a href="field-site-loggers.html#summarize-to-daily-means"><i class="fa fa-check"></i><b>7.2.3</b> Summarize to Daily Means</a></li>
<li class="chapter" data-level="7.2.4" data-path="field-site-loggers.html"><a href="field-site-loggers.html#including-air-temperature-and-precipitation-data"><i class="fa fa-check"></i><b>7.2.4</b> Including Air Temperature and Precipitation Data</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="field-site-loggers.html"><a href="field-site-loggers.html#data-quality-check"><i class="fa fa-check"></i><b>7.3</b> Data quality check</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="field-site-loggers.html"><a href="field-site-loggers.html#logger-600409-deep-rocky-sand"><i class="fa fa-check"></i><b>7.3.1</b> Logger 600409 “Deep Rocky Sand”</a></li>
<li class="chapter" data-level="7.3.2" data-path="field-site-loggers.html"><a href="field-site-loggers.html#logger-600410-tormods-farm"><i class="fa fa-check"></i><b>7.3.2</b> Logger 600410 “Tormods farm”</a></li>
<li class="chapter" data-level="7.3.3" data-path="field-site-loggers.html"><a href="field-site-loggers.html#logger-600411-john-ivar-lower-area"><i class="fa fa-check"></i><b>7.3.3</b> Logger 600411 “John Ivar Lower Area”</a></li>
<li class="chapter" data-level="7.3.4" data-path="field-site-loggers.html"><a href="field-site-loggers.html#logger-600413-john-ivar-behind-the-barn"><i class="fa fa-check"></i><b>7.3.4</b> Logger 600413 “John Ivar behind the barn”</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="field-site-loggers.html"><a href="field-site-loggers.html#data-cleanup"><i class="fa fa-check"></i><b>7.4</b> Data Cleanup</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="field-site-loggers.html"><a href="field-site-loggers.html#general-cleanup"><i class="fa fa-check"></i><b>7.4.1</b> General cleanup</a></li>
<li class="chapter" data-level="7.4.2" data-path="field-site-loggers.html"><a href="field-site-loggers.html#logger-specific-cleanup"><i class="fa fa-check"></i><b>7.4.2</b> Logger specific cleanup</a></li>
<li class="chapter" data-level="7.4.3" data-path="field-site-loggers.html"><a href="field-site-loggers.html#saving-the-cleaned-data"><i class="fa fa-check"></i><b>7.4.3</b> Saving the cleaned data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="field-site-properties.html"><a href="field-site-properties.html"><i class="fa fa-check"></i><b>8</b> Field Site Properties</a>
<ul>
<li class="chapter" data-level="8.1" data-path="field-site-properties.html"><a href="field-site-properties.html#determining-the-hsg-group-of-the-logger-sites"><i class="fa fa-check"></i><b>8.1</b> Determining the HSG group of the logger sites</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html"><i class="fa fa-check"></i><b>9</b> Antecedent Precipitation Index</a>
<ul>
<li class="chapter" data-level="9.1" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#introduction-2"><i class="fa fa-check"></i><b>9.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#pre-requirements"><i class="fa fa-check"></i><b>9.1.1</b> Pre-requirements</a></li>
<li class="chapter" data-level="9.1.2" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#setting-up-python-for-rrmarkdown"><i class="fa fa-check"></i><b>9.1.2</b> Setting up Python for R/Rmarkdown</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#antecedent-precipitation-index-1"><i class="fa fa-check"></i><b>9.2</b> Antecedent Precipitation Index</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#loading-data-1"><i class="fa fa-check"></i><b>9.2.1</b> Loading data</a></li>
<li class="chapter" data-level="9.2.2" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#calculating-the-total-water-content"><i class="fa fa-check"></i><b>9.2.2</b> Calculating the total water content</a></li>
<li class="chapter" data-level="9.2.3" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#defining-api-model"><i class="fa fa-check"></i><b>9.2.3</b> Defining API model</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#conclusions"><i class="fa fa-check"></i><b>9.3</b> Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="model-parameterization.html"><a href="model-parameterization.html"><i class="fa fa-check"></i><b>10</b> Model Parameterization</a>
<ul>
<li class="chapter" data-level="10.1" data-path="model-parameterization.html"><a href="model-parameterization.html#parameter-changes"><i class="fa fa-check"></i><b>10.1</b> Parameter Changes</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="model-parameterization.html"><a href="model-parameterization.html#channel-parameters-revised"><i class="fa fa-check"></i><b>10.1.1</b> Channel parameters revised</a></li>
<li class="chapter" data-level="10.1.2" data-path="model-parameterization.html"><a href="model-parameterization.html#crop-parameters-verified"><i class="fa fa-check"></i><b>10.1.2</b> Crop parameters verified</a></li>
<li class="chapter" data-level="10.1.3" data-path="model-parameterization.html"><a href="model-parameterization.html#soil-physical-parameters-in-final-form"><i class="fa fa-check"></i><b>10.1.3</b> Soil physical parameters in final form</a></li>
<li class="chapter" data-level="10.1.4" data-path="model-parameterization.html"><a href="model-parameterization.html#soil-chemical-parameters-in-final-form"><i class="fa fa-check"></i><b>10.1.4</b> Soil chemical parameters in final form</a></li>
<li class="chapter" data-level="10.1.5" data-path="model-parameterization.html"><a href="model-parameterization.html#impoundment-parameters-defined"><i class="fa fa-check"></i><b>10.1.5</b> Impoundment parameters defined</a></li>
<li class="chapter" data-level="10.1.6" data-path="model-parameterization.html"><a href="model-parameterization.html#water-diversions-defined"><i class="fa fa-check"></i><b>10.1.6</b> Water diversions defined</a></li>
<li class="chapter" data-level="10.1.7" data-path="model-parameterization.html"><a href="model-parameterization.html#point-sources-parameters-added"><i class="fa fa-check"></i><b>10.1.7</b> Point sources parameters added</a></li>
<li class="chapter" data-level="10.1.8" data-path="model-parameterization.html"><a href="model-parameterization.html#tile-drainage-parameters-defined"><i class="fa fa-check"></i><b>10.1.8</b> Tile drainage parameters defined</a></li>
<li class="chapter" data-level="10.1.9" data-path="model-parameterization.html"><a href="model-parameterization.html#atmospheric-deposition-defined"><i class="fa fa-check"></i><b>10.1.9</b> Atmospheric deposition defined</a></li>
<li class="chapter" data-level="10.1.10" data-path="model-parameterization.html"><a href="model-parameterization.html#additional-settings-verified"><i class="fa fa-check"></i><b>10.1.10</b> Additional settings verified</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="model-parameterization.html"><a href="model-parameterization.html#fixing-tiledrain"><i class="fa fa-check"></i><b>10.2</b> Fixing tiledrain</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="model-parameterization.html"><a href="model-parameterization.html#finding-the-problem-hrus"><i class="fa fa-check"></i><b>10.2.1</b> Finding the problem HRUs</a></li>
<li class="chapter" data-level="10.2.2" data-path="model-parameterization.html"><a href="model-parameterization.html#fixing-the-problem-hrus"><i class="fa fa-check"></i><b>10.2.2</b> Fixing the problem HRUs</a></li>
<li class="chapter" data-level="10.2.3" data-path="model-parameterization.html"><a href="model-parameterization.html#writing-modified-changes"><i class="fa fa-check"></i><b>10.2.3</b> Writing modified changes</a></li>
<li class="chapter" data-level="10.2.4" data-path="model-parameterization.html"><a href="model-parameterization.html#re-enabling-tiledrain"><i class="fa fa-check"></i><b>10.2.4</b> Re-enabling tiledrain</a></li>
<li class="chapter" data-level="10.2.5" data-path="model-parameterization.html"><a href="model-parameterization.html#testing-swat"><i class="fa fa-check"></i><b>10.2.5</b> Testing SWAT+</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="swatfarmr-management-schedules.html"><a href="swatfarmr-management-schedules.html"><i class="fa fa-check"></i><b>11</b> SWATFarmR Management Schedules</a>
<ul>
<li class="chapter" data-level="11.1" data-path="swatfarmr-management-schedules.html"><a href="swatfarmr-management-schedules.html#pre-processing-crop-rotation"><i class="fa fa-check"></i><b>11.1</b> Pre-processing crop rotation</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="swatfarmr-management-schedules.html"><a href="swatfarmr-management-schedules.html#input-files"><i class="fa fa-check"></i><b>11.1.1</b> Input files</a></li>
<li class="chapter" data-level="11.1.2" data-path="swatfarmr-management-schedules.html"><a href="swatfarmr-management-schedules.html#settings"><i class="fa fa-check"></i><b>11.1.2</b> Settings</a></li>
<li class="chapter" data-level="11.1.3" data-path="swatfarmr-management-schedules.html"><a href="swatfarmr-management-schedules.html#checks"><i class="fa fa-check"></i><b>11.1.3</b> Checks</a></li>
<li class="chapter" data-level="11.1.4" data-path="swatfarmr-management-schedules.html"><a href="swatfarmr-management-schedules.html#writing-input-data"><i class="fa fa-check"></i><b>11.1.4</b> Writing input data</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="swatfarmr-management-schedules.html"><a href="swatfarmr-management-schedules.html#initializing-farmr"><i class="fa fa-check"></i><b>11.2</b> Initializing FarmR</a></li>
<li class="chapter" data-level="11.3" data-path="swatfarmr-management-schedules.html"><a href="swatfarmr-management-schedules.html#calculating-antecedent-precipitation-index"><i class="fa fa-check"></i><b>11.3</b> Calculating Antecedent Precipitation Index</a></li>
<li class="chapter" data-level="11.4" data-path="swatfarmr-management-schedules.html"><a href="swatfarmr-management-schedules.html#scheduling-operations"><i class="fa fa-check"></i><b>11.4</b> Scheduling Operations</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="swatfarmr-management-schedules.html"><a href="swatfarmr-management-schedules.html#write-operations"><i class="fa fa-check"></i><b>11.4.1</b> Write Operations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="model-verification.html"><a href="model-verification.html"><i class="fa fa-check"></i><b>12</b> Model Verification</a>
<ul>
<li class="chapter" data-level="12.1" data-path="model-verification.html"><a href="model-verification.html#stage-1-analysis-of-simulated-climate-variables"><i class="fa fa-check"></i><b>12.1</b> Stage 1: Analysis of simulated climate variables</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="model-verification.html"><a href="model-verification.html#lapse-rate"><i class="fa fa-check"></i><b>12.1.1</b> Lapse rate</a></li>
<li class="chapter" data-level="12.1.2" data-path="model-verification.html"><a href="model-verification.html#climate-variables"><i class="fa fa-check"></i><b>12.1.2</b> Climate variables</a></li>
<li class="chapter" data-level="12.1.3" data-path="model-verification.html"><a href="model-verification.html#snowfall-and-snowmelt"><i class="fa fa-check"></i><b>12.1.3</b> Snowfall and Snowmelt</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="model-verification.html"><a href="model-verification.html#stage-2-simulation-of-management-operations"><i class="fa fa-check"></i><b>12.2</b> Stage 2: Simulation of management operations</a></li>
<li class="chapter" data-level="12.3" data-path="model-verification.html"><a href="model-verification.html#stage-3-analysis-of-unconstrained-plant-growth"><i class="fa fa-check"></i><b>12.3</b> Stage 3: Analysis of unconstrained plant growth</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">OPTAIN CS-10</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="antecedent-precipitation-index" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">Section 9</span> Antecedent Precipitation Index<a href="antecedent-precipitation-index.html#antecedent-precipitation-index" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction-2" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> Introduction<a href="antecedent-precipitation-index.html#introduction-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>SWATFarmR cannot account for operations based on values modeled by
SWAT+, such as soil moisture. This is because FarmR does not run the
model itself, and creates and pre-defines all the management schedules
based on measured climate data. This means we need to relate our
measured climate data to our soil moisture (Because soil moisture is an
important factor in planning agricultural operations). One method to do
this is called the Antecedent Precipitation Index. Which is what we will
creating for CS10 in this part.</p>
<p>As a heads up, this section requires Python!</p>
<div id="pre-requirements" class="section level3 hasAnchor" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> Pre-requirements<a href="antecedent-precipitation-index.html#pre-requirements" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Required R packages</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="antecedent-precipitation-index.html#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(readr)</span>
<span id="cb304-2"><a href="antecedent-precipitation-index.html#cb304-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(dplyr)</span>
<span id="cb304-3"><a href="antecedent-precipitation-index.html#cb304-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(hydroGOF)</span>
<span id="cb304-4"><a href="antecedent-precipitation-index.html#cb304-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate) <span class="co"># Required Python packages: &quot;pandas&quot;, &quot;numpy&quot;, &quot;scipy&quot;</span></span>
<span id="cb304-5"><a href="antecedent-precipitation-index.html#cb304-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-6"><a href="antecedent-precipitation-index.html#cb304-6" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;model_data/code/plot_api.R&quot;</span>)</span>
<span id="cb304-7"><a href="antecedent-precipitation-index.html#cb304-7" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;model_data/code/calc_api.R&quot;</span>)</span></code></pre></div>
</div>
<div id="setting-up-python-for-rrmarkdown" class="section level3 hasAnchor" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> Setting up Python for R/Rmarkdown<a href="antecedent-precipitation-index.html#setting-up-python-for-rrmarkdown" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A quick (non-evaluated) code block to show how a python environment can
be created for use in Rmarkdown/Reticulate on your local machine.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="antecedent-precipitation-index.html#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install miniconda </span></span>
<span id="cb305-2"><a href="antecedent-precipitation-index.html#cb305-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install_miniconda</span>() </span>
<span id="cb305-3"><a href="antecedent-precipitation-index.html#cb305-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-4"><a href="antecedent-precipitation-index.html#cb305-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create conda environment for your project</span></span>
<span id="cb305-5"><a href="antecedent-precipitation-index.html#cb305-5" aria-hidden="true" tabindex="-1"></a><span class="fu">conda_create</span>(<span class="st">&quot;cs10_env&quot;</span>, <span class="co"># environment name </span></span>
<span id="cb305-6"><a href="antecedent-precipitation-index.html#cb305-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">packages =</span> <span class="fu">c</span>(<span class="st">&quot;pandas&quot;</span>, <span class="st">&quot;numpy&quot;</span>, <span class="st">&quot;scipy&quot;</span>), <span class="co"># required packages</span></span>
<span id="cb305-7"><a href="antecedent-precipitation-index.html#cb305-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">conda =</span> <span class="st">&quot;auto&quot;</span>)</span>
<span id="cb305-8"><a href="antecedent-precipitation-index.html#cb305-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-9"><a href="antecedent-precipitation-index.html#cb305-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-10"><a href="antecedent-precipitation-index.html#cb305-10" aria-hidden="true" tabindex="-1"></a><span class="fu">conda_python</span>(<span class="st">&quot;cs10_env&quot;</span>) <span class="co"># returns the .exe python path for your environment</span></span>
<span id="cb305-11"><a href="antecedent-precipitation-index.html#cb305-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-12"><a href="antecedent-precipitation-index.html#cb305-12" aria-hidden="true" tabindex="-1"></a><span class="co"># you need to change your R environment path in this file</span></span>
<span id="cb305-13"><a href="antecedent-precipitation-index.html#cb305-13" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">edit_r_environ</span>()</span>
<span id="cb305-14"><a href="antecedent-precipitation-index.html#cb305-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-15"><a href="antecedent-precipitation-index.html#cb305-15" aria-hidden="true" tabindex="-1"></a><span class="co"># RETICULATE_PYTHON=&quot;YOUR ENVIRONMENT PATH/python.exe&quot;</span></span>
<span id="cb305-16"><a href="antecedent-precipitation-index.html#cb305-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-17"><a href="antecedent-precipitation-index.html#cb305-17" aria-hidden="true" tabindex="-1"></a><span class="co"># restart your R session.</span></span>
<span id="cb305-18"><a href="antecedent-precipitation-index.html#cb305-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-19"><a href="antecedent-precipitation-index.html#cb305-19" aria-hidden="true" tabindex="-1"></a><span class="fu">py_config</span>()</span>
<span id="cb305-20"><a href="antecedent-precipitation-index.html#cb305-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-21"><a href="antecedent-precipitation-index.html#cb305-21" aria-hidden="true" tabindex="-1"></a><span class="co"># If everything is right, you should get something like:</span></span>
<span id="cb305-22"><a href="antecedent-precipitation-index.html#cb305-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-23"><a href="antecedent-precipitation-index.html#cb305-23" aria-hidden="true" tabindex="-1"></a><span class="co"># python: YOUR ENVIRONMENT PATH/python.exe libpython: YOUR ENVIRONMENT</span></span>
<span id="cb305-24"><a href="antecedent-precipitation-index.html#cb305-24" aria-hidden="true" tabindex="-1"></a><span class="co"># PATH/python39.dll pythonhome: YOUR ENVIRONMENT PATH version: 3.9.7 (default,</span></span>
<span id="cb305-25"><a href="antecedent-precipitation-index.html#cb305-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Sep 16 2021, 16:59:28) [MSC v.1916 64 bit (AMD64)] Architecture: 64bit numpy:</span></span>
<span id="cb305-26"><a href="antecedent-precipitation-index.html#cb305-26" aria-hidden="true" tabindex="-1"></a><span class="co"># YOUR ENVIRONMENT PATH\lib\site-packages\numpy numpy_version: 1.21.2</span></span>
<span id="cb305-27"><a href="antecedent-precipitation-index.html#cb305-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-28"><a href="antecedent-precipitation-index.html#cb305-28" aria-hidden="true" tabindex="-1"></a><span class="co"># After this it should work :)</span></span></code></pre></div>
</div>
</div>
<div id="antecedent-precipitation-index-1" class="section level2 hasAnchor" number="9.2">
<h2><span class="header-section-number">9.2</span> Antecedent Precipitation Index<a href="antecedent-precipitation-index.html#antecedent-precipitation-index-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>From <span class="citation">(<a href="#ref-patrignani2020" role="doc-biblioref">Patrignani 2020</a>)</span></p>
<p>The API is a well-known, parsimonious, recursive model for predicting
soil moisture solely based on precipitation records. The API is commonly
implemented using daily precipitation records, but it is possible to
work at finer temporal scales (e.g. hourly) if both precipitation (model
input) and soil moisture (for validation purposes) are available. The
equation describing the simple version of the model is:</p>
<p><span class="math display">\[API_{t} = \alpha API_{t-1} + P_t\]</span><br />
<span class="math inline">\(API_t\)</span>: Soil water content at time <span class="math inline">\(t\)</span> (today)</p>
<p><span class="math inline">\(API_{t-1}\)</span>: Soil water content at time <span class="math inline">\(t-1\)</span> (yesterday)</p>
<p><span class="math inline">\(\alpha\)</span>: Loss coefficient. Range between 0 and 1</p>
<p><span class="math inline">\(P_t\)</span>: Precipitation at time <span class="math inline">\(t\)</span> (today)</p>
<div id="loading-data-1" class="section level3 hasAnchor" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> Loading data<a href="antecedent-precipitation-index.html#loading-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will load out data from the previous Section
<a href="field-site-loggers.html#saving-the-cleaned-data">7.4.3</a></p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="antecedent-precipitation-index.html#cb306-1" aria-hidden="true" tabindex="-1"></a>logger_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;model_data/field_sites/loggers/clean/logger_data_daily_clean.csv&quot;</span>,</span>
<span id="cb306-2"><a href="antecedent-precipitation-index.html#cb306-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">show_col_types=</span>F)</span>
<span id="cb306-3"><a href="antecedent-precipitation-index.html#cb306-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-4"><a href="antecedent-precipitation-index.html#cb306-4" aria-hidden="true" tabindex="-1"></a><span class="co"># we only need SMC for this part</span></span>
<span id="cb306-5"><a href="antecedent-precipitation-index.html#cb306-5" aria-hidden="true" tabindex="-1"></a>logger_data <span class="ot">=</span> logger_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(var <span class="sc">==</span> <span class="st">&quot;smc&quot;</span>)</span>
<span id="cb306-6"><a href="antecedent-precipitation-index.html#cb306-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-7"><a href="antecedent-precipitation-index.html#cb306-7" aria-hidden="true" tabindex="-1"></a>site_attributes <span class="ot">&lt;-</span></span>
<span id="cb306-8"><a href="antecedent-precipitation-index.html#cb306-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(<span class="st">&quot;model_data/field_sites/output/field_site_attr_df.csv&quot;</span>,</span>
<span id="cb306-9"><a href="antecedent-precipitation-index.html#cb306-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">show_col_types =</span> F)</span>
<span id="cb306-10"><a href="antecedent-precipitation-index.html#cb306-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-11"><a href="antecedent-precipitation-index.html#cb306-11" aria-hidden="true" tabindex="-1"></a>pcp_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;model_data/field_sites/loggers/clean/pcp_data_clean.csv&quot;</span>,</span>
<span id="cb306-12"><a href="antecedent-precipitation-index.html#cb306-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">show_col_types =</span> F)</span>
<span id="cb306-13"><a href="antecedent-precipitation-index.html#cb306-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-14"><a href="antecedent-precipitation-index.html#cb306-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(site_attributes)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 8
##       id SOIL_ID SNAM.x    Id SNAM.y        SOL_ZMX HYDGRP TEXTURE        
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;          
## 1 600413      23 ST         0 Sea_dep_thick     800 C      sandy loam     
## 2 600411       1 AB         0 ARdy             1000 C      loamy_sand     
## 3 600410      20 RGah       0 GLum-ar          1000 B      sandy_loam     
## 4 600409      13 Humic      0 GLch-hu-sl       1000 D      silty_clay_loam
## 5 600408      13 Humic      0 GLch-hu-sl       1000 D      silty_clay_loam</code></pre>
<p>We will calculate the model per Hydrologic soil group (HSG), and start
with B, which was measured by logger 600410.</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="antecedent-precipitation-index.html#cb308-1" aria-hidden="true" tabindex="-1"></a>b_data <span class="ot">&lt;-</span> logger_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">&quot;600410&quot;</span>)</span></code></pre></div>
</div>
<div id="calculating-the-total-water-content" class="section level3 hasAnchor" number="9.2.2">
<h3><span class="header-section-number">9.2.2</span> Calculating the total water content<a href="antecedent-precipitation-index.html#calculating-the-total-water-content" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We need to calculate the total water content of the profile from the
depth measurements from the following depths:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="antecedent-precipitation-index.html#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(b_data<span class="sc">$</span>depth)</span></code></pre></div>
<pre><code>## [1] &quot;300&quot; &quot;450&quot; &quot;600&quot; &quot;750&quot; &quot;900&quot;</code></pre>
<p>Following code is modified from <span class="citation">Patrignani (<a href="#ref-patrignani2020" role="doc-biblioref">2020</a>)</span> (<a href="https://soilwater.github.io/pynotes-agriscience/notebooks/antecedent_precipitation_index.html"><u>read
more</u></a>)</p>
<p>(This calculation could be improved by considering the soil horizons)</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="antecedent-precipitation-index.html#cb311-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> b_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(depth <span class="sc">==</span> <span class="st">&quot;300&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(value)</span>
<span id="cb311-2"><a href="antecedent-precipitation-index.html#cb311-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> b_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(depth <span class="sc">==</span> <span class="st">&quot;450&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(value)</span>
<span id="cb311-3"><a href="antecedent-precipitation-index.html#cb311-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> b_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(depth <span class="sc">==</span> <span class="st">&quot;600&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(value)</span>
<span id="cb311-4"><a href="antecedent-precipitation-index.html#cb311-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> b_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(depth <span class="sc">==</span> <span class="st">&quot;750&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(value)</span>
<span id="cb311-5"><a href="antecedent-precipitation-index.html#cb311-5" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> b_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(depth <span class="sc">==</span> <span class="st">&quot;900&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(value)</span>
<span id="cb311-6"><a href="antecedent-precipitation-index.html#cb311-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-7"><a href="antecedent-precipitation-index.html#cb311-7" aria-hidden="true" tabindex="-1"></a>total_water_content <span class="ot">&lt;-</span> </span>
<span id="cb311-8"><a href="antecedent-precipitation-index.html#cb311-8" aria-hidden="true" tabindex="-1"></a>  a <span class="sc">*</span> .<span class="dv">35</span> <span class="sc">+</span> <span class="co"># from 0 to 35</span></span>
<span id="cb311-9"><a href="antecedent-precipitation-index.html#cb311-9" aria-hidden="true" tabindex="-1"></a>  b <span class="sc">*</span> .<span class="dv">15</span> <span class="sc">+</span> <span class="co"># from 35 to 50</span></span>
<span id="cb311-10"><a href="antecedent-precipitation-index.html#cb311-10" aria-hidden="true" tabindex="-1"></a>  c <span class="sc">*</span> .<span class="dv">15</span> <span class="sc">+</span> <span class="co"># from 55 to 65</span></span>
<span id="cb311-11"><a href="antecedent-precipitation-index.html#cb311-11" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">*</span> .<span class="dv">15</span> <span class="sc">+</span> <span class="co"># from 65 to 80</span></span>
<span id="cb311-12"><a href="antecedent-precipitation-index.html#cb311-12" aria-hidden="true" tabindex="-1"></a>  e <span class="sc">*</span> .<span class="dv">20</span>   <span class="co"># from 80 to 100</span></span>
<span id="cb311-13"><a href="antecedent-precipitation-index.html#cb311-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-14"><a href="antecedent-precipitation-index.html#cb311-14" aria-hidden="true" tabindex="-1"></a>b_col <span class="ot">&lt;-</span> <span class="fu">tibble</span>(b_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(depth <span class="sc">==</span> <span class="st">&quot;300&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(date), total_water_content)</span></code></pre></div>
<p>And we can add the precipitation data from
<a href="field-site-loggers.html#including-air-temperature-and-precipitation-data">7.2.4</a></p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="antecedent-precipitation-index.html#cb312-1" aria-hidden="true" tabindex="-1"></a>b_col <span class="ot">&lt;-</span> <span class="fu">left_join</span>(b_col, pcp_data, <span class="at">by =</span> <span class="st">&quot;date&quot;</span>)</span>
<span id="cb312-2"><a href="antecedent-precipitation-index.html#cb312-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-3"><a href="antecedent-precipitation-index.html#cb312-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_api</span>(<span class="at">obs =</span> b_col, <span class="at">title =</span> <span class="st">&quot;HSG B&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:hsgbtwcplot"></span>
<img src="_main_files/figure-html/hsgbtwcplot-1.png" alt="Total water content for logger 600410 (HSG B)" width="672" />
<p class="caption">
Figure 9.1: Total water content for logger 600410 (HSG B)
</p>
</div>
<p>Saving the data</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="antecedent-precipitation-index.html#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(b_col, <span class="st">&quot;model_data/field_sites/output/twc.csv&quot;</span>)</span></code></pre></div>
</div>
<div id="defining-api-model" class="section level3 hasAnchor" number="9.2.3">
<h3><span class="header-section-number">9.2.3</span> Defining API model<a href="antecedent-precipitation-index.html#defining-api-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The value is capped at the maximum value of the source data (50). This
could be improved by capping site specific.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb314-1"><a href="antecedent-precipitation-index.html#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> api_model(P,alpha<span class="op">=</span><span class="fl">0.97</span>,ini<span class="op">=</span><span class="fl">36.8</span>):</span>
<span id="cb314-2"><a href="antecedent-precipitation-index.html#cb314-2" aria-hidden="true" tabindex="-1"></a>    api <span class="op">=</span> [ini]</span>
<span id="cb314-3"><a href="antecedent-precipitation-index.html#cb314-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="bu">len</span>(P)):</span>
<span id="cb314-4"><a href="antecedent-precipitation-index.html#cb314-4" aria-hidden="true" tabindex="-1"></a>      append_val <span class="op">=</span> api[t<span class="op">-</span><span class="dv">1</span>]<span class="op">*</span>alpha <span class="op">+</span> P[t]</span>
<span id="cb314-5"><a href="antecedent-precipitation-index.html#cb314-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> append_val <span class="op">&gt;</span> <span class="dv">50</span>:</span>
<span id="cb314-6"><a href="antecedent-precipitation-index.html#cb314-6" aria-hidden="true" tabindex="-1"></a>        append_val <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb314-7"><a href="antecedent-precipitation-index.html#cb314-7" aria-hidden="true" tabindex="-1"></a>      api.append(append_val)</span>
<span id="cb314-8"><a href="antecedent-precipitation-index.html#cb314-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb314-9"><a href="antecedent-precipitation-index.html#cb314-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> api</span></code></pre></div>
<p>Load in our data:</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb315-1"><a href="antecedent-precipitation-index.html#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb315-2"><a href="antecedent-precipitation-index.html#cb315-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;model_data/field_sites/output/twc.csv&#39;</span>)</span>
<span id="cb315-3"><a href="antecedent-precipitation-index.html#cb315-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[[<span class="st">&#39;date&#39;</span>,<span class="st">&#39;value&#39;</span>,<span class="st">&#39;pcp&#39;</span>]]</span>
<span id="cb315-4"><a href="antecedent-precipitation-index.html#cb315-4" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div>
<pre><code>##          date   value  pcp
## 0  2021-11-02  36.880  0.3
## 1  2021-11-03  36.930  1.1
## 2  2021-11-04  36.995  0.0
## 3  2021-11-05  37.025  0.0
## 4  2021-11-06  37.030  0.7</code></pre>
<p>As a test, we will calculate the predictions with an alpha of 0.95:</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb317-1"><a href="antecedent-precipitation-index.html#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb317-2"><a href="antecedent-precipitation-index.html#cb317-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> curve_fit</span>
<span id="cb317-3"><a href="antecedent-precipitation-index.html#cb317-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-4"><a href="antecedent-precipitation-index.html#cb317-4" aria-hidden="true" tabindex="-1"></a><span class="co"># guess</span></span>
<span id="cb317-5"><a href="antecedent-precipitation-index.html#cb317-5" aria-hidden="true" tabindex="-1"></a>storage_guessed <span class="op">=</span> api_model(df[<span class="st">&#39;pcp&#39;</span>], alpha<span class="op">=</span><span class="fl">0.95</span>, ini<span class="op">=</span><span class="fl">36.8</span>)</span>
<span id="cb317-6"><a href="antecedent-precipitation-index.html#cb317-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-7"><a href="antecedent-precipitation-index.html#cb317-7" aria-hidden="true" tabindex="-1"></a><span class="co"># write to text</span></span>
<span id="cb317-8"><a href="antecedent-precipitation-index.html#cb317-8" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> df[[<span class="st">&#39;date&#39;</span>]]</span>
<span id="cb317-9"><a href="antecedent-precipitation-index.html#cb317-9" aria-hidden="true" tabindex="-1"></a>guess <span class="op">=</span> pd.DataFrame(dates.values.tolist(),storage_guessed)</span>
<span id="cb317-10"><a href="antecedent-precipitation-index.html#cb317-10" aria-hidden="true" tabindex="-1"></a>guess.to_csv(<span class="st">&quot;model_data/field_sites/output/first_guess.csv&quot;</span>)</span></code></pre></div>
<p>Now we can have a look at it in R</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="antecedent-precipitation-index.html#cb318-1" aria-hidden="true" tabindex="-1"></a>guess <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;model_data/field_sites/output/first_guess.csv&quot;</span>,</span>
<span id="cb318-2"><a href="antecedent-precipitation-index.html#cb318-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">show_col_types =</span> F,</span>
<span id="cb318-3"><a href="antecedent-precipitation-index.html#cb318-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">&quot;val&quot;</span>, <span class="st">&quot;date&quot;</span>))</span>
<span id="cb318-4"><a href="antecedent-precipitation-index.html#cb318-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-5"><a href="antecedent-precipitation-index.html#cb318-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_api</span>(<span class="at">api_vals =</span> guess, <span class="at">obs =</span> b_col, <span class="at">title =</span> <span class="st">&quot;HSG-B API guessed&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:apiguess"></span>
<img src="_main_files/figure-html/apiguess-1.png" alt="API for guessed alpha of HSG B" width="672" />
<p class="caption">
Figure 9.2: API for guessed alpha of HSG B
</p>
</div>
<p>Now we optimize the alpha parameter using <code>scipy</code> <code>curve_fit</code>.</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb319-1"><a href="antecedent-precipitation-index.html#cb319-1" aria-hidden="true" tabindex="-1"></a>par_opt, par_cov <span class="op">=</span> curve_fit(api_model, df[<span class="st">&#39;pcp&#39;</span>], df[<span class="st">&#39;value&#39;</span>], p0<span class="op">=</span>[<span class="fl">0.95</span>,<span class="dv">100</span>])</span>
<span id="cb319-2"><a href="antecedent-precipitation-index.html#cb319-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-3"><a href="antecedent-precipitation-index.html#cb319-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Annual mean alpha value is&#39;</span>,<span class="bu">round</span>(par_opt[<span class="dv">0</span>],<span class="dv">2</span>))</span></code></pre></div>
<pre><code>## Annual mean alpha value is 0.98</code></pre>
<p>Now we can calculate the API using the optimized parameter.</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb321-1"><a href="antecedent-precipitation-index.html#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb321-2"><a href="antecedent-precipitation-index.html#cb321-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-3"><a href="antecedent-precipitation-index.html#cb321-3" aria-hidden="true" tabindex="-1"></a>storage_optimized <span class="op">=</span> api_model(df[<span class="st">&#39;pcp&#39;</span>],par_opt[<span class="dv">0</span>],par_opt[<span class="dv">1</span>])</span>
<span id="cb321-4"><a href="antecedent-precipitation-index.html#cb321-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-5"><a href="antecedent-precipitation-index.html#cb321-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean Absolute Error</span></span>
<span id="cb321-6"><a href="antecedent-precipitation-index.html#cb321-6" aria-hidden="true" tabindex="-1"></a>MAE <span class="op">=</span> np.mean(np.<span class="bu">abs</span>(df[<span class="st">&#39;value&#39;</span>] <span class="op">-</span> storage_optimized))</span>
<span id="cb321-7"><a href="antecedent-precipitation-index.html#cb321-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Mean annual error =&#39;</span>, <span class="bu">round</span>(MAE,<span class="dv">1</span>),<span class="st">&#39;cm&#39;</span>)</span></code></pre></div>
<pre><code>## Mean annual error = 9.1 cm</code></pre>
<p>And save the data for R</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb323-1"><a href="antecedent-precipitation-index.html#cb323-1" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> df[[<span class="st">&#39;date&#39;</span>]]</span>
<span id="cb323-2"><a href="antecedent-precipitation-index.html#cb323-2" aria-hidden="true" tabindex="-1"></a>api_optimized <span class="op">=</span> pd.DataFrame(dates.values.tolist(),storage_optimized)</span>
<span id="cb323-3"><a href="antecedent-precipitation-index.html#cb323-3" aria-hidden="true" tabindex="-1"></a>api_optimized.to_csv(<span class="st">&quot;model_data/field_sites/output/api_optimized.csv&quot;</span>)</span></code></pre></div>
<p>And have a look in R:</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="antecedent-precipitation-index.html#cb324-1" aria-hidden="true" tabindex="-1"></a>optimized <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;model_data/field_sites/output/api_optimized.csv&quot;</span>,</span>
<span id="cb324-2"><a href="antecedent-precipitation-index.html#cb324-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">show_col_types =</span> F,</span>
<span id="cb324-3"><a href="antecedent-precipitation-index.html#cb324-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">&quot;val&quot;</span>, <span class="st">&quot;date&quot;</span>))</span>
<span id="cb324-4"><a href="antecedent-precipitation-index.html#cb324-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-5"><a href="antecedent-precipitation-index.html#cb324-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_api</span>(<span class="at">api_vals =</span> optimized, <span class="at">obs =</span> b_col, <span class="at">title =</span> <span class="st">&quot;HSG-B API optimized&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:apiloadropti"></span>
<img src="_main_files/figure-html/apiloadropti-1.png" alt="API with an optimized alpha for HSG B" width="672" />
<p class="caption">
Figure 9.3: API with an optimized alpha for HSG B
</p>
</div>
<p>Not great, but also not surprising considering no account for snow melt
has been done, nor do we have good logger data.</p>
<p>We will define this workflow in a function <code>calc_api.R</code> and run it for
the next loggers.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="antecedent-precipitation-index.html#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co"> fix warning</span></span>
<span id="cb325-2"><a href="antecedent-precipitation-index.html#cb325-2" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_api</span>(<span class="at">logger_id =</span> <span class="st">&quot;600409&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in py_to_r.pandas.core.frame.DataFrame(x): index contains duplicated
## values: row names not set</code></pre>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:apicalc09"></span>
<img src="_main_files/figure-html/apicalc09-1.png" alt="Optimized API for logger 600409" width="672" />
<p class="caption">
Figure 9.4: Optimized API for logger 600409
</p>
</div>
<pre><code>##   HSG Alpha 
##   &quot;D&quot;   &quot;1&quot;</code></pre>
<p>This is the logger with broken data, so no surprise that the optimizer
failed.</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="antecedent-precipitation-index.html#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_api</span>(<span class="at">logger_id =</span> <span class="st">&quot;600411&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in py_to_r.pandas.core.frame.DataFrame(x): index contains duplicated
## values: row names not set</code></pre>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:apicalc11"></span>
<img src="_main_files/figure-html/apicalc11-1.png" alt="Optimized API for logger 600411" width="672" />
<p class="caption">
Figure 9.5: Optimized API for logger 600411
</p>
</div>
<pre><code>##    HSG  Alpha 
##    &quot;C&quot; &quot;0.99&quot;</code></pre>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="antecedent-precipitation-index.html#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_api</span>(<span class="at">logger_id =</span> <span class="st">&quot;600413&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in py_to_r.pandas.core.frame.DataFrame(x): index contains duplicated
## values: row names not set</code></pre>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:apicalc13"></span>
<img src="_main_files/figure-html/apicalc13-1.png" alt="Optimized API for logger 600413" width="672" />
<p class="caption">
Figure 9.6: Optimized API for logger 600413
</p>
</div>
<pre><code>##    HSG  Alpha 
##    &quot;C&quot; &quot;0.99&quot;</code></pre>
</div>
</div>
<div id="conclusions" class="section level2 hasAnchor" number="9.3">
<h2><span class="header-section-number">9.3</span> Conclusions<a href="antecedent-precipitation-index.html#conclusions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For HSG B we got an alpha of <strong>0.98</strong>, for C we have two samples, both
of which got <strong>0.99</strong>, and D has two samples as well, but we currently
only have data for one. For the one D site we had, the logger data was
very poor and the <strong>covariance could not be estimated</strong>.</p>
<p>Overall, the API does not seem to be a great estimator of soil moisture
<strong>for our specific case</strong>. Our logger data is poor and has been cut
short due to sensor malfunctions. With a <strong>longer time series</strong> covering
more seasons, it is likely that the curve fitting could be improved
upon, and the overall dynamics could be appraised.;</p>
<p>Secondly, and more critically: the API does not account for <strong>snow
melt</strong>, which plays a significant role in a Boreal catchments such as
CS10. You can see this in action (I think) in March where the logger
data steadily goes up, while the API steadily goes down. Snow melt could
surely be accounted for by adding <em>another</em> model to estimate it – the
question is more if it is worth it, considering the poor underlying data
of the loggers.</p>
<p>Another complication is, if SWATFarmR does not account for snow melt in
its management scheduling, then there is no point in estimating it. And
if snow melt is not incorporated into the scheduling, then the operation
timing will not be very accurate anyway (since snow melt is such a
dominating factor in operation timing).</p>
<p>UPDATE post Q+A Session</p>
<p>We can modify the output of Micha’s script in Section
<a href="swatfarmr-management-schedules.html#pre-processing-crop-rotation">11.1</a> by replacing API with our own custom
variable. This variable could be snow melt or something else entirely
(like a trafficability thing?) This is pretty straight forward, we just
need to add the index to the FarmR using <code>add_variable()</code>. One thing we
need to keep in mind is that this needs to be compatible for the climate
scenarios (i.e. we can only base it off climate variables which we also
have future data on.)</p>
<p>Some things to consider:</p>
<ul>
<li><p>Run SWAT+ for the weather data + scenarios data and use the
calculated snow melt</p></li>
<li><p>Re-create the snow melt model of SWAT+ and use that</p></li>
<li><p>Use HBV or Persist models</p></li>
<li><p>Use some tractability index for Norway (Attila?)</p></li>
</ul>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-patrignani2020" class="csl-entry">
Patrignani, Andres. 2020. <em>PyNotes for Environmental Scientists</em>. Zenodo. <a href="https://doi.org/10.5281/ZENODO.3731389">https://doi.org/10.5281/ZENODO.3731389</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="field-site-properties.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="model-parameterization.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://gitlab.nibio.no/moritzshore/swat-cs10/-/edit/main/07-API_model.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://gitlab.nibio.no/moritzshore/swat-cs10/blob/main/07-API_model.Rmd",
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
