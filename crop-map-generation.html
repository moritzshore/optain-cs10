<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 4 Crop Map Generation | OPTAIN CS-10</title>
  <meta name="description" content="A description of the project setup for OPTAIN case study 10" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 4 Crop Map Generation | OPTAIN CS-10" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://moritzshore.github.io/optain-cs10/figures/banner.png" />
  <meta property="og:description" content="A description of the project setup for OPTAIN case study 10" />
  <meta name="github-repo" content="moritzshore/optain-cs10" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 4 Crop Map Generation | OPTAIN CS-10" />
  
  <meta name="twitter:description" content="A description of the project setup for OPTAIN case study 10" />
  <meta name="twitter:image" content="https://moritzshore.github.io/optain-cs10/figures/banner.png" />

<meta name="author" content="Moritz Shore, Csilla Farkas" />


<meta name="date" content="2023-06-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="writing-swat-input-files.html"/>
<link rel="next" href="landuse.lum-update.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.2/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script src="libs/plotly-binding-4.10.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.28/datatables.js"></script>
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script>
<link href="libs/dt-ext-scroller-1.13.4/css/scroller.dataTables.min.css" rel="stylesheet" />
<script src="libs/dt-ext-scroller-1.13.4/js/dataTables.scroller.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The OPTAIN-CS10 Project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html"><i class="fa fa-check"></i><b>1</b> Model setup with SWATBuildR</a>
<ul>
<li class="chapter" data-level="1.1" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#buildr-setup"><i class="fa fa-check"></i><b>1.1</b> BuildR Setup</a></li>
<li class="chapter" data-level="1.2" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#processing-input-data"><i class="fa fa-check"></i><b>1.2</b> Processing input data</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#high-resolution-digital-elevation-model-dem"><i class="fa fa-check"></i><b>1.2.1</b> High-Resolution Digital Elevation Model (DEM)</a></li>
<li class="chapter" data-level="1.2.2" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#processing-the-basin-boundary"><i class="fa fa-check"></i><b>1.2.2</b> Processing the Basin Boundary</a></li>
<li class="chapter" data-level="1.2.3" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#processing-the-land-layer"><i class="fa fa-check"></i><b>1.2.3</b> Processing the Land layer</a></li>
<li class="chapter" data-level="1.2.4" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#processing-the-channels"><i class="fa fa-check"></i><b>1.2.4</b> Processing the Channels</a></li>
<li class="chapter" data-level="1.2.5" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#processing-the-dem"><i class="fa fa-check"></i><b>1.2.5</b> Processing the DEM</a></li>
<li class="chapter" data-level="1.2.6" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#processing-soil-data"><i class="fa fa-check"></i><b>1.2.6</b> Processing soil data</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#calculating-contiguous-object-connectivity"><i class="fa fa-check"></i><b>1.3</b> Calculating Contiguous Object Connectivity</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#calculating-land-unit-connectivity"><i class="fa fa-check"></i><b>1.3.1</b> Calculating land unit connectivity</a></li>
<li class="chapter" data-level="1.3.2" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#calculating-channelreservoir-connectivity"><i class="fa fa-check"></i><b>1.3.2</b> Calculating channel/reservoir connectivity</a></li>
<li class="chapter" data-level="1.3.3" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#checking-the-water-objects-for-infinite-loops"><i class="fa fa-check"></i><b>1.3.3</b> Checking the water objects for infinite loops</a></li>
<li class="chapter" data-level="1.3.4" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#terrain-properties"><i class="fa fa-check"></i><b>1.3.4</b> Terrain properties</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#generate-swat-input"><i class="fa fa-check"></i><b>1.4</b> Generate SWAT+ input</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#generate-land-object-swat-input-tables"><i class="fa fa-check"></i><b>1.4.1</b> Generate land object SWAT+ input tables</a></li>
<li class="chapter" data-level="1.4.2" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#generate-water-object-swat-input-tables"><i class="fa fa-check"></i><b>1.4.2</b> Generate water object SWAT+ input tables</a></li>
<li class="chapter" data-level="1.4.3" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#build-aquifer-input"><i class="fa fa-check"></i><b>1.4.3</b> Build aquifer input</a></li>
<li class="chapter" data-level="1.4.4" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#add-point-source-inputs"><i class="fa fa-check"></i><b>1.4.4</b> Add point source inputs</a></li>
<li class="chapter" data-level="1.4.5" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#create-swat-sqlite-database"><i class="fa fa-check"></i><b>1.4.5</b> Create SWAT+ sqlite database</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="climate-inputs-and-weather-generator.html"><a href="climate-inputs-and-weather-generator.html"><i class="fa fa-check"></i><b>2</b> Climate inputs and weather generator</a>
<ul>
<li class="chapter" data-level="2.1" data-path="climate-inputs-and-weather-generator.html"><a href="climate-inputs-and-weather-generator.html#preparation-and-loading-data"><i class="fa fa-check"></i><b>2.1</b> Preparation and loading data</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="climate-inputs-and-weather-generator.html"><a href="climate-inputs-and-weather-generator.html#required-packages"><i class="fa fa-check"></i><b>2.1.1</b> Required packages</a></li>
<li class="chapter" data-level="2.1.2" data-path="climate-inputs-and-weather-generator.html"><a href="climate-inputs-and-weather-generator.html#load-in-the-files-and-load-svatools-template"><i class="fa fa-check"></i><b>2.1.2</b> Load in the file(s) and load svatools template</a></li>
<li class="chapter" data-level="2.1.3" data-path="climate-inputs-and-weather-generator.html"><a href="climate-inputs-and-weather-generator.html#proof-the-station"><i class="fa fa-check"></i><b>2.1.3</b> Proof the station</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="climate-inputs-and-weather-generator.html"><a href="climate-inputs-and-weather-generator.html#creating-the-weather-generator"><i class="fa fa-check"></i><b>2.2</b> Creating the weather generator</a></li>
<li class="chapter" data-level="2.3" data-path="climate-inputs-and-weather-generator.html"><a href="climate-inputs-and-weather-generator.html#adding-weather-data-to-swat-project"><i class="fa fa-check"></i><b>2.3</b> Adding weather data to SWAT+ project</a></li>
<li class="chapter" data-level="2.4" data-path="climate-inputs-and-weather-generator.html"><a href="climate-inputs-and-weather-generator.html#adding-atmospheric-deposition"><i class="fa fa-check"></i><b>2.4</b> Adding Atmospheric deposition</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="writing-swat-input-files.html"><a href="writing-swat-input-files.html"><i class="fa fa-check"></i><b>3</b> Writing SWAT+ Input Files</a>
<ul>
<li class="chapter" data-level="3.1" data-path="writing-swat-input-files.html"><a href="writing-swat-input-files.html#loading-the-project-in-swat-editor"><i class="fa fa-check"></i><b>3.1</b> Loading the project in SWAT+ Editor</a></li>
<li class="chapter" data-level="3.2" data-path="writing-swat-input-files.html"><a href="writing-swat-input-files.html#swat-test-run"><i class="fa fa-check"></i><b>3.2</b> SWAT+ Test Run</a></li>
<li class="chapter" data-level="3.3" data-path="writing-swat-input-files.html"><a href="writing-swat-input-files.html#link-aquifers-and-channels-with-geomorphic-flow"><i class="fa fa-check"></i><b>3.3</b> Link aquifers and channels with geomorphic flow</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="crop-map-generation.html"><a href="crop-map-generation.html"><i class="fa fa-check"></i><b>4</b> Crop Map Generation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="crop-map-generation.html"><a href="crop-map-generation.html#calculating-field-area"><i class="fa fa-check"></i><b>4.1</b> Calculating Field Area</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="crop-map-generation.html"><a href="crop-map-generation.html#calculate-field-area-and-assign-ids"><i class="fa fa-check"></i><b>4.1.1</b> Calculate Field Area and Assign IDs</a></li>
<li class="chapter" data-level="4.1.2" data-path="crop-map-generation.html"><a href="crop-map-generation.html#calculate-field-area-and-assign-ids-1"><i class="fa fa-check"></i><b>4.1.2</b> Calculate Field area and assign IDs</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="crop-map-generation.html"><a href="crop-map-generation.html#generating-the-crop-rotation"><i class="fa fa-check"></i><b>4.2</b> Generating the Crop Rotation</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="crop-map-generation.html"><a href="crop-map-generation.html#tidy-up-the-source-data"><i class="fa fa-check"></i><b>4.2.1</b> Tidy up the source data:</a></li>
<li class="chapter" data-level="4.2.2" data-path="crop-map-generation.html"><a href="crop-map-generation.html#tidy-up-the-buildr-output"><i class="fa fa-check"></i><b>4.2.2</b> Tidy up the BuildR output</a></li>
<li class="chapter" data-level="4.2.3" data-path="crop-map-generation.html"><a href="crop-map-generation.html#field-classification"><i class="fa fa-check"></i><b>4.2.3</b> Field classification</a></li>
<li class="chapter" data-level="4.2.4" data-path="crop-map-generation.html"><a href="crop-map-generation.html#extrapolating-the-crop-rotation"><i class="fa fa-check"></i><b>4.2.4</b> Extrapolating the Crop Rotation</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="crop-map-generation.html"><a href="crop-map-generation.html#merging-crop-rotation-with-buildr-output"><i class="fa fa-check"></i><b>4.3</b> Merging crop rotation with BuildR output</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html"><i class="fa fa-check"></i><b>5</b> Landuse.lum update</a>
<ul>
<li class="chapter" data-level="5.1" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#data-preperation"><i class="fa fa-check"></i><b>5.1</b> Data preperation</a></li>
<li class="chapter" data-level="5.2" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#assigning-landuse-values"><i class="fa fa-check"></i><b>5.2</b> Assigning landuse values</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-cal_group"><i class="fa fa-check"></i><b>5.2.1</b> Setting <code>cal_group</code></a></li>
<li class="chapter" data-level="5.2.2" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-plnt_com"><i class="fa fa-check"></i><b>5.2.2</b> Setting <code>plnt_com</code></a></li>
<li class="chapter" data-level="5.2.3" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-mgt"><i class="fa fa-check"></i><b>5.2.3</b> Setting <code>mgt</code></a></li>
<li class="chapter" data-level="5.2.4" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-urb_ro"><i class="fa fa-check"></i><b>5.2.4</b> Setting <code>urb_ro</code></a></li>
<li class="chapter" data-level="5.2.5" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-urban"><i class="fa fa-check"></i><b>5.2.5</b> Setting <code>urban</code></a></li>
<li class="chapter" data-level="5.2.6" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-mannings-n-ovn"><i class="fa fa-check"></i><b>5.2.6</b> Setting Manning’s n (<code>ovn</code>)</a></li>
<li class="chapter" data-level="5.2.7" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-cn2"><i class="fa fa-check"></i><b>5.2.7</b> Setting <code>cn2</code>:</a></li>
<li class="chapter" data-level="5.2.8" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-cons_prac"><i class="fa fa-check"></i><b>5.2.8</b> Setting <code>cons_prac</code></a></li>
<li class="chapter" data-level="5.2.9" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-tile"><i class="fa fa-check"></i><b>5.2.9</b> Setting <code>tile</code></a></li>
<li class="chapter" data-level="5.2.10" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-sep"><i class="fa fa-check"></i><b>5.2.10</b> Setting <code>sep</code></a></li>
<li class="chapter" data-level="5.2.11" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-vfs"><i class="fa fa-check"></i><b>5.2.11</b> Setting <code>vfs</code></a></li>
<li class="chapter" data-level="5.2.12" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-grww"><i class="fa fa-check"></i><b>5.2.12</b> Setting <code>grww</code></a></li>
<li class="chapter" data-level="5.2.13" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#setting-bmp"><i class="fa fa-check"></i><b>5.2.13</b> Setting <code>bmp</code></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="landuse.lum-update.html"><a href="landuse.lum-update.html#writing-changes"><i class="fa fa-check"></i><b>5.3</b> Writing Changes</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="field-site-loggers.html"><a href="field-site-loggers.html"><i class="fa fa-check"></i><b>6</b> Field Site Loggers</a>
<ul>
<li class="chapter" data-level="6.1" data-path="field-site-loggers.html"><a href="field-site-loggers.html#introduction-1"><i class="fa fa-check"></i><b>6.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="field-site-loggers.html"><a href="field-site-loggers.html#prerequisites"><i class="fa fa-check"></i><b>6.1.1</b> Prerequisites</a></li>
<li class="chapter" data-level="6.1.2" data-path="field-site-loggers.html"><a href="field-site-loggers.html#locations"><i class="fa fa-check"></i><b>6.1.2</b> Locations</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="field-site-loggers.html"><a href="field-site-loggers.html#data-processing"><i class="fa fa-check"></i><b>6.2</b> Data Processing</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="field-site-loggers.html"><a href="field-site-loggers.html#loading-data"><i class="fa fa-check"></i><b>6.2.1</b> Loading Data</a></li>
<li class="chapter" data-level="6.2.2" data-path="field-site-loggers.html"><a href="field-site-loggers.html#data-re-structuring"><i class="fa fa-check"></i><b>6.2.2</b> Data Re-structuring</a></li>
<li class="chapter" data-level="6.2.3" data-path="field-site-loggers.html"><a href="field-site-loggers.html#summarize-to-daily-means"><i class="fa fa-check"></i><b>6.2.3</b> Summarize to Daily Means</a></li>
<li class="chapter" data-level="6.2.4" data-path="field-site-loggers.html"><a href="field-site-loggers.html#including-air-temperature-and-precipitation-data"><i class="fa fa-check"></i><b>6.2.4</b> Including Air Temperature and Precipitation Data</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="field-site-loggers.html"><a href="field-site-loggers.html#data-quality-check"><i class="fa fa-check"></i><b>6.3</b> Data quality check</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="field-site-loggers.html"><a href="field-site-loggers.html#logger-600409-deep-rocky-sand"><i class="fa fa-check"></i><b>6.3.1</b> Logger 600409 “Deep Rocky Sand”</a></li>
<li class="chapter" data-level="6.3.2" data-path="field-site-loggers.html"><a href="field-site-loggers.html#logger-600410-tormods-farm"><i class="fa fa-check"></i><b>6.3.2</b> Logger 600410 “Tormods farm”</a></li>
<li class="chapter" data-level="6.3.3" data-path="field-site-loggers.html"><a href="field-site-loggers.html#logger-600411-john-ivar-lower-area"><i class="fa fa-check"></i><b>6.3.3</b> Logger 600411 “John Ivar Lower Area”</a></li>
<li class="chapter" data-level="6.3.4" data-path="field-site-loggers.html"><a href="field-site-loggers.html#logger-600413-john-ivar-behind-the-barn"><i class="fa fa-check"></i><b>6.3.4</b> Logger 600413 “John Ivar behind the barn”</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="field-site-loggers.html"><a href="field-site-loggers.html#data-cleanup"><i class="fa fa-check"></i><b>6.4</b> Data Cleanup</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="field-site-loggers.html"><a href="field-site-loggers.html#general-cleanup"><i class="fa fa-check"></i><b>6.4.1</b> General cleanup</a></li>
<li class="chapter" data-level="6.4.2" data-path="field-site-loggers.html"><a href="field-site-loggers.html#logger-specific-cleanup"><i class="fa fa-check"></i><b>6.4.2</b> Logger specific cleanup</a></li>
<li class="chapter" data-level="6.4.3" data-path="field-site-loggers.html"><a href="field-site-loggers.html#saving-the-cleaned-data"><i class="fa fa-check"></i><b>6.4.3</b> Saving the cleaned data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="field-site-properties.html"><a href="field-site-properties.html"><i class="fa fa-check"></i><b>7</b> Field Site Properties</a>
<ul>
<li class="chapter" data-level="7.1" data-path="field-site-properties.html"><a href="field-site-properties.html#determining-the-hsg-group-of-the-logger-sites"><i class="fa fa-check"></i><b>7.1</b> Determining the HSG group of the logger sites</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html"><i class="fa fa-check"></i><b>8</b> Antecedent Precipitation Index</a>
<ul>
<li class="chapter" data-level="8.1" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#introduction-2"><i class="fa fa-check"></i><b>8.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#pre-requirements"><i class="fa fa-check"></i><b>8.1.1</b> Pre-requirements</a></li>
<li class="chapter" data-level="8.1.2" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#setting-up-python-for-rrmarkdown"><i class="fa fa-check"></i><b>8.1.2</b> Setting up Python for R/Rmarkdown</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#antecedent-precipitation-index-1"><i class="fa fa-check"></i><b>8.2</b> Antecedent Precipitation Index</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#loading-data-1"><i class="fa fa-check"></i><b>8.2.1</b> Loading data</a></li>
<li class="chapter" data-level="8.2.2" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#calculating-the-total-water-content"><i class="fa fa-check"></i><b>8.2.2</b> Calculating the total water content</a></li>
<li class="chapter" data-level="8.2.3" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#defining-api-model"><i class="fa fa-check"></i><b>8.2.3</b> Defining API model</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#conclusions"><i class="fa fa-check"></i><b>8.3</b> Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="model-parameterization.html"><a href="model-parameterization.html"><i class="fa fa-check"></i><b>9</b> Model Parameterization</a>
<ul>
<li class="chapter" data-level="9.1" data-path="model-parameterization.html"><a href="model-parameterization.html#parameter-changes"><i class="fa fa-check"></i><b>9.1</b> Parameter Changes</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="model-parameterization.html"><a href="model-parameterization.html#channel-parameters-revised"><i class="fa fa-check"></i><b>9.1.1</b> Channel parameters revised</a></li>
<li class="chapter" data-level="9.1.2" data-path="model-parameterization.html"><a href="model-parameterization.html#crop-parameters-verified"><i class="fa fa-check"></i><b>9.1.2</b> Crop parameters verified</a></li>
<li class="chapter" data-level="9.1.3" data-path="model-parameterization.html"><a href="model-parameterization.html#soil-physical-parameters-in-final-form"><i class="fa fa-check"></i><b>9.1.3</b> Soil physical parameters in final form</a></li>
<li class="chapter" data-level="9.1.4" data-path="model-parameterization.html"><a href="model-parameterization.html#soil-chemical-parameters-in-final-form"><i class="fa fa-check"></i><b>9.1.4</b> Soil chemical parameters in final form</a></li>
<li class="chapter" data-level="9.1.5" data-path="model-parameterization.html"><a href="model-parameterization.html#impoundment-parameters-defined"><i class="fa fa-check"></i><b>9.1.5</b> Impoundment parameters defined</a></li>
<li class="chapter" data-level="9.1.6" data-path="model-parameterization.html"><a href="model-parameterization.html#water-diversions-defined"><i class="fa fa-check"></i><b>9.1.6</b> Water diversions defined</a></li>
<li class="chapter" data-level="9.1.7" data-path="model-parameterization.html"><a href="model-parameterization.html#point-sources-parameters-added"><i class="fa fa-check"></i><b>9.1.7</b> Point sources parameters added</a></li>
<li class="chapter" data-level="9.1.8" data-path="model-parameterization.html"><a href="model-parameterization.html#tile-drainage-parameters-defined"><i class="fa fa-check"></i><b>9.1.8</b> Tile drainage parameters defined</a></li>
<li class="chapter" data-level="9.1.9" data-path="model-parameterization.html"><a href="model-parameterization.html#atmospheric-deposition-defined"><i class="fa fa-check"></i><b>9.1.9</b> Atmospheric deposition defined</a></li>
<li class="chapter" data-level="9.1.10" data-path="model-parameterization.html"><a href="model-parameterization.html#additional-settings-verified"><i class="fa fa-check"></i><b>9.1.10</b> Additional settings verified</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="model-parameterization.html"><a href="model-parameterization.html#fixing-tiledrain"><i class="fa fa-check"></i><b>9.2</b> Fixing Tiledrain</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="model-parameterization.html"><a href="model-parameterization.html#finding-the-problem-hrus"><i class="fa fa-check"></i><b>9.2.1</b> Finding the problem HRUs</a></li>
<li class="chapter" data-level="9.2.2" data-path="model-parameterization.html"><a href="model-parameterization.html#fixing-the-problem-hrus"><i class="fa fa-check"></i><b>9.2.2</b> Fixing the problem HRUs</a></li>
<li class="chapter" data-level="9.2.3" data-path="model-parameterization.html"><a href="model-parameterization.html#writing-modified-changes"><i class="fa fa-check"></i><b>9.2.3</b> Writing modified changes</a></li>
<li class="chapter" data-level="9.2.4" data-path="model-parameterization.html"><a href="model-parameterization.html#re-enabling-tiledrain"><i class="fa fa-check"></i><b>9.2.4</b> Re-enabling tiledrain</a></li>
<li class="chapter" data-level="9.2.5" data-path="model-parameterization.html"><a href="model-parameterization.html#testing-swat"><i class="fa fa-check"></i><b>9.2.5</b> Testing SWAT+</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="swatfarmr-management-schedules.html"><a href="swatfarmr-management-schedules.html"><i class="fa fa-check"></i><b>10</b> SWATFarmR Management Schedules</a>
<ul>
<li class="chapter" data-level="10.1" data-path="swatfarmr-management-schedules.html"><a href="swatfarmr-management-schedules.html#pre-processing-crop-rotation"><i class="fa fa-check"></i><b>10.1</b> Pre-processing crop rotation</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="swatfarmr-management-schedules.html"><a href="swatfarmr-management-schedules.html#input-files"><i class="fa fa-check"></i><b>10.1.1</b> Input files</a></li>
<li class="chapter" data-level="10.1.2" data-path="swatfarmr-management-schedules.html"><a href="swatfarmr-management-schedules.html#settings"><i class="fa fa-check"></i><b>10.1.2</b> Settings</a></li>
<li class="chapter" data-level="10.1.3" data-path="swatfarmr-management-schedules.html"><a href="swatfarmr-management-schedules.html#checks"><i class="fa fa-check"></i><b>10.1.3</b> Checks</a></li>
<li class="chapter" data-level="10.1.4" data-path="swatfarmr-management-schedules.html"><a href="swatfarmr-management-schedules.html#writing-input-data"><i class="fa fa-check"></i><b>10.1.4</b> Writing input data</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="swatfarmr-management-schedules.html"><a href="swatfarmr-management-schedules.html#initializing-farmr"><i class="fa fa-check"></i><b>10.2</b> Initializing FarmR</a></li>
<li class="chapter" data-level="10.3" data-path="swatfarmr-management-schedules.html"><a href="swatfarmr-management-schedules.html#calculating-antecedent-precipitation-index"><i class="fa fa-check"></i><b>10.3</b> Calculating Antecedent Precipitation Index</a></li>
<li class="chapter" data-level="10.4" data-path="swatfarmr-management-schedules.html"><a href="swatfarmr-management-schedules.html#scheduling-operations"><i class="fa fa-check"></i><b>10.4</b> Scheduling Operations</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="swatfarmr-management-schedules.html"><a href="swatfarmr-management-schedules.html#write-operations"><i class="fa fa-check"></i><b>10.4.1</b> Write Operations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="model-verification.html"><a href="model-verification.html"><i class="fa fa-check"></i><b>11</b> Model Verification</a>
<ul>
<li class="chapter" data-level="11.1" data-path="model-verification.html"><a href="model-verification.html#stage-1-analysis-of-simulated-climate-variables"><i class="fa fa-check"></i><b>11.1</b> Stage 1: Analysis of simulated climate variables</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="model-verification.html"><a href="model-verification.html#lapse-rate-on"><i class="fa fa-check"></i><b>11.1.1</b> Lapse rate on:</a></li>
<li class="chapter" data-level="11.1.2" data-path="model-verification.html"><a href="model-verification.html#lapse-rate-off"><i class="fa fa-check"></i><b>11.1.2</b> Lapse rate off:</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="model-verification.html"><a href="model-verification.html#stage-2-simulation-of-management-operations"><i class="fa fa-check"></i><b>11.2</b> Stage 2: Simulation of management operations</a></li>
<li class="chapter" data-level="11.3" data-path="model-verification.html"><a href="model-verification.html#stage-3-analysis-of-unconstrained-plant-growth"><i class="fa fa-check"></i><b>11.3</b> Stage 3: Analysis of unconstrained plant growth</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">OPTAIN CS-10</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="crop-map-generation" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Section 4</span> Crop Map Generation<a href="crop-map-generation.html#crop-map-generation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>As OPTAIN takes into account the individual field, we need to know what is
growing on which field and when. Unfortunately our data foundation for this task
is quite lackluster, but we will try out best to do so. in the following
chapter.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="crop-map-generation.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(sf)</span>
<span id="cb106-2"><a href="crop-map-generation.html#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(dplyr)</span>
<span id="cb106-3"><a href="crop-map-generation.html#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(readr)</span>
<span id="cb106-4"><a href="crop-map-generation.html#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(stringr)</span>
<span id="cb106-5"><a href="crop-map-generation.html#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(readxl)</span>
<span id="cb106-6"><a href="crop-map-generation.html#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(reshape2)</span>
<span id="cb106-7"><a href="crop-map-generation.html#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(tibble)</span>
<span id="cb106-8"><a href="crop-map-generation.html#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(DT)</span>
<span id="cb106-9"><a href="crop-map-generation.html#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggplot2)</span>
<span id="cb106-10"><a href="crop-map-generation.html#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(gifski)</span>
<span id="cb106-11"><a href="crop-map-generation.html#cb106-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-12"><a href="crop-map-generation.html#cb106-12" aria-hidden="true" tabindex="-1"></a>sf_theme <span class="ot">&lt;-</span> <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_blank</span>(), <span class="co">#remove x axis labels</span></span>
<span id="cb106-13"><a href="crop-map-generation.html#cb106-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x=</span><span class="fu">element_blank</span>(), <span class="co">#remove x axis ticks</span></span>
<span id="cb106-14"><a href="crop-map-generation.html#cb106-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y=</span><span class="fu">element_blank</span>(),  <span class="co">#remove y axis labels</span></span>
<span id="cb106-15"><a href="crop-map-generation.html#cb106-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y=</span><span class="fu">element_blank</span>()  <span class="co">#remove y axis ticks</span></span>
<span id="cb106-16"><a href="crop-map-generation.html#cb106-16" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<div id="calculating-field-area" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Calculating Field Area<a href="crop-map-generation.html#calculating-field-area" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We have data based on what area certain crops have per farm. In order to relate
this to our spatial land use map, we require the area of both the farms, and
the fields within these farms.</p>
<p>The basis for these calculations comes from the BuildR output: (REF header here)</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="crop-map-generation.html#cb107-1" aria-hidden="true" tabindex="-1"></a>lu_sf <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;model_data/cs10_setup/optain-cs10/data/vector/land.shp&quot;</span>)</span>
<span id="cb107-2"><a href="crop-map-generation.html#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="crop-map-generation.html#cb107-3" aria-hidden="true" tabindex="-1"></a>lu_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_sf</span>(lu_sf, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> type)) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;left&quot;</span>) <span class="sc">+</span> sf_theme <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb107-4"><a href="crop-map-generation.html#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="crop-map-generation.html#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lu_map)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="_main_files/figure-html/crop_map_lumap-1.png" alt="Land use map for CS10, colored by type." width="672" />
<p class="caption">
(#fig:crop_map_lumap)Land use map for CS10, colored by type.
</p>
</div>
<div id="calculate-field-area-and-assign-ids" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Calculate Field Area and Assign IDs<a href="crop-map-generation.html#calculate-field-area-and-assign-ids" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This stage has been completed in QGIS. An R-implementation is being
considered.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="crop-map-generation.html#cb108-1" aria-hidden="true" tabindex="-1"></a>farm_area_sf <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;model_data/input/crop/buildr_output_dissolved_into_farms.shp&quot;</span>)</span>
<span id="cb108-2"><a href="crop-map-generation.html#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="crop-map-generation.html#cb108-3" aria-hidden="true" tabindex="-1"></a>field_lu_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_sf</span>(farm_area_sf, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> farm_id)) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span>sf_theme</span>
<span id="cb108-4"><a href="crop-map-generation.html#cb108-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-5"><a href="crop-map-generation.html#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(field_lu_plot)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="_main_files/figure-html/crop_map_farmidfig-1.png" alt="Farms in the CS10 catchment, colored by ID" width="672" />
<p class="caption">
(#fig:crop_map_farmidfig)Farms in the CS10 catchment, colored by ID
</p>
</div>
</div>
<div id="calculate-field-area-and-assign-ids-1" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Calculate Field area and assign IDs<a href="crop-map-generation.html#calculate-field-area-and-assign-ids-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This stage has been completed in QGIS. An R-implementation is being
considered.</p>
</div>
</div>
<div id="generating-the-crop-rotation" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Generating the Crop Rotation<a href="crop-map-generation.html#generating-the-crop-rotation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The following algorithm takes information from reporting farm, and their
respective area in the SWAT+ setup, and combines these data sets to
generate a plausible crop rotation.</p>
<p>Note, pasture refers to meadow (TODO: fix!)</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="crop-map-generation.html#cb109-1" aria-hidden="true" tabindex="-1"></a>crop_data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;model_data/input/crop/crop_rotation_source_data.xlsx&quot;</span>)</span>
<span id="cb109-2"><a href="crop-map-generation.html#cb109-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3"><a href="crop-map-generation.html#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(crop_data)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-020b3082897d1a9e8836" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-020b3082897d1a9e8836">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174"],["a_011","a_052","a_212","a_211","a_096","a_193","a_088","a_031","a_178","a_176","a_060","a_216","a_053","a_046","a_018","a_017","a_016","a_146","a_002","a_076","a_145","a_144","a_035","a_020","a_142","a_182","a_114","a_033","a_028","a_027","a_107","a_007","a_086","a_106","a_104","a_158","a_125","a_128","a_098","a_126","a_012","a_013","a_043","a_109","a_011","a_052","a_212","a_211","a_096","a_193","a_088","a_031","a_178","a_060","a_216","a_053","a_046","a_018","a_017","a_016","a_146","a_002","a_076","a_145","a_144","a_035","a_020","a_142","a_182","a_114","a_033","a_028","a_027","a_107","a_007","a_086","a_106","a_104","a_158","a_125","a_128","a_098","a_126","a_012","a_013","a_045","a_109","a_011","a_052","a_212","a_211","a_193","a_088","a_031","a_096","a_178","a_176","a_060","a_216","a_053","a_046","a_018","a_017","a_016","a_146","a_002","a_076","a_145","a_144","a_035","a_020","a_142","a_182","a_114","a_109","a_028","a_027","a_107","a_007","a_106","a_104","a_086","a_158","a_125","a_128","a_098","a_126","a_012","a_013","a_043","a_011","a_052","a_212","a_211","a_096","a_193","a_088","a_031","a_178","a_174","a_060","a_216","a_053","a_046","a_018","a_017","a_016","a_146","a_002","a_076","a_145","a_144","a_035","a_142","a_182","a_114","a_022","a_033","a_028","a_027","a_107","a_007","a_086","a_104","a_158","a_125","a_128","a_098","a_126","a_012","a_013","a_045","a_043","a_109"],[197.225,162.422,0.29,94.772,134.911,37.891,246.452,415.489,115,177.228,271.366,150.535,348,272,108.974,299.565,207,282.551,923.488,175.147,226.417,115.081,423.238,126.435,98.549,888,57.847,316.575,165.164,235.395,619.868,315.603,437.652,205.452,267.552,144.647,25.236,256.824,252.563,88.129,674,154.202,39.326,518.363,197.225,162.422,0.29,94.772,110.616,2.625,61.234,415.489,115,271.366,150.535,348,272,108.974,299.565,207.032,282.551,652.272,175.147,152.303,115.081,206.175,126.435,98.549,888,57.847,316.575,165.164,235.395,292.066,315.603,16.648,205.452,267.552,144.647,25.236,61,195.69,88.129,674,154.202,143.939,518.363,197.225,162.422,0.29,94.772,37.891,246.452,415.489,134.911,115,177.228,0,0,348,272,108.974,299.565,207,282.551,0,0,226.417,115.081,0,126.435,98.549,888,57.847,518.363,165.164,235.395,619.868,315.603,205.452,267.552,437.652,144.647,25.236,256.824,252.563,88.129,674,154.202,0,197.225,162.422,0.29,94.772,110.616,2.625,61.234,415.489,115,192.072,271.366,150.535,340.404,272,108.974,299.565,207.032,282.551,652.272,175.147,152.303,115.081,206.175,98.549,888,57.847,460.312,316.575,165.164,235.395,292.066,315.603,16.648,267.552,144.647,25.236,61,195.69,88.129,674,154.202,143.939,39.326,518.363],[null,108,null,null,null,null,null,null,80,null,null,null,178,118,30,140,40,null,null,null,null,null,null,null,null,155,null,null,null,null,null,null,null,36,null,null,null,null,null,null,45,null,null,null,null,108,null,null,null,null,null,null,80,null,null,178,118,30,140,null,null,null,null,null,null,null,null,null,155,null,null,null,null,null,null,null,36,null,null,null,null,null,null,45,null,null,null,null,108,null,null,null,null,null,null,80,null,null,null,178,118,30,140,40,null,null,null,null,null,null,null,null,155,null,null,null,null,null,null,36,null,null,null,null,null,null,null,45,null,null,null,108,null,null,null,null,null,null,80,null,null,null,null,118,30,null,null,null,null,null,null,null,null,null,155,null,null,null,null,null,null,null,null,null,null,null,null,null,null,45,null,null,null,null],["swht","barl","oats","oats","swht","oats","swht","barl","swht","swht","oats","oats","wwht","barl","barl","wwht","swht","oats","barl","oats","barl","wwht","oats","swht","oats","oats","oats","oats","barl","swht","barl","oats","oats","oats","barl","barl","barl","oats","swht","barl","oats","oats","barl","pota","swht","oats","oats","barl","barl","oats","swht","wwht","swht","oats","barl","barl","barl","wwht","wwht","oats","wwht","wwht","oats","barl","barl","barl","oats","oats","oats","oats","barl","barl","wwht","barl","oats","barl","barl","barl","swht","barl","barl","oats","barl","barl","barl","oats","pota","swht","barl","oats","oats","oats","swht","barl","swht","swht","swht","oats","barl","wwht","barl","barl","wwht","swht","oats","swht","barl","barl","wwht","oats","swht","oats","oats","oats","pota","barl","swht","barl","oats","oats","barl","oats","barl","barl","oats","swht","barl","oats","oats","swht","swht","wwht","barl","oats","wwht","oats","swht","oats","wwht","wwht","wwht","wwht","barl","oats","oats","oats","wwht","wwht","wwht","swht","oats","wwht","wwht","swht","oats","oats","wwht","barl","barl","wwht","barl","wwht","wwht","oats","swht","barl","barl","oats","barl","barl","barl","barl","wwht","pota"],["barl","wwht",null,"swht","barl","barl","oats","oats","oats",null,"swht",null,null,"wwht",null,null,"oats","wwht","oats","barl","oats","barl","barl","barl","wwht","barl",null,null,"swht",null,"oats","swht","swht",null,"oats",null,"oats","barl","oats",null,"barl",null,"wwht",null,"barl","barl",null,"swht","swht","wwht","barl","barl","oats","wwht","wwht",null,"swht",null,null,"swht","oats","oats","barl","oats","oats","oats","swht","wwht",null,null,null,"oats","barl","oats","wwht","oats",null,"oats",null,"oats","wwht","barl",null,"oats",null,"barl",null,"barl","wwht",null,"swht","barl","oats","oats","barl","oats",null,"barl",null,null,"oats",null,null,"oats","wwht","barl","oats","oats","barl","swht","barl","wwht","barl",null,null,"swht",null,"oats","swht",null,"oats","swht",null,"oats","barl","oats",null,"barl",null,"wwht","barl","barl",null,"wwht","oats","wwht","wwht","wwht",null,null,"oats","barl",null,null,null,null,"swht","barl","barl","barl",null,"oats","swht","barl",null,null,"barl",null,"oats",null,"oats","barl","barl","barl",null,null,"wwht","wwht",null,"oats",null,null,"swht",null],[null,"swht",null,null,null,"wwht",null,"swht",null,null,"barl",null,null,null,null,null,"wwht","barl","wwht",null,null,null,null,"wwht","swht",null,null,null,null,null,null,null,"wwht",null,null,null,null,"swht",null,null,null,null,"oats",null,null,"swht",null,"oats",null,"barl","oats",null,"wwht","barl",null,null,"wwht",null,null,null,null,"barl",null,null,null,null,"wwht",null,null,null,null,null,null,null,null,"wwht",null,null,null,null,"oats",null,null,null,null,null,null,null,"swht",null,null,"wwht",null,"swht",null,null,null,null,null,null,null,null,null,"wwht","barl","oats",null,null,null,null,"wwht","swht",null,null,null,null,null,null,null,null,null,"wwht",null,null,"swht",null,null,null,null,"barl",null,null,null,"barl",null,"barl","barl",null,null,null,null,null,null,null,null,null,"oats",null,null,"oats",null,null,"oats",null,null,null,null,null,null,null,null,null,"oats",null,null,null,"oats",null,null,null,null,null,"barl",null],[69.5431472081218,54,100,84.0725806451613,50,68.4418145956608,52.0076481835564,36.9759036144578,79,100,85.1851851851852,100,100,66,100,100,35,49,41,57.1428571428571,53.2,50,57,32,42,76,100,100,50,100,64,56,39,100,62,100,50,44,52,100,75,100,54,100,70,57,100,38,55,64,50,33,51,45,55,100,46,100,100,63,55,50,54,56,54,57,54,60,100,100,100,50,84,65,52,63,100,57,100,50,39,54,100,66,100,57,100,69.5431472081218,54,100,84.0725806451613,68.4418145956608,52.0076481835564,36.9759036144578,50,89,100,72,100,100,75,100,100,35,49,41,53,53.2,50,57,32,42,76,100,100,50,100,64,56,100,62,39,100,50,44,52,100,75,100,44,70,56,100,66,55,63,54,58,100,100,50,60,100,100,100,100,45,53,56,42,100,80,29,51,100,100,59,100,50,100,65,53,49,50,100,100,46,69,100,63,100,100,36,100],[30.4568527918782,37,null,15.9274193548387,50,19.723865877712,47.9923518164436,32.8795180722892,21,null,9.25925925925926,null,null,34,null,null,38,39,33,42.8571428571429,46.8,50,43,47,34,24,null,null,50,null,36,44,48,null,38,null,50,34,48,null,25,null,20,null,30,34,null,37,45,20,44,67,39,37,45,null,30,null,null,37,45,31,46,44,46,43,27,40,null,null,null,50,16,35,48,25,null,43,null,50,32,46,null,34,null,43,null,30.4568527918782,37,null,15.9274193548387,19.723865877712,47.9923518164436,32.8795180722892,50,11,null,28,null,null,25,null,null,38,39,32,47,46.8,50,43,47,34,24,null,null,50,null,36,44,null,38,48,null,50,34,48,null,25,null,28,30,44,null,24,45,25,27,42,null,null,50,40,null,null,null,null,31,47,44,33,null,20,30,49,null,null,41,null,50,null,35,47,32,50,null,null,32,31,null,37,null,null,18,null],[null,9,null,null,null,11.8343195266272,null,29.9518072289157,null,null,5.55555555555556,null,null,null,null,null,27,12.4113475177305,26,null,null,null,null,21,24,null,null,null,null,null,null,null,13,null,null,null,null,22,null,null,null,null,26,null,null,9,null,25,null,16,6,null,10,18,null,null,24,null,null,null,null,19,null,null,null,null,19,null,null,null,null,null,null,null,null,12,null,null,null,null,29,null,null,null,null,null,null,null,9,null,null,11.8343195266272,null,29.9518072289157,null,null,null,null,null,null,null,null,null,27,12.4113475177305,27,null,null,null,null,21,24,null,null,null,null,null,null,null,null,null,13,null,null,22,null,null,null,null,28,null,null,null,10,null,12,19,null,null,null,null,null,null,null,null,null,24,null,null,25,null,null,41,null,null,null,null,null,null,null,null,null,19,null,null,null,22,null,null,null,null,null,46,null],[2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>farm_id<\/th>\n      <th>area_daa<\/th>\n      <th>pastrure_area_daa<\/th>\n      <th>crop1<\/th>\n      <th>crop2<\/th>\n      <th>crop3<\/th>\n      <th>percent_crop1<\/th>\n      <th>percent_crop2<\/th>\n      <th>percent_crop3<\/th>\n      <th>year<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,7,8,9,10]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div id="tidy-up-the-source-data" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Tidy up the source data:<a href="crop-map-generation.html#tidy-up-the-source-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We are converting the source data to tidy format in the following code snippet</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="crop-map-generation.html#cb110-1" aria-hidden="true" tabindex="-1"></a> crop_names <span class="ot">&lt;-</span> <span class="fu">melt</span>(</span>
<span id="cb110-2"><a href="crop-map-generation.html#cb110-2" aria-hidden="true" tabindex="-1"></a>    crop_data,</span>
<span id="cb110-3"><a href="crop-map-generation.html#cb110-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;farm_id&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;area_daa&quot;</span>, <span class="st">&quot;pastrure_area_daa&quot;</span>),</span>
<span id="cb110-4"><a href="crop-map-generation.html#cb110-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">measure.vars =</span> <span class="fu">c</span>(<span class="st">&quot;crop1&quot;</span>, <span class="st">&quot;crop2&quot;</span>, <span class="st">&quot;crop3&quot;</span>),</span>
<span id="cb110-5"><a href="crop-map-generation.html#cb110-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">variable.name =</span> <span class="st">&quot;crop_status&quot;</span>, <span class="at">value.name =</span> <span class="st">&quot;crop&quot;</span></span>
<span id="cb110-6"><a href="crop-map-generation.html#cb110-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">tibble</span>()</span>
<span id="cb110-7"><a href="crop-map-generation.html#cb110-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-8"><a href="crop-map-generation.html#cb110-8" aria-hidden="true" tabindex="-1"></a>  crop_area <span class="ot">&lt;-</span> <span class="fu">melt</span>(</span>
<span id="cb110-9"><a href="crop-map-generation.html#cb110-9" aria-hidden="true" tabindex="-1"></a>    crop_data,</span>
<span id="cb110-10"><a href="crop-map-generation.html#cb110-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;farm_id&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;area_daa&quot;</span>, <span class="st">&quot;pastrure_area_daa&quot;</span>),</span>
<span id="cb110-11"><a href="crop-map-generation.html#cb110-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">measure.vars =</span> <span class="fu">c</span>(<span class="st">&quot;percent_crop1&quot;</span>, <span class="st">&quot;percent_crop2&quot;</span>, <span class="st">&quot;percent_crop3&quot;</span>),</span>
<span id="cb110-12"><a href="crop-map-generation.html#cb110-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">variable.name =</span> <span class="st">&quot;crop_status&quot;</span>, <span class="at">value.name =</span> <span class="st">&quot;area&quot;</span></span>
<span id="cb110-13"><a href="crop-map-generation.html#cb110-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">tibble</span>()</span>
<span id="cb110-14"><a href="crop-map-generation.html#cb110-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-15"><a href="crop-map-generation.html#cb110-15" aria-hidden="true" tabindex="-1"></a>  crop_area<span class="sc">$</span>crop_status <span class="ot">&lt;-</span> crop_area<span class="sc">$</span>crop_status <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">&quot;percent_&quot;</span>)</span>
<span id="cb110-16"><a href="crop-map-generation.html#cb110-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-17"><a href="crop-map-generation.html#cb110-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># unstable, </span><span class="al">TODO</span><span class="co"> fix!</span></span>
<span id="cb110-18"><a href="crop-map-generation.html#cb110-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(crop_area)[<span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="st">&quot;crop_area_percent&quot;</span></span>
<span id="cb110-19"><a href="crop-map-generation.html#cb110-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-20"><a href="crop-map-generation.html#cb110-20" aria-hidden="true" tabindex="-1"></a>  crop_tidy <span class="ot">&lt;-</span> <span class="fu">left_join</span>(crop_names, crop_area, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;farm_id&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;area_daa&quot;</span>,<span class="st">&quot;pastrure_area_daa&quot;</span>, <span class="st">&quot;crop_status&quot;</span>)) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>crop_status)</span>
<span id="cb110-21"><a href="crop-map-generation.html#cb110-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-22"><a href="crop-map-generation.html#cb110-22" aria-hidden="true" tabindex="-1"></a>   <span class="co"># unstable, </span><span class="al">TODO</span><span class="co"> fix!</span></span>
<span id="cb110-23"><a href="crop-map-generation.html#cb110-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(crop_tidy)[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">&quot;farm_area_daa&quot;</span></span>
<span id="cb110-24"><a href="crop-map-generation.html#cb110-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-25"><a href="crop-map-generation.html#cb110-25" aria-hidden="true" tabindex="-1"></a>  crop_tidy<span class="sc">$</span>crop_area_percent <span class="ot">&lt;-</span> (crop_tidy<span class="sc">$</span>crop_area_percent<span class="sc">/</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">2</span>)</span>
<span id="cb110-26"><a href="crop-map-generation.html#cb110-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-27"><a href="crop-map-generation.html#cb110-27" aria-hidden="true" tabindex="-1"></a>  crop_tidy <span class="ot">&lt;-</span> crop_tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(crop <span class="sc">%&gt;%</span> <span class="fu">is.na</span>() <span class="sc">==</span> <span class="cn">FALSE</span>)</span>
<span id="cb110-28"><a href="crop-map-generation.html#cb110-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-29"><a href="crop-map-generation.html#cb110-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(crop_tidy)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-f168e3193908a0b2f1ee" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f168e3193908a0b2f1ee">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334"],["a_011","a_052","a_212","a_211","a_096","a_193","a_088","a_031","a_178","a_176","a_060","a_216","a_053","a_046","a_018","a_017","a_016","a_146","a_002","a_076","a_145","a_144","a_035","a_020","a_142","a_182","a_114","a_033","a_028","a_027","a_107","a_007","a_086","a_106","a_104","a_158","a_125","a_128","a_098","a_126","a_012","a_013","a_043","a_109","a_011","a_052","a_212","a_211","a_096","a_193","a_088","a_031","a_178","a_060","a_216","a_053","a_046","a_018","a_017","a_016","a_146","a_002","a_076","a_145","a_144","a_035","a_020","a_142","a_182","a_114","a_033","a_028","a_027","a_107","a_007","a_086","a_106","a_104","a_158","a_125","a_128","a_098","a_126","a_012","a_013","a_045","a_109","a_011","a_052","a_212","a_211","a_193","a_088","a_031","a_096","a_178","a_176","a_060","a_216","a_053","a_046","a_018","a_017","a_016","a_146","a_002","a_076","a_145","a_144","a_035","a_020","a_142","a_182","a_114","a_109","a_028","a_027","a_107","a_007","a_106","a_104","a_086","a_158","a_125","a_128","a_098","a_126","a_012","a_013","a_043","a_011","a_052","a_212","a_211","a_096","a_193","a_088","a_031","a_178","a_174","a_060","a_216","a_053","a_046","a_018","a_017","a_016","a_146","a_002","a_076","a_145","a_144","a_035","a_142","a_182","a_114","a_022","a_033","a_028","a_027","a_107","a_007","a_086","a_104","a_158","a_125","a_128","a_098","a_126","a_012","a_013","a_045","a_043","a_109","a_011","a_052","a_211","a_096","a_193","a_088","a_031","a_178","a_060","a_046","a_016","a_146","a_002","a_076","a_145","a_144","a_035","a_020","a_142","a_182","a_028","a_107","a_007","a_086","a_104","a_125","a_128","a_098","a_012","a_043","a_011","a_052","a_211","a_096","a_193","a_088","a_031","a_178","a_060","a_216","a_046","a_016","a_146","a_002","a_076","a_145","a_144","a_035","a_020","a_142","a_028","a_027","a_107","a_007","a_086","a_104","a_125","a_128","a_098","a_012","a_045","a_011","a_052","a_211","a_193","a_088","a_031","a_096","a_178","a_060","a_046","a_016","a_146","a_002","a_076","a_145","a_144","a_035","a_020","a_142","a_182","a_028","a_107","a_007","a_104","a_086","a_125","a_128","a_098","a_012","a_043","a_011","a_052","a_211","a_096","a_193","a_088","a_031","a_060","a_216","a_016","a_146","a_002","a_076","a_144","a_035","a_142","a_022","a_028","a_107","a_007","a_086","a_104","a_128","a_098","a_012","a_043","a_052","a_193","a_031","a_060","a_016","a_146","a_002","a_020","a_142","a_086","a_128","a_043","a_052","a_211","a_193","a_088","a_178","a_060","a_046","a_002","a_020","a_086","a_128","a_052","a_193","a_031","a_016","a_146","a_002","a_020","a_142","a_086","a_128","a_043","a_211","a_193","a_088","a_016","a_076","a_035","a_086","a_128","a_043"],[2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2019,2019,2019,2019,2019,2019,2019,2019,2019],[197.225,162.422,0.29,94.772,134.911,37.891,246.452,415.489,115,177.228,271.366,150.535,348,272,108.974,299.565,207,282.551,923.488,175.147,226.417,115.081,423.238,126.435,98.549,888,57.847,316.575,165.164,235.395,619.868,315.603,437.652,205.452,267.552,144.647,25.236,256.824,252.563,88.129,674,154.202,39.326,518.363,197.225,162.422,0.29,94.772,110.616,2.625,61.234,415.489,115,271.366,150.535,348,272,108.974,299.565,207.032,282.551,652.272,175.147,152.303,115.081,206.175,126.435,98.549,888,57.847,316.575,165.164,235.395,292.066,315.603,16.648,205.452,267.552,144.647,25.236,61,195.69,88.129,674,154.202,143.939,518.363,197.225,162.422,0.29,94.772,37.891,246.452,415.489,134.911,115,177.228,0,0,348,272,108.974,299.565,207,282.551,0,0,226.417,115.081,0,126.435,98.549,888,57.847,518.363,165.164,235.395,619.868,315.603,205.452,267.552,437.652,144.647,25.236,256.824,252.563,88.129,674,154.202,0,197.225,162.422,0.29,94.772,110.616,2.625,61.234,415.489,115,192.072,271.366,150.535,340.404,272,108.974,299.565,207.032,282.551,652.272,175.147,152.303,115.081,206.175,98.549,888,57.847,460.312,316.575,165.164,235.395,292.066,315.603,16.648,267.552,144.647,25.236,61,195.69,88.129,674,154.202,143.939,39.326,518.363,197.225,162.422,94.772,134.911,37.891,246.452,415.489,115,271.366,272,207,282.551,923.488,175.147,226.417,115.081,423.238,126.435,98.549,888,165.164,619.868,315.603,437.652,267.552,25.236,256.824,252.563,674,39.326,197.225,162.422,94.772,110.616,2.625,61.234,415.489,115,271.366,150.535,272,207.032,282.551,652.272,175.147,152.303,115.081,206.175,126.435,98.549,165.164,235.395,292.066,315.603,16.648,267.552,25.236,61,195.69,674,143.939,197.225,162.422,94.772,37.891,246.452,415.489,134.911,115,0,272,207,282.551,0,0,226.417,115.081,0,126.435,98.549,888,165.164,619.868,315.603,267.552,437.652,25.236,256.824,252.563,674,0,197.225,162.422,94.772,110.616,2.625,61.234,415.489,271.366,150.535,207.032,282.551,652.272,175.147,115.081,206.175,98.549,460.312,165.164,292.066,315.603,16.648,267.552,61,195.69,674,39.326,162.422,37.891,415.489,271.366,207,282.551,923.488,126.435,98.549,437.652,256.824,39.326,162.422,94.772,2.625,61.234,115,271.366,272,652.272,126.435,16.648,61,162.422,37.891,415.489,207,282.551,0,126.435,98.549,437.652,256.824,0,94.772,2.625,61.234,207.032,175.147,206.175,16.648,61,39.326],[null,108,null,null,null,null,null,null,80,null,null,null,178,118,30,140,40,null,null,null,null,null,null,null,null,155,null,null,null,null,null,null,null,36,null,null,null,null,null,null,45,null,null,null,null,108,null,null,null,null,null,null,80,null,null,178,118,30,140,null,null,null,null,null,null,null,null,null,155,null,null,null,null,null,null,null,36,null,null,null,null,null,null,45,null,null,null,null,108,null,null,null,null,null,null,80,null,null,null,178,118,30,140,40,null,null,null,null,null,null,null,null,155,null,null,null,null,null,null,36,null,null,null,null,null,null,null,45,null,null,null,108,null,null,null,null,null,null,80,null,null,null,null,118,30,null,null,null,null,null,null,null,null,null,155,null,null,null,null,null,null,null,null,null,null,null,null,null,null,45,null,null,null,null,null,108,null,null,null,null,null,80,null,118,40,null,null,null,null,null,null,null,null,155,null,null,null,null,null,null,null,null,45,null,null,108,null,null,null,null,null,80,null,null,118,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,45,null,null,108,null,null,null,null,null,80,null,118,40,null,null,null,null,null,null,null,null,155,null,null,null,null,null,null,null,null,45,null,null,108,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,45,null,108,null,null,null,40,null,null,null,null,null,null,null,108,null,null,null,80,null,118,null,null,null,null,108,null,null,40,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["swht","barl","oats","oats","swht","oats","swht","barl","swht","swht","oats","oats","wwht","barl","barl","wwht","swht","oats","barl","oats","barl","wwht","oats","swht","oats","oats","oats","oats","barl","swht","barl","oats","oats","oats","barl","barl","barl","oats","swht","barl","oats","oats","barl","pota","swht","oats","oats","barl","barl","oats","swht","wwht","swht","oats","barl","barl","barl","wwht","wwht","oats","wwht","wwht","oats","barl","barl","barl","oats","oats","oats","oats","barl","barl","wwht","barl","oats","barl","barl","barl","swht","barl","barl","oats","barl","barl","barl","oats","pota","swht","barl","oats","oats","oats","swht","barl","swht","swht","swht","oats","barl","wwht","barl","barl","wwht","swht","oats","swht","barl","barl","wwht","oats","swht","oats","oats","oats","pota","barl","swht","barl","oats","oats","barl","oats","barl","barl","oats","swht","barl","oats","oats","swht","swht","wwht","barl","oats","wwht","oats","swht","oats","wwht","wwht","wwht","wwht","barl","oats","oats","oats","wwht","wwht","wwht","swht","oats","wwht","wwht","swht","oats","oats","wwht","barl","barl","wwht","barl","wwht","wwht","oats","swht","barl","barl","oats","barl","barl","barl","barl","wwht","pota","barl","wwht","swht","barl","barl","oats","oats","oats","swht","wwht","oats","wwht","oats","barl","oats","barl","barl","barl","wwht","barl","swht","oats","swht","swht","oats","oats","barl","oats","barl","wwht","barl","barl","swht","swht","wwht","barl","barl","oats","wwht","wwht","swht","swht","oats","oats","barl","oats","oats","oats","swht","wwht","oats","barl","oats","wwht","oats","oats","oats","wwht","barl","oats","barl","barl","wwht","swht","barl","oats","oats","barl","oats","barl","oats","oats","wwht","barl","oats","oats","barl","swht","barl","wwht","barl","swht","oats","swht","oats","swht","oats","barl","oats","barl","wwht","barl","barl","wwht","oats","wwht","wwht","wwht","oats","barl","swht","barl","barl","barl","oats","swht","barl","barl","oats","oats","barl","barl","barl","wwht","wwht","oats","swht","swht","wwht","swht","barl","wwht","barl","wwht","wwht","swht","wwht","swht","oats","swht","oats","barl","oats","wwht","barl","wwht","barl","wwht","wwht","oats","swht","wwht","swht","wwht","barl","oats","wwht","swht","wwht","swht","barl","barl","barl","barl","oats","oats","oats","oats","oats","barl"],[0.7,0.54,1,0.84,0.5,0.68,0.52,0.37,0.79,1,0.85,1,1,0.66,1,1,0.35,0.49,0.41,0.57,0.53,0.5,0.57,0.32,0.42,0.76,1,1,0.5,1,0.64,0.56,0.39,1,0.62,1,0.5,0.44,0.52,1,0.75,1,0.54,1,0.7,0.57,1,0.38,0.55,0.64,0.5,0.33,0.51,0.45,0.55,1,0.46,1,1,0.63,0.55,0.5,0.54,0.56,0.54,0.57,0.54,0.6,1,1,1,0.5,0.84,0.65,0.52,0.63,1,0.57,1,0.5,0.39,0.54,1,0.66,1,0.57,1,0.7,0.54,1,0.84,0.68,0.52,0.37,0.5,0.89,1,0.72,1,1,0.75,1,1,0.35,0.49,0.41,0.53,0.53,0.5,0.57,0.32,0.42,0.76,1,1,0.5,1,0.64,0.56,1,0.62,0.39,1,0.5,0.44,0.52,1,0.75,1,0.44,0.7,0.56,1,0.66,0.55,0.63,0.54,0.58,1,1,0.5,0.6,1,1,1,1,0.45,0.53,0.56,0.42,1,0.8,0.29,0.51,1,1,0.59,1,0.5,1,0.65,0.53,0.49,0.5,1,1,0.46,0.69,1,0.63,1,1,0.36,1,0.3,0.37,0.16,0.5,0.2,0.48,0.33,0.21,0.09,0.34,0.38,0.39,0.33,0.43,0.47,0.5,0.43,0.47,0.34,0.24,0.5,0.36,0.44,0.48,0.38,0.5,0.34,0.48,0.25,0.2,0.3,0.34,0.37,0.45,0.2,0.44,0.67,0.39,0.37,0.45,0.3,0.37,0.45,0.31,0.46,0.44,0.46,0.43,0.27,0.4,0.5,0.16,0.35,0.48,0.25,0.43,0.5,0.32,0.46,0.34,0.43,0.3,0.37,0.16,0.2,0.48,0.33,0.5,0.11,0.28,0.25,0.38,0.39,0.32,0.47,0.47,0.5,0.43,0.47,0.34,0.24,0.5,0.36,0.44,0.38,0.48,0.5,0.34,0.48,0.25,0.28,0.3,0.44,0.24,0.45,0.25,0.27,0.42,0.5,0.4,0.31,0.47,0.44,0.33,0.2,0.3,0.49,0.41,0.5,0.35,0.47,0.32,0.5,0.32,0.31,0.37,0.18,0.09,0.12,0.3,0.06,0.27,0.12,0.26,0.21,0.24,0.13,0.22,0.26,0.09,0.25,0.16,0.06,0.1,0.18,0.24,0.19,0.19,0.12,0.29,0.09,0.12,0.3,0.27,0.12,0.27,0.21,0.24,0.13,0.22,0.28,0.1,0.12,0.19,0.24,0.25,0.41,0.19,0.22,0.46]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>farm_id<\/th>\n      <th>year<\/th>\n      <th>farm_area_daa<\/th>\n      <th>pastrure_area_daa<\/th>\n      <th>crop<\/th>\n      <th>crop_area_percent<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="tidy-up-the-buildr-output" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Tidy up the BuildR output<a href="crop-map-generation.html#tidy-up-the-buildr-output" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The maps shown in secttion (ref) were exported to CSV in QGIS. An R-implementation
might be written in here sometime (#TODO).</p>
<p>This CSV data needs to be re-formatted to be tidy as well.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="crop-map-generation.html#cb111-1" aria-hidden="true" tabindex="-1"></a>fields <span class="ot">&lt;-</span></span>
<span id="cb111-2"><a href="crop-map-generation.html#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(</span>
<span id="cb111-3"><a href="crop-map-generation.html#cb111-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;model_data/input/crop/buildr_landuse_dissolved_into_fields.csv&quot;</span>,</span>
<span id="cb111-4"><a href="crop-map-generation.html#cb111-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">show_col_types =</span> F</span>
<span id="cb111-5"><a href="crop-map-generation.html#cb111-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(type, farm_id, field_area_daa)</span>
<span id="cb111-6"><a href="crop-map-generation.html#cb111-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-7"><a href="crop-map-generation.html#cb111-7" aria-hidden="true" tabindex="-1"></a>farms <span class="ot">&lt;-</span></span>
<span id="cb111-8"><a href="crop-map-generation.html#cb111-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(</span>
<span id="cb111-9"><a href="crop-map-generation.html#cb111-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;model_data/input/crop/buildr_landuse_dissolved_into_farms.csv&quot;</span>,</span>
<span id="cb111-10"><a href="crop-map-generation.html#cb111-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">show_col_types =</span> F</span>
<span id="cb111-11"><a href="crop-map-generation.html#cb111-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(type, farm_id , farm_area_)</span>
<span id="cb111-12"><a href="crop-map-generation.html#cb111-12" aria-hidden="true" tabindex="-1"></a><span class="co"># fix farm_area_ </span><span class="al">TODO</span></span>
<span id="cb111-13"><a href="crop-map-generation.html#cb111-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-14"><a href="crop-map-generation.html#cb111-14" aria-hidden="true" tabindex="-1"></a><span class="co"># unstable, fix! </span><span class="al">TODO</span></span>
<span id="cb111-15"><a href="crop-map-generation.html#cb111-15" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(farms)[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">&quot;farm_area_daa&quot;</span></span>
<span id="cb111-16"><a href="crop-map-generation.html#cb111-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-17"><a href="crop-map-generation.html#cb111-17" aria-hidden="true" tabindex="-1"></a>farms<span class="sc">$</span>farm_area_daa <span class="ot">&lt;-</span> farms<span class="sc">$</span>farm_area_daa <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">2</span>)</span>
<span id="cb111-18"><a href="crop-map-generation.html#cb111-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-19"><a href="crop-map-generation.html#cb111-19" aria-hidden="true" tabindex="-1"></a>fields<span class="sc">$</span>field_area_daa <span class="ot">&lt;-</span> fields<span class="sc">$</span>field_area_daa <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">2</span>)</span>
<span id="cb111-20"><a href="crop-map-generation.html#cb111-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-21"><a href="crop-map-generation.html#cb111-21" aria-hidden="true" tabindex="-1"></a>reported_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(fields, farms, <span class="at">by =</span> <span class="st">&quot;farm_id&quot;</span>)</span>
<span id="cb111-22"><a href="crop-map-generation.html#cb111-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-23"><a href="crop-map-generation.html#cb111-23" aria-hidden="true" tabindex="-1"></a><span class="co"># unstable, fix! </span><span class="al">TODO</span></span>
<span id="cb111-24"><a href="crop-map-generation.html#cb111-24" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(reported_data)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;field_id&quot;</span></span>
<span id="cb111-25"><a href="crop-map-generation.html#cb111-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-26"><a href="crop-map-generation.html#cb111-26" aria-hidden="true" tabindex="-1"></a>reported_data <span class="ot">&lt;-</span> reported_data <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(field_id, farm_id, field_area_daa, farm_area_daa)</span>
<span id="cb111-27"><a href="crop-map-generation.html#cb111-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-28"><a href="crop-map-generation.html#cb111-28" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(reported_data)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-8bf1ede1632afeddd624" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8bf1ede1632afeddd624">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501"],["a_025f_2","a_105f_3","a_105f_1","a_105f_4","a_187f_1","a_206f_1","a_121f_2","a_132f_1","a_182f_3","a_182f_4","a_182f_1","a_182f_2","a_017f_2","a_182f_7","a_123f_2","a_017f_3","a_182f_8","a_123f_3","a_073f_1","a_182f_5","a_017f_1","a_123f_1","a_182f_6","a_203f_1","a_023f_1","a_023f_2","a_073f_4","a_041f_1","a_041f_2","a_158f_1","a_073f_2","a_073f_3","a_070f_1","a_158f_2","a_041f_3","a_026f_1","a_049f_1","a_049f_2","a_129f_1","a_115f_1","a_115f_2","a_026f_2","a_221f_1","a_026f_3","a_221f_2","a_049f_3","a_049f_4","a_012f_5","a_110f_2","a_129f_2","a_012f_6","a_110f_3","a_012f_3","a_129f_3","a_115f_3","a_115f_4","a_012f_4","a_171f_1","a_171f_2","a_044f_1","a_062f_1","a_174f_2","a_058f_1","a_174f_3","a_058f_2","a_174f_1","a_174f_4","a_015f_1","a_065f_1","a_118f_1","a_010f_1","a_015f_2","a_071f_1","a_156f_2","a_110f_1","a_118f_2","a_145f_4","a_156f_1","a_222f_2","a_018f_1","a_177f_1","a_195f_1","a_222f_1","a_195f_2","a_140f_1","a_140f_2","a_219f_1","a_047f_1","a_047f_2","a_063f_1","a_163f_1","a_068f_2","a_113f_1","a_068f_3","a_113f_2","a_068f_1","a_031f_2","a_148f_1","a_031f_3","a_092f_1","a_190f_1","a_031f_1","a_198f_2","a_060f_2","a_060f_1","a_119f_1","a_039f_1","a_119f_2","a_161f_1","a_002f_6","a_211f_1","a_002f_7","a_002f_4","a_002f_5","a_161f_2","a_002f_8","a_102f_1","a_102f_2","a_137f_1","a_164f_3","a_137f_2","a_164f_4","a_020f_2","a_020f_3","a_164f_1","a_164f_2","a_020f_1","a_198f_1","a_217f_1","a_137f_3","a_164f_5","a_020f_4","a_193f_1","a_217f_2","a_066f_1","a_084f_1","a_108f_1","a_089f_1","a_052f_1","a_052f_2","a_196f_1","a_052f_3","a_052f_4","a_143f_1","a_087f_1","a_126f_1","a_126f_2","a_153f_1","a_126f_3","a_126f_4","a_100f_1","a_055f_1","a_185f_1","a_209f_1","a_209f_2","a_079f_4","a_079f_5","a_076f_3","a_076f_1","a_076f_2","a_130f_2","a_167f_1","a_135f_1","a_130f_1","a_029f_1","a_188f_1","a_029f_2","a_021f_3","a_021f_1","a_124f_3","a_021f_2","a_124f_1","a_079f_2","a_079f_3","a_124f_2","a_082f_1","a_042f_2","a_079f_1","a_042f_3","a_042f_1","a_042f_4","a_133f_1","a_133f_2","a_201f_1","a_180f_1","a_204f_2","a_159f_1","a_204f_1","a_083f_1","a_172f_1","a_083f_2","a_024f_2","a_116f_1","a_066f_4","a_024f_1","a_202f_1","a_066f_2","a_066f_3","a_007f_3","a_007f_4","a_007f_1","a_007f_2","a_120f_1","a_154f_1","a_016f_1","a_098f_1","a_122f_1","a_016f_2","a_220f_1","a_098f_2","a_011f_4","a_011f_2","a_022f_1","a_045f_1","a_016f_3","a_011f_3","a_016f_4","a_013f_2","a_146f_5","a_157f_1","a_157f_2","a_013f_1","a_048f_1","a_048f_2","a_090f_1","a_170f_1","a_111f_1","a_149f_1","a_093f_1","a_011f_1","a_178f_2","a_061f_1","a_061f_2","a_178f_1","a_146f_3","a_096f_1","a_146f_4","a_096f_2","a_146f_1","a_146f_2","a_046f_2","a_046f_3","a_212f_1","a_037f_1","a_046f_1","a_096f_3","a_096f_4","a_014f_1","a_103f_1","a_014f_2","a_037f_2","a_117f_3","a_037f_3","a_103f_4","a_117f_4","a_117f_1","a_103f_2","a_117f_2","a_091f_1","a_103f_3","a_008f_1","a_117f_5","a_117f_6","a_194f_1","a_199f_1","a_218f_1","a_144f_1","a_008f_2","a_144f_2","a_162f_1","a_069f_3","a_008f_3","a_162f_2","a_050f_1","a_069f_1","a_069f_2","a_085f_1","a_109f_2","a_191f_1","a_085f_2","a_109f_3","a_053f_2","a_109f_1","a_053f_3","a_215f_1","a_053f_1","a_003f_1","a_003f_2","a_053f_4","a_106f_3","a_038f_1","a_038f_2","a_106f_1","a_106f_2","a_080f_1","a_210f_1","a_127f_2","a_210f_2","a_127f_3","a_080f_4","a_165f_1","a_127f_1","a_080f_5","a_183f_1","a_207f_1","a_080f_2","a_080f_3","a_035f_2","a_151f_1","a_183f_4","a_183f_5","a_080f_6","a_035f_1","a_101f_2","a_183f_2","a_101f_3","a_183f_3","a_056f_1","a_051f_1","a_056f_2","a_074f_1","a_101f_1","a_074f_2","a_136f_1","a_051f_2","a_051f_3","a_186f_1","a_136f_2","a_027f_1","a_027f_2","a_107f_1","a_077f_2","a_088f_1","a_022f_4","a_022f_5","a_077f_3","a_022f_2","a_107f_4","a_022f_3","a_027f_3","a_027f_4","a_022f_8","a_107f_2","a_107f_3","a_022f_6","a_022f_7","a_168f_1","a_059f_1","a_040f_1","a_189f_1","a_125f_1","a_040f_2","a_152f_1","a_175f_1","a_175f_2","a_125f_2","a_125f_3","a_181f_1","a_205f_1","a_043f_1","a_077f_1","a_072f_1","a_072f_2","a_075f_2","a_075f_1","a_114f_1","a_141f_1","a_114f_4","a_114f_5","a_114f_2","a_114f_3","a_005f_1","a_005f_2","a_176f_2","a_032f_1","a_032f_2","a_046f_6","a_046f_7","a_173f_1","a_046f_4","a_005f_3","a_046f_5","a_078f_1","a_064f_1","a_155f_1","a_155f_2","a_099f_2","a_138f_2","a_165f_4","a_210f_3","a_138f_3","a_165f_2","a_176f_1","a_138f_1","a_165f_3","a_138f_6","a_138f_7","a_138f_4","a_138f_5","a_112f_2","a_101f_4","a_101f_5","a_067f_1","a_006f_1","a_112f_1","a_030f_1","a_030f_2","a_197f_1","a_030f_3","a_121f_1","a_104f_1","a_088f_2","a_099f_1","a_104f_2","a_088f_3","a_012f_1","a_012f_2","a_104f_5","a_147f_1","a_104f_3","a_104f_4","a_009f_1","a_009f_2","a_142f_1","a_142f_2","a_097f_1","a_033f_2","a_001f_5","a_001f_6","a_094f_1","a_001f_3","a_160f_3","a_001f_4","a_054f_3","a_160f_1","a_179f_1","a_054f_1","a_160f_2","a_001f_7","a_054f_2","a_139f_3","a_213f_1","a_139f_1","a_139f_2","a_131f_1","a_216f_3","a_216f_4","a_004f_1","a_192f_1","a_216f_1","a_086f_1","a_216f_2","a_216f_5","a_033f_1","a_145f_2","a_001f_1","a_145f_3","a_095f_1","a_001f_2","a_145f_1","a_128f_3","a_184f_1","a_128f_1","a_128f_2","a_208f_1","a_036f_1","a_214f_1","a_019f_1","a_019f_4","a_019f_2","a_019f_3","a_081f_1","a_081f_2","a_132f_2","a_166f_1","a_081f_5","a_166f_2","a_028f_2","a_081f_3","a_081f_4","a_028f_1","a_023f_5","a_034f_1","a_134f_1","a_034f_2","a_023f_3","a_023f_4","a_169f_1","a_150f_1","a_200f_1","a_002f_2","a_057f_1","a_002f_3","a_025f_3","a_025f_4","a_002f_1","a_169f_2","a_150f_2","a_025f_1","a_105f_2","a_150f_3"],["a_025","a_105","a_105","a_105","a_187","a_206","a_121","a_132","a_182","a_182","a_182","a_182","a_017","a_182","a_123","a_017","a_182","a_123","a_073","a_182","a_017","a_123","a_182","a_203","a_023","a_023","a_073","a_041","a_041","a_158","a_073","a_073","a_070","a_158","a_041","a_026","a_049","a_049","a_129","a_115","a_115","a_026","a_221","a_026","a_221","a_049","a_049","a_012","a_110","a_129","a_012","a_110","a_012","a_129","a_115","a_115","a_012","a_171","a_171","a_044","a_062","a_174","a_058","a_174","a_058","a_174","a_174","a_015","a_065","a_118","a_010","a_015","a_071","a_156","a_110","a_118","a_145","a_156","a_222","a_018","a_177","a_195","a_222","a_195","a_140","a_140","a_219","a_047","a_047","a_063","a_163","a_068","a_113","a_068","a_113","a_068","a_031","a_148","a_031","a_092","a_190","a_031","a_198","a_060","a_060","a_119","a_039","a_119","a_161","a_002","a_211","a_002","a_002","a_002","a_161","a_002","a_102","a_102","a_137","a_164","a_137","a_164","a_020","a_020","a_164","a_164","a_020","a_198","a_217","a_137","a_164","a_020","a_193","a_217","a_066","a_084","a_108","a_089","a_052","a_052","a_196","a_052","a_052","a_143","a_087","a_126","a_126","a_153","a_126","a_126","a_100","a_055","a_185","a_209","a_209","a_079","a_079","a_076","a_076","a_076","a_130","a_167","a_135","a_130","a_029","a_188","a_029","a_021","a_021","a_124","a_021","a_124","a_079","a_079","a_124","a_082","a_042","a_079","a_042","a_042","a_042","a_133","a_133","a_201","a_180","a_204","a_159","a_204","a_083","a_172","a_083","a_024","a_116","a_066","a_024","a_202","a_066","a_066","a_007","a_007","a_007","a_007","a_120","a_154","a_016","a_098","a_122","a_016","a_220","a_098","a_011","a_011","a_022","a_045","a_016","a_011","a_016","a_013","a_146","a_157","a_157","a_013","a_048","a_048","a_090","a_170","a_111","a_149","a_093","a_011","a_178","a_061","a_061","a_178","a_146","a_096","a_146","a_096","a_146","a_146","a_046","a_046","a_212","a_037","a_046","a_096","a_096","a_014","a_103","a_014","a_037","a_117","a_037","a_103","a_117","a_117","a_103","a_117","a_091","a_103","a_008","a_117","a_117","a_194","a_199","a_218","a_144","a_008","a_144","a_162","a_069","a_008","a_162","a_050","a_069","a_069","a_085","a_109","a_191","a_085","a_109","a_053","a_109","a_053","a_215","a_053","a_003","a_003","a_053","a_106","a_038","a_038","a_106","a_106","a_080","a_210","a_127","a_210","a_127","a_080","a_165","a_127","a_080","a_183","a_207","a_080","a_080","a_035","a_151","a_183","a_183","a_080","a_035","a_101","a_183","a_101","a_183","a_056","a_051","a_056","a_074","a_101","a_074","a_136","a_051","a_051","a_186","a_136","a_027","a_027","a_107","a_077","a_088","a_022","a_022","a_077","a_022","a_107","a_022","a_027","a_027","a_022","a_107","a_107","a_022","a_022","a_168","a_059","a_040","a_189","a_125","a_040","a_152","a_175","a_175","a_125","a_125","a_181","a_205","a_043","a_077","a_072","a_072","a_075","a_075","a_114","a_141","a_114","a_114","a_114","a_114","a_005","a_005","a_176","a_032","a_032","a_046","a_046","a_173","a_046","a_005","a_046","a_078","a_064","a_155","a_155","a_099","a_138","a_165","a_210","a_138","a_165","a_176","a_138","a_165","a_138","a_138","a_138","a_138","a_112","a_101","a_101","a_067","a_006","a_112","a_030","a_030","a_197","a_030","a_121","a_104","a_088","a_099","a_104","a_088","a_012","a_012","a_104","a_147","a_104","a_104","a_009","a_009","a_142","a_142","a_097","a_033","a_001","a_001","a_094","a_001","a_160","a_001","a_054","a_160","a_179","a_054","a_160","a_001","a_054","a_139","a_213","a_139","a_139","a_131","a_216","a_216","a_004","a_192","a_216","a_086","a_216","a_216","a_033","a_145","a_001","a_145","a_095","a_001","a_145","a_128","a_184","a_128","a_128","a_208","a_036","a_214","a_019","a_019","a_019","a_019","a_081","a_081","a_132","a_166","a_081","a_166","a_028","a_081","a_081","a_028","a_023","a_034","a_134","a_034","a_023","a_023","a_169","a_150","a_200","a_002","a_057","a_002","a_025","a_025","a_002","a_169","a_150","a_025","a_105","a_150"],[13.22,1.17,59.2,20.27,8.01,7.1,6.98,42.78,7.17,6.29,28.06,5.51,29.38,0.74,3.32,44.99,2.18,57.66,28.24,24.69,228.45,1.67,14.13,21.02,50.03,62.58,123.06,35.61,46.86,128.07,1.81,23.55,0.84,17.45,9.02,144.92,145.63,177.47,2.72,11.35,15.9,18.85,17.66,3.77,120.88,6.07,29.53,2.28,12.14,41.48,1.58,18.97,2.39,0.09,18.43,5.3,9.56,0.31,0.2,72.62,0.98,30.52,29.23,28.61,21.03,118.17,15.12,74.11,0.73,1.73,2.32,18.59,3.07,4.99,25.25,3.78,0.42,45.04,0.89,108.68,16.42,249.52,0.1,165.52,67.32,5.21,0.43,94.7,2.31,0.3,14.22,268.05,14.89,21.09,82.55,8.9,296.87,3.15,113.31,82.15,2.95,7.99,5.3,194.45,77.39,3.72,8.45,3.5,7.1,83.94,96.37,110.43,21.95,62.29,5.06,77.93,13.54,11.96,65.66,47.29,5.01,233.35,0.72,20.98,1.64,1.76,103.43,6.16,2.79,99.04,6.35,1.79,2.63,0.4,22.49,14.56,38.39,11.45,141.7,14.27,62.34,1.96,5.54,2.42,12.54,37.84,40.4,7.38,6.85,4.07,42.41,40.07,9.4,0.27,1.07,3.16,2.98,24.7,132.97,20.1,3.43,1.94,1.51,129.71,15.84,11.7,198.05,59.09,127.13,14.23,83.54,15.59,16.5,261.83,28,184.82,7.59,55.62,10.47,9.08,33.68,0.49,5.7,5.23,0.37,3.9,12.5,21.28,8.16,0.98,140.01,12.36,2.13,2.2,31.22,0.18,10.44,45.88,49.91,12.51,169.66,84.4,6.74,1.54,172.1,152.49,21.87,8.58,21.69,45.06,60.48,91.76,19.5,143.83,5.1,0.41,21.26,10.06,167.16,16.07,58.02,145.28,90.24,0.92,0.13,17.79,0.71,15.27,2.21,44.74,50.96,11.11,122.17,64.12,10.41,39.35,55.88,60.82,25.65,23.97,3.76,59.95,0.29,2.29,30.52,7.82,3.5,0.43,149.67,0.18,3.03,23.49,15.33,97.66,56.97,179.94,18.98,63.36,35.45,71.65,28.35,2.99,3.89,27.98,17.71,22.6,6.21,1.46,109.63,169.03,63.24,0.58,10.43,23.08,72.91,73.56,38.48,22.15,82.05,0.32,35.18,32.73,50.42,25.36,2.77,278.12,135.93,18.37,4.78,10.85,12.84,9.27,86.81,108.12,11.4,82.86,58.03,5.93,34.31,6.51,117.2,160.71,90.36,18.58,13.04,22.82,51.46,4.63,11.31,4.98,44.53,8.8,200.56,36.99,5.58,0.17,25.62,4.57,26.62,4.24,9.5,3.64,4.64,96.07,15.29,7.78,1.59,99.65,21.87,2.42,14.71,23.25,20.31,70.83,5.14,14.38,11.76,79.48,62,90.32,120.83,44.51,189.35,9.36,21.47,227.19,14.46,66.14,1.42,0.82,12.66,15.03,10.3,1.31,0.53,9.97,2.45,16.73,30.39,39.2,148,316.66,71.54,14.66,0.89,2,187.01,3.7,26.29,20.32,5.56,31.87,210.26,0.92,0.35,0.14,17.47,130.46,5.45,3.16,29.23,26.97,234.39,3.97,9.11,5.54,162.83,40.62,25.77,15.17,3.24,30.49,145.62,0.17,24.76,0.37,0.28,5.16,98.29,53.2,1.73,14.2,6.03,175.56,1.39,154.5,4.16,1.26,72.88,3.68,31.25,24.82,9.32,0.09,16.43,10.94,40.64,91.91,3.23,82.1,63.3,53.45,11.02,66.19,32.38,8.63,32.97,91.65,0.95,3.98,10.67,34.83,19.07,18.93,2.39,0.47,52.62,25.01,7.18,4.72,4.19,1.02,77.33,79.31,0.69,18.02,15.28,641.93,60.9,10.83,16.66,44.6,62.44,286.78,5.78,5.74,128.94,15.36,118.58,18.06,28.35,5.6,30.76,1.99,0.28,0.43,0.98,97.55,2.41,4.14,0.49,76.98,43.31,49.8,1.18,6.11,3.33,108.95,3.85,1.5,58.76,32.89,11.17,2.9,37.97,17.84,43.17,9.51,59.31,8.87,118.6,1.1,71.82,143.61,41.94,108.32,21.84,66.36,194.95,4.56,78.02],[393.72,85.2,85.2,85.2,8.01,7.1,10.66,92.58,88.77,88.77,88.77,88.77,302.82,88.77,62.66,302.82,88.77,62.66,176.66,88.77,302.82,62.66,88.77,21.02,206.52,206.52,176.66,91.49,91.49,145.53,176.66,176.66,0.84,145.53,91.49,167.55,358.7,358.7,44.28,50.98,50.98,167.55,138.54,167.55,138.54,358.7,358.7,67.39,56.35,44.28,67.39,56.35,67.39,44.28,50.98,50.98,67.39,0.51,0.51,72.62,0.98,192.42,50.26,192.42,50.26,192.42,192.42,92.69,0.73,5.51,2.32,92.69,3.07,50.03,56.35,5.51,153.2,50.03,0.99,108.68,16.42,415.03,0.99,415.03,72.53,72.53,0.43,97.02,97.02,0.3,14.22,298.04,97.44,298.04,97.44,298.04,418.17,3.15,418.17,82.15,2.95,418.17,11.46,271.84,271.84,7.22,8.45,7.22,12.16,655.27,96.37,655.27,655.27,655.27,12.16,655.27,25.5,25.5,169.71,290.39,169.71,290.39,126.93,126.93,290.39,290.39,126.93,11.46,3.19,169.71,290.39,126.93,2.63,3.19,81.02,14.56,38.39,11.45,163.48,163.48,62.34,163.48,163.48,2.42,12.54,89.16,89.16,7.38,89.16,89.16,42.41,40.07,9.4,1.35,1.35,340.09,340.09,177.77,177.77,177.77,133.14,1.94,1.51,133.14,213.89,11.7,213.89,269.76,269.76,57.83,269.76,57.83,340.09,340.09,57.83,184.82,60.81,340.09,60.81,60.81,60.81,6.18,6.18,5.23,0.37,25.18,12.49,25.18,148.17,0.98,148.17,43.58,2.13,81.02,43.58,0.18,81.02,81.02,316.49,316.49,316.49,316.49,6.74,1.54,207.04,197.55,21.87,207.04,21.69,197.55,197.39,197.39,462.4,143.84,207.04,197.39,207.04,155.34,283.08,74.09,74.09,155.34,91.16,91.16,0.13,17.79,0.71,15.27,2.21,197.39,115.08,133.28,133.28,115.08,283.08,111.49,283.08,111.49,283.08,283.08,272.29,272.29,0.29,20.66,272.29,111.49,111.49,0.61,337.95,0.61,20.66,330.65,20.66,337.95,330.65,330.65,337.95,330.65,35.45,337.95,30.39,330.65,330.65,27.98,17.71,22.6,115.84,30.39,115.84,179.46,209.7,30.39,179.46,23.08,209.7,209.7,38.79,107.75,82.05,38.79,107.75,340.98,107.75,340.98,2.77,340.98,154.31,154.31,340.98,205.79,22.1,22.1,205.79,205.79,191.35,103.97,253.05,103.97,253.05,191.35,198.22,253.05,191.35,99.29,13.04,191.35,191.35,205.19,11.31,99.29,99.29,191.35,205.19,56.73,99.29,56.73,99.29,8.81,49.68,8.81,14.14,56.73,14.14,195.72,49.68,49.68,1.59,195.72,235.44,235.44,292.9,185.62,61.56,462.4,462.4,185.62,462.4,292.9,462.4,235.44,235.44,462.4,292.9,292.9,462.4,462.4,14.46,66.14,16.45,0.81,25.08,16.45,10.3,1.83,1.83,25.08,25.08,16.73,30.39,39.2,185.62,388.2,388.2,15.54,15.54,57.87,187.01,57.87,57.87,57.87,57.87,271.36,271.36,146.54,0.49,0.49,272.29,272.29,5.45,272.29,271.36,272.29,234.39,3.96,14.65,14.65,172.15,148.13,198.22,103.97,148.13,198.22,146.54,148.13,198.22,148.13,148.13,148.13,148.13,54.58,56.73,56.73,6.03,175.56,54.58,231.53,231.53,1.26,231.53,10.66,268.66,61.56,172.15,268.66,61.56,67.39,67.39,268.66,3.23,268.66,268.66,64.47,64.47,98.58,98.58,8.63,319.75,253.84,253.84,3.98,253.84,62.22,253.84,76.26,62.22,0.47,76.26,62.22,253.84,76.26,160.83,1.02,160.83,160.83,0.69,151.17,151.17,641.93,60.9,151.17,16.66,151.17,151.17,319.75,153.2,253.84,153.2,15.36,253.84,153.2,61.11,5.6,61.11,61.11,0.28,0.43,0.98,104.6,104.6,104.6,104.6,131.75,131.75,92.58,4.51,131.75,4.51,167.71,131.75,131.75,167.71,206.52,49.14,2.9,49.14,206.52,206.52,31.35,203.68,8.87,655.27,1.1,655.27,393.72,393.72,655.27,31.35,203.68,393.72,85.2,203.68]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>field_id<\/th>\n      <th>farm_id<\/th>\n      <th>field_area_daa<\/th>\n      <th>farm_area_daa<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="field-classification" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Field classification<a href="crop-map-generation.html#field-classification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We are now ready to perform our classification. We will store our results in
this predefined dataframe:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="crop-map-generation.html#cb112-1" aria-hidden="true" tabindex="-1"></a>classed_fields <span class="ot">&lt;-</span></span>
<span id="cb112-2"><a href="crop-map-generation.html#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb112-3"><a href="crop-map-generation.html#cb112-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">farm_id =</span> <span class="cn">NA</span>,</span>
<span id="cb112-4"><a href="crop-map-generation.html#cb112-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">field_id   =</span> <span class="cn">NA</span>,</span>
<span id="cb112-5"><a href="crop-map-generation.html#cb112-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">farm_area_daa =</span> <span class="cn">NA</span>,</span>
<span id="cb112-6"><a href="crop-map-generation.html#cb112-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">field_area_daa =</span> <span class="cn">NA</span>,</span>
<span id="cb112-7"><a href="crop-map-generation.html#cb112-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">crop  =</span> <span class="cn">NA</span>,</span>
<span id="cb112-8"><a href="crop-map-generation.html#cb112-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="cn">NA</span></span>
<span id="cb112-9"><a href="crop-map-generation.html#cb112-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>The following reporting farms will be used for the classification:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="crop-map-generation.html#cb113-1" aria-hidden="true" tabindex="-1"></a>farms <span class="ot">&lt;-</span> reported_data<span class="sc">$</span>farm_id <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span></code></pre></div>
<p>For the following years (AKA we have data for these years):</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="crop-map-generation.html#cb114-1" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2016</span>, <span class="dv">2017</span>, <span class="dv">2018</span>, <span class="dv">2019</span>)</span></code></pre></div>
<p>This for loop runs through all the fields and classifies them. The output will
not be printed in this file, but will be saved in a log file, that you can dig
out of the repository, located here:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="crop-map-generation.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co"> add the log file generation</span></span></code></pre></div>
<p>The following code is not executed:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="crop-map-generation.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For every year</span></span>
<span id="cb116-2"><a href="crop-map-generation.html#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(c_year <span class="cf">in</span> years){</span>
<span id="cb116-3"><a href="crop-map-generation.html#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For every farm,</span></span>
<span id="cb116-4"><a href="crop-map-generation.html#cb116-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (farm <span class="cf">in</span> farms) {</span>
<span id="cb116-5"><a href="crop-map-generation.html#cb116-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Do the following:</span></span>
<span id="cb116-6"><a href="crop-map-generation.html#cb116-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-7"><a href="crop-map-generation.html#cb116-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the source and buildR data to the given year and farm</span></span>
<span id="cb116-8"><a href="crop-map-generation.html#cb116-8" aria-hidden="true" tabindex="-1"></a>    crop_filter <span class="ot">&lt;-</span> crop_tidy <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> c_year) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(farm_id <span class="sc">==</span> farm)</span>
<span id="cb116-9"><a href="crop-map-generation.html#cb116-9" aria-hidden="true" tabindex="-1"></a>    hru_filter <span class="ot">&lt;-</span> reported_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(farm_id <span class="sc">==</span> farm)</span>
<span id="cb116-10"><a href="crop-map-generation.html#cb116-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-11"><a href="crop-map-generation.html#cb116-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Behavior if the farm has no reporting data:</span></span>
<span id="cb116-12"><a href="crop-map-generation.html#cb116-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(crop_filter<span class="sc">$</span>farm_id <span class="sc">%&gt;%</span> <span class="fu">length</span>() <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb116-13"><a href="crop-map-generation.html#cb116-13" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-14"><a href="crop-map-generation.html#cb116-14" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Set all fields to winter wheat.</span></span>
<span id="cb116-15"><a href="crop-map-generation.html#cb116-15" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-16"><a href="crop-map-generation.html#cb116-16" aria-hidden="true" tabindex="-1"></a>      farm_fields <span class="ot">&lt;-</span> hru_filter <span class="sc">%&gt;%</span></span>
<span id="cb116-17"><a href="crop-map-generation.html#cb116-17" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(farm_id, field_id, farm_area_daa, field_area_daa) <span class="sc">%&gt;%</span></span>
<span id="cb116-18"><a href="crop-map-generation.html#cb116-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="fu">desc</span>(field_area_daa))</span>
<span id="cb116-19"><a href="crop-map-generation.html#cb116-19" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-20"><a href="crop-map-generation.html#cb116-20" aria-hidden="true" tabindex="-1"></a>      farm_fields<span class="sc">$</span>crop <span class="ot">=</span> <span class="st">&quot;wwht&quot;</span></span>
<span id="cb116-21"><a href="crop-map-generation.html#cb116-21" aria-hidden="true" tabindex="-1"></a>      farm_fields<span class="sc">$</span>year <span class="ot">=</span> c_year</span>
<span id="cb116-22"><a href="crop-map-generation.html#cb116-22" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-23"><a href="crop-map-generation.html#cb116-23" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Add them to the results dataframe</span></span>
<span id="cb116-24"><a href="crop-map-generation.html#cb116-24" aria-hidden="true" tabindex="-1"></a>      classed_fields <span class="ot">&lt;-</span> <span class="fu">rbind</span>(classed_fields, farm_fields)</span>
<span id="cb116-25"><a href="crop-map-generation.html#cb116-25" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-26"><a href="crop-map-generation.html#cb116-26" aria-hidden="true" tabindex="-1"></a>      <span class="co"># and skipping to next farm</span></span>
<span id="cb116-27"><a href="crop-map-generation.html#cb116-27" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span>()</span>
<span id="cb116-28"><a href="crop-map-generation.html#cb116-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb116-29"><a href="crop-map-generation.html#cb116-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-30"><a href="crop-map-generation.html#cb116-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Behavior, if there is reporting data on the farm&quot;</span></span>
<span id="cb116-31"><a href="crop-map-generation.html#cb116-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-32"><a href="crop-map-generation.html#cb116-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the area of the farm (all elements in vector are the same, so ok</span></span>
<span id="cb116-33"><a href="crop-map-generation.html#cb116-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># to just grab the first)</span></span>
<span id="cb116-34"><a href="crop-map-generation.html#cb116-34" aria-hidden="true" tabindex="-1"></a>    farm_area_hru <span class="ot">&lt;-</span> hru_filter<span class="sc">$</span>farm_area_daa[<span class="dv">1</span>]</span>
<span id="cb116-35"><a href="crop-map-generation.html#cb116-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-36"><a href="crop-map-generation.html#cb116-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the discrepency between &quot;SHOULD BE&quot; crop area and &quot;CURRENTLY IS&quot;</span></span>
<span id="cb116-37"><a href="crop-map-generation.html#cb116-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># crop area. We want this as an absolute value.</span></span>
<span id="cb116-38"><a href="crop-map-generation.html#cb116-38" aria-hidden="true" tabindex="-1"></a>    area_dis <span class="ot">&lt;-</span> (hru_filter<span class="sc">$</span>farm_area_daa[<span class="dv">1</span>]<span class="sc">-</span>crop_filter<span class="sc">$</span>farm_area_daa[<span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb116-39"><a href="crop-map-generation.html#cb116-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">abs</span>()</span>
<span id="cb116-40"><a href="crop-map-generation.html#cb116-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-41"><a href="crop-map-generation.html#cb116-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Some farms have no reported area. in this case we set it to some random</span></span>
<span id="cb116-42"><a href="crop-map-generation.html#cb116-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># negative number. </span></span>
<span id="cb116-43"><a href="crop-map-generation.html#cb116-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(area_dis <span class="sc">%&gt;%</span> <span class="fu">is.na</span>()){area_dis <span class="ot">=</span> <span class="sc">-</span><span class="dv">999</span>}</span>
<span id="cb116-44"><a href="crop-map-generation.html#cb116-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-45"><a href="crop-map-generation.html#cb116-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extracting the area of the pasture and farm (all vectors same value, ok</span></span>
<span id="cb116-46"><a href="crop-map-generation.html#cb116-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># to just take the first)</span></span>
<span id="cb116-47"><a href="crop-map-generation.html#cb116-47" aria-hidden="true" tabindex="-1"></a>    past_area <span class="ot">&lt;-</span> crop_filter<span class="sc">$</span>pastrure_area_daa[<span class="dv">1</span>]</span>
<span id="cb116-48"><a href="crop-map-generation.html#cb116-48" aria-hidden="true" tabindex="-1"></a>    farm_area <span class="ot">&lt;-</span> crop_filter<span class="sc">$</span>farm_area_daa[<span class="dv">1</span>]</span>
<span id="cb116-49"><a href="crop-map-generation.html#cb116-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-50"><a href="crop-map-generation.html#cb116-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract relevant fields</span></span>
<span id="cb116-51"><a href="crop-map-generation.html#cb116-51" aria-hidden="true" tabindex="-1"></a>    farm_fields <span class="ot">&lt;-</span> hru_filter <span class="sc">%&gt;%</span></span>
<span id="cb116-52"><a href="crop-map-generation.html#cb116-52" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(farm_id, field_id, farm_area_daa, field_area_daa) <span class="sc">%&gt;%</span></span>
<span id="cb116-53"><a href="crop-map-generation.html#cb116-53" aria-hidden="true" tabindex="-1"></a>      <span class="co"># and sort by area</span></span>
<span id="cb116-54"><a href="crop-map-generation.html#cb116-54" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(field_area_daa))</span>
<span id="cb116-55"><a href="crop-map-generation.html#cb116-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-56"><a href="crop-map-generation.html#cb116-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pre-define crops column to be NA</span></span>
<span id="cb116-57"><a href="crop-map-generation.html#cb116-57" aria-hidden="true" tabindex="-1"></a>    farm_fields<span class="sc">$</span>crop <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb116-58"><a href="crop-map-generation.html#cb116-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-59"><a href="crop-map-generation.html#cb116-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bollean check to see if the field has been meadow in a previous year. If</span></span>
<span id="cb116-60"><a href="crop-map-generation.html#cb116-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># it has, then we want to continue planting meadow on it (This was a</span></span>
<span id="cb116-61"><a href="crop-map-generation.html#cb116-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># decision we made.)</span></span>
<span id="cb116-62"><a href="crop-map-generation.html#cb116-62" aria-hidden="true" tabindex="-1"></a>    has_meadow <span class="ot">&lt;-</span> (classed_fields <span class="sc">%&gt;%</span> <span class="fu">filter</span>(field_id <span class="sc">%in%</span> farm_fields<span class="sc">$</span>field_id)</span>
<span id="cb116-63"><a href="crop-map-generation.html#cb116-63" aria-hidden="true" tabindex="-1"></a>                   <span class="sc">%&gt;%</span> <span class="fu">filter</span>(crop <span class="sc">==</span> <span class="st">&quot;meadow&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb116-64"><a href="crop-map-generation.html#cb116-64" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">select</span>(field_id) <span class="sc">%&gt;%</span> <span class="fu">pull</span>() <span class="sc">%&gt;%</span> <span class="fu">length</span>() <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb116-65"><a href="crop-map-generation.html#cb116-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-66"><a href="crop-map-generation.html#cb116-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-67"><a href="crop-map-generation.html#cb116-67" aria-hidden="true" tabindex="-1"></a>    <span class="do">### Determining how much land the crops should cover. </span></span>
<span id="cb116-68"><a href="crop-map-generation.html#cb116-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-69"><a href="crop-map-generation.html#cb116-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This if statement checks if is currently a pasture portion for the reporting</span></span>
<span id="cb116-70"><a href="crop-map-generation.html#cb116-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># farm, or if there has been in the past. </span></span>
<span id="cb116-71"><a href="crop-map-generation.html#cb116-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>((past_area <span class="sc">%&gt;%</span> <span class="fu">is.na</span>() <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">|</span> has_meadow) {</span>
<span id="cb116-72"><a href="crop-map-generation.html#cb116-72" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-73"><a href="crop-map-generation.html#cb116-73" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If it does, or did, then this special routine is enacted:</span></span>
<span id="cb116-74"><a href="crop-map-generation.html#cb116-74" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-75"><a href="crop-map-generation.html#cb116-75" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Determines the pasture percentage of the total farm</span></span>
<span id="cb116-76"><a href="crop-map-generation.html#cb116-76" aria-hidden="true" tabindex="-1"></a>      past_percent <span class="ot">&lt;-</span> (past_area<span class="sc">/</span>farm_area)</span>
<span id="cb116-77"><a href="crop-map-generation.html#cb116-77" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-78"><a href="crop-map-generation.html#cb116-78" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If it cannot be calculated, then it is set to 0</span></span>
<span id="cb116-79"><a href="crop-map-generation.html#cb116-79" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(past_percent <span class="sc">%&gt;%</span> <span class="fu">is.na</span>()){past_percent <span class="ot">=</span> <span class="dv">0</span>}</span>
<span id="cb116-80"><a href="crop-map-generation.html#cb116-80" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-81"><a href="crop-map-generation.html#cb116-81" aria-hidden="true" tabindex="-1"></a>      <span class="co"># The crop fractions provided to us in the source data did not account for</span></span>
<span id="cb116-82"><a href="crop-map-generation.html#cb116-82" aria-hidden="true" tabindex="-1"></a>      <span class="co"># the pasture fraction. therefore we need to reduce the other crop</span></span>
<span id="cb116-83"><a href="crop-map-generation.html#cb116-83" aria-hidden="true" tabindex="-1"></a>      <span class="co"># fractions by this amount. </span></span>
<span id="cb116-84"><a href="crop-map-generation.html#cb116-84" aria-hidden="true" tabindex="-1"></a>      adjuster <span class="ot">&lt;-</span> past_percent <span class="sc">/</span> <span class="fu">length</span>(crop_filter<span class="sc">$</span>crop)</span>
<span id="cb116-85"><a href="crop-map-generation.html#cb116-85" aria-hidden="true" tabindex="-1"></a>      crop_filter<span class="sc">$</span>crop_area_percent <span class="ot">&lt;-</span> crop_filter<span class="sc">$</span>crop_area_percent<span class="sc">-</span>adjuster</span>
<span id="cb116-86"><a href="crop-map-generation.html#cb116-86" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-87"><a href="crop-map-generation.html#cb116-87" aria-hidden="true" tabindex="-1"></a>      <span class="co"># creating a new entry for pasture and adding it to the now updated crop\</span></span>
<span id="cb116-88"><a href="crop-map-generation.html#cb116-88" aria-hidden="true" tabindex="-1"></a>      <span class="co"># fractions list</span></span>
<span id="cb116-89"><a href="crop-map-generation.html#cb116-89" aria-hidden="true" tabindex="-1"></a>      past_row <span class="ot">&lt;-</span></span>
<span id="cb116-90"><a href="crop-map-generation.html#cb116-90" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tibble</span>(</span>
<span id="cb116-91"><a href="crop-map-generation.html#cb116-91" aria-hidden="true" tabindex="-1"></a>          <span class="at">farm_id =</span> farm,</span>
<span id="cb116-92"><a href="crop-map-generation.html#cb116-92" aria-hidden="true" tabindex="-1"></a>          <span class="at">year =</span> c_year,</span>
<span id="cb116-93"><a href="crop-map-generation.html#cb116-93" aria-hidden="true" tabindex="-1"></a>          <span class="at">farm_area_daa =</span> crop_filter<span class="sc">$</span>farm_area_daa[<span class="dv">1</span>],</span>
<span id="cb116-94"><a href="crop-map-generation.html#cb116-94" aria-hidden="true" tabindex="-1"></a>          <span class="at">pastrure_area_daa =</span> past_area,</span>
<span id="cb116-95"><a href="crop-map-generation.html#cb116-95" aria-hidden="true" tabindex="-1"></a>          <span class="at">crop =</span> <span class="st">&quot;meadow&quot;</span>,</span>
<span id="cb116-96"><a href="crop-map-generation.html#cb116-96" aria-hidden="true" tabindex="-1"></a>          <span class="at">crop_area_percent =</span> past_percent</span>
<span id="cb116-97"><a href="crop-map-generation.html#cb116-97" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb116-98"><a href="crop-map-generation.html#cb116-98" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-99"><a href="crop-map-generation.html#cb116-99" aria-hidden="true" tabindex="-1"></a>      crop_filter <span class="ot">&lt;-</span> <span class="fu">rbind</span>(crop_filter, past_row)</span>
<span id="cb116-100"><a href="crop-map-generation.html#cb116-100" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-101"><a href="crop-map-generation.html#cb116-101" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Creating an updated &quot;SHOULD BE&quot; and &quot;CURRENTLY IS&quot; crop coverage</span></span>
<span id="cb116-102"><a href="crop-map-generation.html#cb116-102" aria-hidden="true" tabindex="-1"></a>      <span class="co"># datafram</span></span>
<span id="cb116-103"><a href="crop-map-generation.html#cb116-103" aria-hidden="true" tabindex="-1"></a>      crop_coverage <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb116-104"><a href="crop-map-generation.html#cb116-104" aria-hidden="true" tabindex="-1"></a>        <span class="at">crop =</span> crop_filter<span class="sc">$</span>crop, </span>
<span id="cb116-105"><a href="crop-map-generation.html#cb116-105" aria-hidden="true" tabindex="-1"></a>        <span class="at">to_cover =</span> (farm_area_hru<span class="sc">*</span>crop_filter<span class="sc">$</span>crop_area_percent))</span>
<span id="cb116-106"><a href="crop-map-generation.html#cb116-106" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-107"><a href="crop-map-generation.html#cb116-107" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Setting the initial actual coverage to 0 (&quot;CURRENTLY IS&quot;)</span></span>
<span id="cb116-108"><a href="crop-map-generation.html#cb116-108" aria-hidden="true" tabindex="-1"></a>      crop_coverage<span class="sc">$</span>actual <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb116-109"><a href="crop-map-generation.html#cb116-109" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-110"><a href="crop-map-generation.html#cb116-110" aria-hidden="true" tabindex="-1"></a>      <span class="co"># This extracts the fields that were previously pasture fields. </span></span>
<span id="cb116-111"><a href="crop-map-generation.html#cb116-111" aria-hidden="true" tabindex="-1"></a>      previously_pasture <span class="ot">&lt;-</span> classed_fields <span class="sc">%&gt;%</span></span>
<span id="cb116-112"><a href="crop-map-generation.html#cb116-112" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(field_id <span class="sc">%in%</span> farm_fields<span class="sc">$</span>field_id) <span class="sc">%&gt;%</span></span>
<span id="cb116-113"><a href="crop-map-generation.html#cb116-113" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(crop <span class="sc">==</span> <span class="st">&quot;meadow&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb116-114"><a href="crop-map-generation.html#cb116-114" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(field_id) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb116-115"><a href="crop-map-generation.html#cb116-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-116"><a href="crop-map-generation.html#cb116-116" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(previously_pasture) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb116-117"><a href="crop-map-generation.html#cb116-117" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if some of the fields were previously pasture, they are set to pasture</span></span>
<span id="cb116-118"><a href="crop-map-generation.html#cb116-118" aria-hidden="true" tabindex="-1"></a>        <span class="co"># again:</span></span>
<span id="cb116-119"><a href="crop-map-generation.html#cb116-119" aria-hidden="true" tabindex="-1"></a>        farm_fields<span class="sc">$</span>crop[</span>
<span id="cb116-120"><a href="crop-map-generation.html#cb116-120" aria-hidden="true" tabindex="-1"></a>          <span class="fu">which</span>(farm_fields<span class="sc">$</span>field_id <span class="sc">%in%</span> previously_pasture)] <span class="ot">=</span> <span class="st">&quot;meadow&quot;</span></span>
<span id="cb116-121"><a href="crop-map-generation.html#cb116-121" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb116-122"><a href="crop-map-generation.html#cb116-122" aria-hidden="true" tabindex="-1"></a>        <span class="co"># We save the amount of area the meadow crops cover, so that we can </span></span>
<span id="cb116-123"><a href="crop-map-generation.html#cb116-123" aria-hidden="true" tabindex="-1"></a>        <span class="co"># adjust the other &quot;SHOULD BE&quot; fractions correctly.</span></span>
<span id="cb116-124"><a href="crop-map-generation.html#cb116-124" aria-hidden="true" tabindex="-1"></a>        custom_actual <span class="ot">&lt;-</span> farm_fields <span class="sc">%&gt;%</span> <span class="fu">filter</span>(crop <span class="sc">==</span> <span class="st">&quot;meadow&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb116-125"><a href="crop-map-generation.html#cb116-125" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(field_area_daa) <span class="sc">%&gt;%</span> <span class="fu">pull</span>() <span class="sc">%&gt;%</span> <span class="fu">sum</span>(<span class="at">na.rm =</span> T)</span>
<span id="cb116-126"><a href="crop-map-generation.html#cb116-126" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb116-127"><a href="crop-map-generation.html#cb116-127" aria-hidden="true" tabindex="-1"></a>        crop_coverage<span class="sc">$</span>actual[<span class="fu">which</span>(crop_coverage<span class="sc">$</span>crop<span class="sc">==</span><span class="st">&quot;meadow&quot;</span>)] <span class="ot">=</span> custom_actual</span>
<span id="cb116-128"><a href="crop-map-generation.html#cb116-128" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb116-129"><a href="crop-map-generation.html#cb116-129" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-130"><a href="crop-map-generation.html#cb116-130" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Now the algorithm continues as normal.</span></span>
<span id="cb116-131"><a href="crop-map-generation.html#cb116-131" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-132"><a href="crop-map-generation.html#cb116-132" aria-hidden="true" tabindex="-1"></a>      <span class="co"># This is the routine that is run, when no meadow is detected:</span></span>
<span id="cb116-133"><a href="crop-map-generation.html#cb116-133" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span>{</span>
<span id="cb116-134"><a href="crop-map-generation.html#cb116-134" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb116-135"><a href="crop-map-generation.html#cb116-135" aria-hidden="true" tabindex="-1"></a>        <span class="co"># creating a tibble which tracks how much land the crops SHOULD cover</span></span>
<span id="cb116-136"><a href="crop-map-generation.html#cb116-136" aria-hidden="true" tabindex="-1"></a>        crop_coverage <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb116-137"><a href="crop-map-generation.html#cb116-137" aria-hidden="true" tabindex="-1"></a>            <span class="at">crop =</span> crop_filter<span class="sc">$</span>crop,</span>
<span id="cb116-138"><a href="crop-map-generation.html#cb116-138" aria-hidden="true" tabindex="-1"></a>            <span class="at">to_cover =</span> (farm_area_hru <span class="sc">*</span> crop_filter<span class="sc">$</span>crop_area_percent)</span>
<span id="cb116-139"><a href="crop-map-generation.html#cb116-139" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb116-140"><a href="crop-map-generation.html#cb116-140" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb116-141"><a href="crop-map-generation.html#cb116-141" aria-hidden="true" tabindex="-1"></a>      <span class="co"># pre define crop coverage to 0 (CURRENT)</span></span>
<span id="cb116-142"><a href="crop-map-generation.html#cb116-142" aria-hidden="true" tabindex="-1"></a>      crop_coverage<span class="sc">$</span>actual <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb116-143"><a href="crop-map-generation.html#cb116-143" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb116-144"><a href="crop-map-generation.html#cb116-144" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-145"><a href="crop-map-generation.html#cb116-145" aria-hidden="true" tabindex="-1"></a>    <span class="do">### Crop classification</span></span>
<span id="cb116-146"><a href="crop-map-generation.html#cb116-146" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-147"><a href="crop-map-generation.html#cb116-147" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Now we know how much land the crops SHOULD cover, it is time to assign</span></span>
<span id="cb116-148"><a href="crop-map-generation.html#cb116-148" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the fields accordingly. We do this with a WHILE loop, which keeps going</span></span>
<span id="cb116-149"><a href="crop-map-generation.html#cb116-149" aria-hidden="true" tabindex="-1"></a>    <span class="co"># until we have classified every field. </span></span>
<span id="cb116-150"><a href="crop-map-generation.html#cb116-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-151"><a href="crop-map-generation.html#cb116-151" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span>(<span class="fu">any</span>(farm_fields<span class="sc">$</span>crop <span class="sc">%&gt;%</span> <span class="fu">is.na</span>())){</span>
<span id="cb116-152"><a href="crop-map-generation.html#cb116-152" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-153"><a href="crop-map-generation.html#cb116-153" aria-hidden="true" tabindex="-1"></a>      <span class="co"># run through all the crops in the crop coverage list and determine or</span></span>
<span id="cb116-154"><a href="crop-map-generation.html#cb116-154" aria-hidden="true" tabindex="-1"></a>      <span class="co"># update their current coverage</span></span>
<span id="cb116-155"><a href="crop-map-generation.html#cb116-155" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (c_crop <span class="cf">in</span> crop_coverage<span class="sc">$</span>crop) {</span>
<span id="cb116-156"><a href="crop-map-generation.html#cb116-156" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb116-157"><a href="crop-map-generation.html#cb116-157" aria-hidden="true" tabindex="-1"></a>        <span class="co"># figure out which index we are in the list</span></span>
<span id="cb116-158"><a href="crop-map-generation.html#cb116-158" aria-hidden="true" tabindex="-1"></a>        crop_index <span class="ot">&lt;-</span> <span class="fu">which</span>(c_crop <span class="sc">==</span>  crop_coverage<span class="sc">$</span>crop)</span>
<span id="cb116-159"><a href="crop-map-generation.html#cb116-159" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb116-160"><a href="crop-map-generation.html#cb116-160" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Determine/UPDATE the current actual coverage of the crop (sum)</span></span>
<span id="cb116-161"><a href="crop-map-generation.html#cb116-161" aria-hidden="true" tabindex="-1"></a>        crop_coverage<span class="sc">$</span>actual[crop_index] <span class="ot">&lt;-</span></span>
<span id="cb116-162"><a href="crop-map-generation.html#cb116-162" aria-hidden="true" tabindex="-1"></a>          farm_fields <span class="sc">%&gt;%</span> <span class="fu">filter</span>(crop <span class="sc">==</span> c_crop) <span class="sc">%&gt;%</span></span>
<span id="cb116-163"><a href="crop-map-generation.html#cb116-163" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(field_area_daa) <span class="sc">%&gt;%</span> <span class="fu">sum</span>()</span>
<span id="cb116-164"><a href="crop-map-generation.html#cb116-164" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb116-165"><a href="crop-map-generation.html#cb116-165" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-166"><a href="crop-map-generation.html#cb116-166" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate the difference between crop SHOULD BE coverage and ACTUAL</span></span>
<span id="cb116-167"><a href="crop-map-generation.html#cb116-167" aria-hidden="true" tabindex="-1"></a>      <span class="co"># coverage</span></span>
<span id="cb116-168"><a href="crop-map-generation.html#cb116-168" aria-hidden="true" tabindex="-1"></a>      crop_coverage<span class="sc">$</span>diff <span class="ot">&lt;-</span> crop_coverage<span class="sc">$</span>actual<span class="sc">-</span>crop_coverage<span class="sc">$</span>to_cover</span>
<span id="cb116-169"><a href="crop-map-generation.html#cb116-169" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-170"><a href="crop-map-generation.html#cb116-170" aria-hidden="true" tabindex="-1"></a>      <span class="co"># determine the maximum difference.</span></span>
<span id="cb116-171"><a href="crop-map-generation.html#cb116-171" aria-hidden="true" tabindex="-1"></a>      max_diff <span class="ot">&lt;-</span> crop_coverage<span class="sc">$</span>diff <span class="sc">%&gt;%</span> <span class="fu">min</span>(<span class="at">na.rm =</span> T)</span>
<span id="cb116-172"><a href="crop-map-generation.html#cb116-172" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-173"><a href="crop-map-generation.html#cb116-173" aria-hidden="true" tabindex="-1"></a>      <span class="co"># determine which crop has the maximum difference</span></span>
<span id="cb116-174"><a href="crop-map-generation.html#cb116-174" aria-hidden="true" tabindex="-1"></a>      max_diff_crop <span class="ot">&lt;-</span> crop_coverage<span class="sc">$</span>crop[<span class="fu">which</span>(crop_coverage<span class="sc">$</span>diff <span class="sc">==</span> max_diff)</span>
<span id="cb116-175"><a href="crop-map-generation.html#cb116-175" aria-hidden="true" tabindex="-1"></a>                                          <span class="sc">%&gt;%</span> <span class="fu">min</span>(<span class="at">na.rm =</span> T)]</span>
<span id="cb116-176"><a href="crop-map-generation.html#cb116-176" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-177"><a href="crop-map-generation.html#cb116-177" aria-hidden="true" tabindex="-1"></a>      <span class="co"># determine the biggest field left un-classified.</span></span>
<span id="cb116-178"><a href="crop-map-generation.html#cb116-178" aria-hidden="true" tabindex="-1"></a>      biggest_na_field <span class="ot">&lt;-</span> farm_fields <span class="sc">%&gt;%</span> <span class="fu">filter</span>(crop <span class="sc">%&gt;%</span> <span class="fu">is.na</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb116-179"><a href="crop-map-generation.html#cb116-179" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="fu">desc</span>(field_area_daa)) <span class="sc">%&gt;%</span> <span class="fu">nth</span>(<span class="dv">1</span>)</span>
<span id="cb116-180"><a href="crop-map-generation.html#cb116-180" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb116-181"><a href="crop-map-generation.html#cb116-181" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Set the field which is still NA, and also the biggest to the crop with</span></span>
<span id="cb116-182"><a href="crop-map-generation.html#cb116-182" aria-hidden="true" tabindex="-1"></a>      <span class="co"># the maximum difference (This code seems weird, and could be </span></span>
<span id="cb116-183"><a href="crop-map-generation.html#cb116-183" aria-hidden="true" tabindex="-1"></a>      <span class="co"># improved?)</span></span>
<span id="cb116-184"><a href="crop-map-generation.html#cb116-184" aria-hidden="true" tabindex="-1"></a>      farm_fields<span class="sc">$</span>crop[<span class="fu">which</span>((farm_fields<span class="sc">$</span>crop <span class="sc">%&gt;%</span> <span class="fu">is.na</span>() <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">&amp;</span></span>
<span id="cb116-185"><a href="crop-map-generation.html#cb116-185" aria-hidden="true" tabindex="-1"></a>                               farm_fields<span class="sc">$</span>field_area_daa <span class="sc">==</span> biggest_na_field<span class="sc">$</span>field_area_daa</span>
<span id="cb116-186"><a href="crop-map-generation.html#cb116-186" aria-hidden="true" tabindex="-1"></a>      )] <span class="ot">&lt;-</span> max_diff_crop</span>
<span id="cb116-187"><a href="crop-map-generation.html#cb116-187" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb116-188"><a href="crop-map-generation.html#cb116-188" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-189"><a href="crop-map-generation.html#cb116-189" aria-hidden="true" tabindex="-1"></a>    <span class="co"># After having classified the field, we update the actual coverage value</span></span>
<span id="cb116-190"><a href="crop-map-generation.html#cb116-190" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the respective crop that has been classified.</span></span>
<span id="cb116-191"><a href="crop-map-generation.html#cb116-191" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (c_crop <span class="cf">in</span> crop_coverage<span class="sc">$</span>crop) {</span>
<span id="cb116-192"><a href="crop-map-generation.html#cb116-192" aria-hidden="true" tabindex="-1"></a>      crop_index <span class="ot">&lt;-</span> <span class="fu">which</span>(c_crop <span class="sc">==</span>  crop_coverage<span class="sc">$</span>crop)</span>
<span id="cb116-193"><a href="crop-map-generation.html#cb116-193" aria-hidden="true" tabindex="-1"></a>      crop_coverage<span class="sc">$</span>actual[crop_index] <span class="ot">&lt;-</span></span>
<span id="cb116-194"><a href="crop-map-generation.html#cb116-194" aria-hidden="true" tabindex="-1"></a>        farm_fields <span class="sc">%&gt;%</span> <span class="fu">filter</span>(crop <span class="sc">==</span> c_crop) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(field_area_daa) <span class="sc">%&gt;%</span> <span class="fu">sum</span>()</span>
<span id="cb116-195"><a href="crop-map-generation.html#cb116-195" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb116-196"><a href="crop-map-generation.html#cb116-196" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-197"><a href="crop-map-generation.html#cb116-197" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save the year of this crop assignment in the dataframe</span></span>
<span id="cb116-198"><a href="crop-map-generation.html#cb116-198" aria-hidden="true" tabindex="-1"></a>    farm_fields<span class="sc">$</span>year <span class="ot">=</span> c_year</span>
<span id="cb116-199"><a href="crop-map-generation.html#cb116-199" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-200"><a href="crop-map-generation.html#cb116-200" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add the classification to the result dataframe</span></span>
<span id="cb116-201"><a href="crop-map-generation.html#cb116-201" aria-hidden="true" tabindex="-1"></a>    classed_fields <span class="ot">&lt;-</span> <span class="fu">rbind</span>(classed_fields, farm_fields)</span>
<span id="cb116-202"><a href="crop-map-generation.html#cb116-202" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb116-203"><a href="crop-map-generation.html#cb116-203" aria-hidden="true" tabindex="-1"></a>    <span class="co"># and move onto the next farm</span></span>
<span id="cb116-204"><a href="crop-map-generation.html#cb116-204" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb116-205"><a href="crop-map-generation.html#cb116-205" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for every year</span></span>
<span id="cb116-206"><a href="crop-map-generation.html#cb116-206" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb116-207"><a href="crop-map-generation.html#cb116-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-208"><a href="crop-map-generation.html#cb116-208" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the first NA line</span></span>
<span id="cb116-209"><a href="crop-map-generation.html#cb116-209" aria-hidden="true" tabindex="-1"></a>classed_fields <span class="ot">&lt;-</span> classed_fields[<span class="sc">-</span><span class="dv">1</span>, ]</span></code></pre></div>
<p>Now we can have a look at our results (not evaluated)</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="crop-map-generation.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(classed_fields)</span></code></pre></div>
<p>We can now extract the crop rotation from this datatable. (not evaluated)</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="crop-map-generation.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the format of our final dataframe</span></span>
<span id="cb118-2"><a href="crop-map-generation.html#cb118-2" aria-hidden="true" tabindex="-1"></a>final_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">field =</span> <span class="cn">NA</span>,</span>
<span id="cb118-3"><a href="crop-map-generation.html#cb118-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y_2016 =</span> <span class="cn">NA</span>,</span>
<span id="cb118-4"><a href="crop-map-generation.html#cb118-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y_2017 =</span> <span class="cn">NA</span>,</span>
<span id="cb118-5"><a href="crop-map-generation.html#cb118-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y_2018 =</span> <span class="cn">NA</span>,</span>
<span id="cb118-6"><a href="crop-map-generation.html#cb118-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y_2019 =</span> <span class="cn">NA</span>)</span>
<span id="cb118-7"><a href="crop-map-generation.html#cb118-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-8"><a href="crop-map-generation.html#cb118-8" aria-hidden="true" tabindex="-1"></a><span class="co"># fields we need to extract</span></span>
<span id="cb118-9"><a href="crop-map-generation.html#cb118-9" aria-hidden="true" tabindex="-1"></a>field_ids <span class="ot">&lt;-</span> classed_fields<span class="sc">$</span>field_id <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span></code></pre></div>
<p>We will do this with this for loop (note this is bad R-practice. Should be done
with something like <code>pivot_longer</code> (TODO))</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="crop-map-generation.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(c_field_id <span class="cf">in</span> field_ids) {</span>
<span id="cb119-2"><a href="crop-map-generation.html#cb119-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-3"><a href="crop-map-generation.html#cb119-3" aria-hidden="true" tabindex="-1"></a>  crop_rotation <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">field =</span> c_field_id)</span>
<span id="cb119-4"><a href="crop-map-generation.html#cb119-4" aria-hidden="true" tabindex="-1"></a>  crops <span class="ot">&lt;-</span> classed_fields <span class="sc">%&gt;%</span> <span class="fu">filter</span>(field_id <span class="sc">==</span> c_field_id) <span class="sc">%&gt;%</span></span>
<span id="cb119-5"><a href="crop-map-generation.html#cb119-5" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(crop) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>(<span class="at">.name_repair =</span> <span class="st">&quot;minimal&quot;</span>)</span>
<span id="cb119-6"><a href="crop-map-generation.html#cb119-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-7"><a href="crop-map-generation.html#cb119-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(crops) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;y_2016&quot;</span>, <span class="st">&quot;y_2017&quot;</span>, <span class="st">&quot;y_2018&quot;</span>, <span class="st">&quot;y_2019&quot;</span>)</span>
<span id="cb119-8"><a href="crop-map-generation.html#cb119-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-9"><a href="crop-map-generation.html#cb119-9" aria-hidden="true" tabindex="-1"></a>  crop_rotation <span class="ot">&lt;-</span> <span class="fu">cbind</span>(crop_rotation, crops) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb119-10"><a href="crop-map-generation.html#cb119-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-11"><a href="crop-map-generation.html#cb119-11" aria-hidden="true" tabindex="-1"></a>  final_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(final_df, crop_rotation)</span>
<span id="cb119-12"><a href="crop-map-generation.html#cb119-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb119-13"><a href="crop-map-generation.html#cb119-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-14"><a href="crop-map-generation.html#cb119-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the first NA line</span></span>
<span id="cb119-15"><a href="crop-map-generation.html#cb119-15" aria-hidden="true" tabindex="-1"></a>crop_rotation <span class="ot">&lt;-</span> final_df[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb119-16"><a href="crop-map-generation.html#cb119-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-17"><a href="crop-map-generation.html#cb119-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the crop rotation in CSV format</span></span>
<span id="cb119-18"><a href="crop-map-generation.html#cb119-18" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(<span class="at">x =</span> crop_rotation, <span class="at">file =</span> <span class="st">&quot;model_data/input/crop/cs10_crop_rotation.csv&quot;</span>)</span></code></pre></div>
<p>Here is a look at the crop rotation:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="crop-map-generation.html#cb120-1" aria-hidden="true" tabindex="-1"></a>lu_shp <span class="ot">&lt;-</span> <span class="st">&#39;model_data/input/crop/land_with_cr.shp&#39;</span></span>
<span id="cb120-2"><a href="crop-map-generation.html#cb120-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-3"><a href="crop-map-generation.html#cb120-3" aria-hidden="true" tabindex="-1"></a>lu_sf <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(lu_shp)</span>
<span id="cb120-4"><a href="crop-map-generation.html#cb120-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-5"><a href="crop-map-generation.html#cb120-5" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;y_&quot;</span>, <span class="dv">2016</span><span class="sc">:</span><span class="dv">2019</span>)</span>
<span id="cb120-6"><a href="crop-map-generation.html#cb120-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-7"><a href="crop-map-generation.html#cb120-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> years) {</span>
<span id="cb120-8"><a href="crop-map-generation.html#cb120-8" aria-hidden="true" tabindex="-1"></a>  index <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">colnames</span>(lu_sf) <span class="sc">==</span> year)</span>
<span id="cb120-9"><a href="crop-map-generation.html#cb120-9" aria-hidden="true" tabindex="-1"></a>  lu_sf_filt <span class="ot">&lt;-</span> lu_sf[<span class="fu">c</span>(index,<span class="fu">length</span>(lu_sf))]</span>
<span id="cb120-10"><a href="crop-map-generation.html#cb120-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb120-11"><a href="crop-map-generation.html#cb120-11" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> lu_sf_filt) <span class="sc">+</span></span>
<span id="cb120-12"><a href="crop-map-generation.html#cb120-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">get</span>(year)))<span class="sc">+</span></span>
<span id="cb120-13"><a href="crop-map-generation.html#cb120-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill=</span><span class="fu">guide_legend</span>(<span class="at">title=</span>year))<span class="sc">+</span></span>
<span id="cb120-14"><a href="crop-map-generation.html#cb120-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;CS10 Catchment&quot;</span>, <span class="st">&quot;crop rotation&quot;</span>)<span class="sc">+</span></span>
<span id="cb120-15"><a href="crop-map-generation.html#cb120-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;right&quot;</span>)<span class="sc">+</span></span>
<span id="cb120-16"><a href="crop-map-generation.html#cb120-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_blank</span>(), <span class="co">#remove x axis labels</span></span>
<span id="cb120-17"><a href="crop-map-generation.html#cb120-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x=</span><span class="fu">element_blank</span>(), <span class="co">#remove x axis ticks</span></span>
<span id="cb120-18"><a href="crop-map-generation.html#cb120-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y=</span><span class="fu">element_blank</span>(),  <span class="co">#remove y axis labels</span></span>
<span id="cb120-19"><a href="crop-map-generation.html#cb120-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y=</span><span class="fu">element_blank</span>()  <span class="co">#remove y axis ticks</span></span>
<span id="cb120-20"><a href="crop-map-generation.html#cb120-20" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb120-21"><a href="crop-map-generation.html#cb120-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb120-22"><a href="crop-map-generation.html#cb120-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(plot)</span>
<span id="cb120-23"><a href="crop-map-generation.html#cb120-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="_main_files/figure-html/crop_map_croprotgif-.gif" alt="Generated crop map for years 2016-2019" width="672" />
<p class="caption">
(#fig:crop_map_croprotgif)Generated crop map for years 2016-2019
</p>
</div>
</div>
<div id="extrapolating-the-crop-rotation" class="section level3 hasAnchor" number="4.2.4">
<h3><span class="header-section-number">4.2.4</span> Extrapolating the Crop Rotation<a href="crop-map-generation.html#extrapolating-the-crop-rotation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For OPTAIN, the crop rotation needs to span from 1988 to 2020. We currently have
2016 to 2019.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="crop-map-generation.html#cb121-1" aria-hidden="true" tabindex="-1"></a>crop_rotation <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;model_data/input/crop/cs10_crop_rotation.csv&quot;</span>,</span>
<span id="cb121-2"><a href="crop-map-generation.html#cb121-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">show_col_types =</span> F)</span>
<span id="cb121-3"><a href="crop-map-generation.html#cb121-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-4"><a href="crop-map-generation.html#cb121-4" aria-hidden="true" tabindex="-1"></a>rotation <span class="ot">&lt;-</span> crop_rotation <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>field)</span>
<span id="cb121-5"><a href="crop-map-generation.html#cb121-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-6"><a href="crop-map-generation.html#cb121-6" aria-hidden="true" tabindex="-1"></a>crop_rotation_extrapolated <span class="ot">&lt;-</span></span>
<span id="cb121-7"><a href="crop-map-generation.html#cb121-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(crop_rotation,</span>
<span id="cb121-8"><a href="crop-map-generation.html#cb121-8" aria-hidden="true" tabindex="-1"></a>        rotation,</span>
<span id="cb121-9"><a href="crop-map-generation.html#cb121-9" aria-hidden="true" tabindex="-1"></a>        rotation,</span>
<span id="cb121-10"><a href="crop-map-generation.html#cb121-10" aria-hidden="true" tabindex="-1"></a>        rotation,</span>
<span id="cb121-11"><a href="crop-map-generation.html#cb121-11" aria-hidden="true" tabindex="-1"></a>        rotation,</span>
<span id="cb121-12"><a href="crop-map-generation.html#cb121-12" aria-hidden="true" tabindex="-1"></a>        rotation,</span>
<span id="cb121-13"><a href="crop-map-generation.html#cb121-13" aria-hidden="true" tabindex="-1"></a>        rotation,</span>
<span id="cb121-14"><a href="crop-map-generation.html#cb121-14" aria-hidden="true" tabindex="-1"></a>        rotation,</span>
<span id="cb121-15"><a href="crop-map-generation.html#cb121-15" aria-hidden="true" tabindex="-1"></a>        rotation<span class="sc">$</span>y_2016)</span>
<span id="cb121-16"><a href="crop-map-generation.html#cb121-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-17"><a href="crop-map-generation.html#cb121-17" aria-hidden="true" tabindex="-1"></a><span class="co"># set the column names to be in the correct format</span></span>
<span id="cb121-18"><a href="crop-map-generation.html#cb121-18" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(crop_rotation_extrapolated) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;field&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;y_&quot;</span>, <span class="dv">1988</span><span class="sc">:</span><span class="dv">2020</span>))</span></code></pre></div>
</div>
</div>
<div id="merging-crop-rotation-with-buildr-output" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Merging crop rotation with BuildR output<a href="crop-map-generation.html#merging-crop-rotation-with-buildr-output" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The output of <code>SWATbuildR</code> “land.shp” needs to be connected to the newly
generated crop map.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="crop-map-generation.html#cb122-1" aria-hidden="true" tabindex="-1"></a>lu <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;model_data/cs10_setup/optain-cs10/data/vector/land.shp&quot;</span>)</span>
<span id="cb122-2"><a href="crop-map-generation.html#cb122-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-3"><a href="crop-map-generation.html#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="co"># temporary rename to field, for the left join</span></span>
<span id="cb122-4"><a href="crop-map-generation.html#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="co"># unstable, fix! </span><span class="al">TODO</span></span>
<span id="cb122-5"><a href="crop-map-generation.html#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(lu)[<span class="dv">2</span>] <span class="ot">=</span> <span class="st">&quot;field&quot;</span></span>
<span id="cb122-6"><a href="crop-map-generation.html#cb122-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-7"><a href="crop-map-generation.html#cb122-7" aria-hidden="true" tabindex="-1"></a><span class="co"># join the crop rotation and land use layer by their field ID</span></span>
<span id="cb122-8"><a href="crop-map-generation.html#cb122-8" aria-hidden="true" tabindex="-1"></a>lu_cr <span class="ot">&lt;-</span> <span class="fu">left_join</span>(lu, crop_rotation_extrapolated, <span class="at">by =</span> <span class="st">&quot;field&quot;</span> )</span>
<span id="cb122-9"><a href="crop-map-generation.html#cb122-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-10"><a href="crop-map-generation.html#cb122-10" aria-hidden="true" tabindex="-1"></a><span class="co"># reset column name.</span></span>
<span id="cb122-11"><a href="crop-map-generation.html#cb122-11" aria-hidden="true" tabindex="-1"></a><span class="co"># unstable, fix! </span><span class="al">TODO</span></span>
<span id="cb122-12"><a href="crop-map-generation.html#cb122-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(lu_cr)[<span class="dv">2</span>] <span class="ot">=</span> <span class="st">&quot;lu&quot;</span></span>
<span id="cb122-13"><a href="crop-map-generation.html#cb122-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-14"><a href="crop-map-generation.html#cb122-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Write the new shape file</span></span>
<span id="cb122-15"><a href="crop-map-generation.html#cb122-15" aria-hidden="true" tabindex="-1"></a><span class="fu">write_sf</span>(lu_cr, <span class="st">&quot;model_data/input/crop/land_with_cr.shp&quot;</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="writing-swat-input-files.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="landuse.lum-update.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/moritzshore/optain-cs10/edit/main/03-crop_map.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://gitlab.nibio.no/moritzshore/swat-cs10/blob/main/03-crop_map.Rmd",
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
