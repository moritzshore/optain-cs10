<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Model setup with SWATBuildR | OPTAIN CS-10</title>
  <meta name="description" content="A description of the project setup for OPTAIN case study 10" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Model setup with SWATBuildR | OPTAIN CS-10" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A description of the project setup for OPTAIN case study 10" />
  <meta name="github-repo" content="moritzshore/optain-cs10" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Model setup with SWATBuildR | OPTAIN CS-10" />
  
  <meta name="twitter:description" content="A description of the project setup for OPTAIN case study 10" />
  

<meta name="author" content="Moritz Shore, Csilla Farkas" />


<meta name="date" content="2023-05-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="model-parameterization-with-swat-edtior.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.2/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script>
<script src="libs/FlatGeoBuf-3.21.3/fgb.js"></script>
<script src="libs/FlatGeoBuf-3.21.3/flatgeobuf-geojson.min.js"></script>
<script src="libs/chromajs-2.1.0/chroma.min.js"></script>
<link id="bound_sf-1-attachment" rel="attachment" href="libs/bound_sf-0.0.1/bound_sf_layer.fgb"/>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<link id="read_sf(land_path)-KGB-1-attachment" rel="attachment" href="libs/read_sf(land_path)-KGB-0.0.1/read_sf(land_path)-KGB_layer.fgb"/>
<link id="read_sf(land_path)-type-1-attachment" rel="attachment" href="libs/read_sf(land_path)-type-0.0.1/read_sf(land_path)-type_layer.fgb"/>
<link id="channels-type-1-attachment" rel="attachment" href="libs/channels-type-0.0.1/channels-type_layer.fgb"/>
<link id="point_sf-GRAD_P-1-attachment" rel="attachment" href="libs/point_sf-GRAD_P-0.0.1/point_sf-GRAD_P_layer.fgb"/>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="bootstrap.min.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The OPTAIN-CS10 Project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html"><i class="fa fa-check"></i><b>2</b> Model setup with SWATBuildR</a>
<ul>
<li class="chapter" data-level="2.1" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#high-resolution-digital-elevation-model-dem"><i class="fa fa-check"></i><b>2.1</b> High-Resolution Digital Elevation Model (DEM)</a></li>
<li class="chapter" data-level="2.2" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#processing-the-basin-boundary"><i class="fa fa-check"></i><b>2.2</b> Processing the Basin Boundary</a></li>
<li class="chapter" data-level="2.3" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#processing-the-land-layer"><i class="fa fa-check"></i><b>2.3</b> Processing the Land layer</a></li>
<li class="chapter" data-level="2.4" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#processing-the-channels"><i class="fa fa-check"></i><b>2.4</b> Processing the Channels</a></li>
<li class="chapter" data-level="2.5" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#processing-the-dem"><i class="fa fa-check"></i><b>2.5</b> Processing the DEM</a></li>
<li class="chapter" data-level="2.6" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#processing-soil-data"><i class="fa fa-check"></i><b>2.6</b> Processing soil data</a></li>
<li class="chapter" data-level="2.7" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#calculating-land-unit-connectivity"><i class="fa fa-check"></i><b>2.7</b> Calculating land unit connectivity</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#eliminate-land-object-connections-with-small-flow-fractions"><i class="fa fa-check"></i><b>2.7.1</b> Eliminate land object connections with small flow fractions:</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#calculating-channelreservoir-connectivity"><i class="fa fa-check"></i><b>2.8</b> Calculating channel/reservoir connectivity</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#calculating-the-water-object-connectivity"><i class="fa fa-check"></i><b>2.8.1</b> Calculating the water object connectivity</a></li>
<li class="chapter" data-level="2.8.2" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#checking-the-water-objects-for-infinite-loops"><i class="fa fa-check"></i><b>2.8.2</b> Checking the water objects for infinite loops</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#terrain-properties"><i class="fa fa-check"></i><b>2.9</b> Terrain properties</a></li>
<li class="chapter" data-level="2.10" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#generate-land-object-swat-input-tables"><i class="fa fa-check"></i><b>2.10</b> Generate land object SWAT+ input tables</a></li>
<li class="chapter" data-level="2.11" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#generate-water-object-swat-input-tables"><i class="fa fa-check"></i><b>2.11</b> Generate water object SWAT+ input tables</a></li>
<li class="chapter" data-level="2.12" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#build-aquifer-input"><i class="fa fa-check"></i><b>2.12</b> Build aquifer input</a></li>
<li class="chapter" data-level="2.13" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#add-point-source-inputs"><i class="fa fa-check"></i><b>2.13</b> Add point source inputs</a></li>
<li class="chapter" data-level="2.14" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#create-swat-sqlite-database"><i class="fa fa-check"></i><b>2.14</b> Create SWAT+ sqlite database</a>
<ul>
<li class="chapter" data-level="2.14.1" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#write-the-swateditor-project-database"><i class="fa fa-check"></i><b>2.14.1</b> Write the SWAT+Editor project database</a></li>
</ul></li>
<li class="chapter" data-level="2.15" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#todo"><i class="fa fa-check"></i><b>2.15</b> TODO</a></li>
<li class="chapter" data-level="2.16" data-path="model-setup-with-swatbuildr.html"><a href="model-setup-with-swatbuildr.html#link-aquifers-and-channels-with-geomorphic-flow"><i class="fa fa-check"></i><b>2.16</b> Link aquifers and channels with geomorphic flow</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="model-parameterization-with-swat-edtior.html"><a href="model-parameterization-with-swat-edtior.html"><i class="fa fa-check"></i><b>3</b> Model parameterization with SWAT+ Edtior</a>
<ul>
<li class="chapter" data-level="3.1" data-path="model-parameterization-with-swat-edtior.html"><a href="model-parameterization-with-swat-edtior.html#climate-inputs-and-weather-generator"><i class="fa fa-check"></i><b>3.1</b> Climate inputs and weather generator</a></li>
<li class="chapter" data-level="3.2" data-path="model-parameterization-with-swat-edtior.html"><a href="model-parameterization-with-swat-edtior.html#landuse.lum-update"><i class="fa fa-check"></i><b>3.2</b> Landuse.lum update</a></li>
<li class="chapter" data-level="3.3" data-path="model-parameterization-with-swat-edtior.html"><a href="model-parameterization-with-swat-edtior.html#channel-parameters-revised"><i class="fa fa-check"></i><b>3.3</b> Channel parameters revised</a></li>
<li class="chapter" data-level="3.4" data-path="model-parameterization-with-swat-edtior.html"><a href="model-parameterization-with-swat-edtior.html#crop-parameters-verified"><i class="fa fa-check"></i><b>3.4</b> Crop parameters verified</a></li>
<li class="chapter" data-level="3.5" data-path="model-parameterization-with-swat-edtior.html"><a href="model-parameterization-with-swat-edtior.html#soil-physical-parameters-in-final-form"><i class="fa fa-check"></i><b>3.5</b> Soil physical parameters in final form</a></li>
<li class="chapter" data-level="3.6" data-path="model-parameterization-with-swat-edtior.html"><a href="model-parameterization-with-swat-edtior.html#soil-chemical-parameters-in-final-form"><i class="fa fa-check"></i><b>3.6</b> Soil chemical parameters in final form</a></li>
<li class="chapter" data-level="3.7" data-path="model-parameterization-with-swat-edtior.html"><a href="model-parameterization-with-swat-edtior.html#impoundment-parameters-defined"><i class="fa fa-check"></i><b>3.7</b> Impoundment parameters defined</a></li>
<li class="chapter" data-level="3.8" data-path="model-parameterization-with-swat-edtior.html"><a href="model-parameterization-with-swat-edtior.html#water-diversions-defined"><i class="fa fa-check"></i><b>3.8</b> Water diversions defined</a></li>
<li class="chapter" data-level="3.9" data-path="model-parameterization-with-swat-edtior.html"><a href="model-parameterization-with-swat-edtior.html#point-sources-parameters-added"><i class="fa fa-check"></i><b>3.9</b> Point sources parameters added</a></li>
<li class="chapter" data-level="3.10" data-path="model-parameterization-with-swat-edtior.html"><a href="model-parameterization-with-swat-edtior.html#tile-drainage-parameters-defined"><i class="fa fa-check"></i><b>3.10</b> Tile drainage parameters defined</a></li>
<li class="chapter" data-level="3.11" data-path="model-parameterization-with-swat-edtior.html"><a href="model-parameterization-with-swat-edtior.html#atmospheric-deposition-defined"><i class="fa fa-check"></i><b>3.11</b> Atmospheric deposition defined</a></li>
<li class="chapter" data-level="3.12" data-path="model-parameterization-with-swat-edtior.html"><a href="model-parameterization-with-swat-edtior.html#additional-settings-verified"><i class="fa fa-check"></i><b>3.12</b> Additional settings verified</a></li>
</ul></li>
<li class="part"><span><b>I Act one</b></span></li>
<li class="chapter" data-level="4" data-path="a-chapter.html"><a href="a-chapter.html"><i class="fa fa-check"></i><b>4</b> A chapter</a></li>
<li class="chapter" data-level="5" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html"><i class="fa fa-check"></i><b>5</b> Footnotes and citations</a>
<ul>
<li class="chapter" data-level="5.1" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html#footnotes"><i class="fa fa-check"></i><b>5.1</b> Footnotes</a></li>
<li class="chapter" data-level="5.2" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html#citations"><i class="fa fa-check"></i><b>5.2</b> Citations</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="blocks.html"><a href="blocks.html"><i class="fa fa-check"></i><b>6</b> Blocks</a>
<ul>
<li class="chapter" data-level="6.1" data-path="blocks.html"><a href="blocks.html#equations"><i class="fa fa-check"></i><b>6.1</b> Equations</a></li>
<li class="chapter" data-level="6.2" data-path="blocks.html"><a href="blocks.html#theorems-and-proofs"><i class="fa fa-check"></i><b>6.2</b> Theorems and proofs</a></li>
<li class="chapter" data-level="6.3" data-path="blocks.html"><a href="blocks.html#callout-blocks"><i class="fa fa-check"></i><b>6.3</b> Callout blocks</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="sharing-your-book.html"><a href="sharing-your-book.html"><i class="fa fa-check"></i><b>7</b> Sharing your book</a>
<ul>
<li class="chapter" data-level="7.1" data-path="sharing-your-book.html"><a href="sharing-your-book.html#publishing"><i class="fa fa-check"></i><b>7.1</b> Publishing</a></li>
<li class="chapter" data-level="7.2" data-path="sharing-your-book.html"><a href="sharing-your-book.html#pages"><i class="fa fa-check"></i><b>7.2</b> 404 pages</a></li>
<li class="chapter" data-level="7.3" data-path="sharing-your-book.html"><a href="sharing-your-book.html#metadata-for-sharing"><i class="fa fa-check"></i><b>7.3</b> Metadata for sharing</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">OPTAIN CS-10</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model-setup-with-swatbuildr" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Model setup with SWATBuildR<a href="model-setup-with-swatbuildr.html#model-setup-with-swatbuildr" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The OPTAIN project is using the COCOA approach <span class="citation">Schürz et al. (<a href="#ref-schürz2022" role="doc-biblioref">2022</a>)</span> and as such, needs to use the <code>SWATBuildR</code> package to calculate the connectivity between HRUs in the catchment. This chapter covers this process.</p>
<p>We will define the location of our project here:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="model-setup-with-swatbuildr.html#cb1-1" aria-hidden="true" tabindex="-1"></a>project_path <span class="ot">&lt;-</span> <span class="st">&#39;model_data/cs10_setup&#39;</span></span></code></pre></div>
<p>And give it the name:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="model-setup-with-swatbuildr.html#cb2-1" aria-hidden="true" tabindex="-1"></a>project_name <span class="ot">&lt;-</span> <span class="st">&#39;optain-cs10&#39;</span></span></code></pre></div>
<p>Much of this documentation has been lost to time.</p>
<p>We will need the following packages for this chapter:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="model-setup-with-swatbuildr.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(mapview)</span>
<span id="cb3-2"><a href="model-setup-with-swatbuildr.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(sf)</span>
<span id="cb3-3"><a href="model-setup-with-swatbuildr.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(raster)</span></code></pre></div>
<div id="high-resolution-digital-elevation-model-dem" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> High-Resolution Digital Elevation Model (DEM)<a href="model-setup-with-swatbuildr.html#high-resolution-digital-elevation-model-dem" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The high-resolution DEM is the basis for calculation of water connectivity, among other things. Most of the documentation of the creation of the DEM for CS10 has been lost to the sands of time. All we know is that it is located here:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="model-setup-with-swatbuildr.html#cb4-1" aria-hidden="true" tabindex="-1"></a>dem_path <span class="ot">&lt;-</span> <span class="st">&quot;model_data/input/elevation/dtm3_ns_v5.tif&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="model-setup-with-swatbuildr.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">raster</span>(dem_path), <span class="at">main =</span> <span class="st">&quot;CS10 DEM, UTM32N&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/plotdemraster-1.png" width="672" /></p>
<p>To our knowledge, it has a 10 meter resolution. 1 meter resolution was available but there seems to have been issues with using it. It is definitely preferable to use the 1m DEM as certain important information can be lost with (max allowed resolution) of 10m.</p>
<div class="figure">
<img src="figures/1mdemvs10.png" alt="" />
<p class="caption">An example of a hydrologically effective landscape features being lost due to coarse DEM resolution. From<span class="citation">(<a href="#ref-schürz2022" role="doc-biblioref">Schürz et al. 2022</a>)</span></p>
</div>
</div>
<div id="processing-the-basin-boundary" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Processing the Basin Boundary<a href="model-setup-with-swatbuildr.html#processing-the-basin-boundary" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The basin boundary has presumably been created using the defined outlet point of the catchment and the DEM. No more is currently known about this file other than that it is located here:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="model-setup-with-swatbuildr.html#cb6-1" aria-hidden="true" tabindex="-1"></a>bound_path <span class="ot">&lt;-</span> <span class="st">&quot;model_data/input/shape/cs10_basin.shp&quot;</span></span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-2ba2f07d9de09528a13c" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-2ba2f07d9de09528a13c">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addFlatGeoBuf","args":["bound_sf","bound_sf",null,true,"CS10 Basin",{"radius":6,"stroke":true,"color":"#000000","weight":0.5,"opacity":0.9,"fill":true,"fillColor":"#FFA500","fillOpacity":0.2},{"className":"","pane":"polygon"},"mapview-popup",{"radius":{"to":[3,15],"from":[3,15]},"weight":{"to":[1,10],"from":[1,10]},"opacity":{"to":[0,1],"from":[0,1]},"fillOpacity":{"to":[0,1],"from":[0,1]}}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[10.8388608505649,59.59462555341,10.9715776438155,59.722569973813,true,"bound_sf","Zoom to bound_sf","<strong> bound_sf <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"bound_sf",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#FFA500"],"labels":["CS10 Basin"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"bound_sf"}]}],"fitBounds":[59.59462555341,10.8388608505649,59.722569973813,10.9715776438155,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p>We will begin using the <code>SWATBuildR</code> Package by initializing its functions. (Note: this package is currently unfinished, which is why this step is necessary).</p>
<p>The following code and commentary is from version <code>1.5.12</code>, written by Christoph Schuerz.</p>
<p>Another note: there are currently issues with White box which are being resolved.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="model-setup-with-swatbuildr.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;model_data/swat_buildR/init.R&#39;</span>)</span></code></pre></div>
<p>BuildR recommends all layers to be in the same CRS, if we set <code>project_layer</code> to <code>FALSE</code>, it will throw an error when this is not the case:</p>
<blockquote>
<p>The input layers might be in different coordinate reference systems (CRS). It is recommended to project all layers to the same CRS and check them before using them as model inputs. The model setup process checks if the layer CRSs differ from the one of the basin boundary. By setting ‘proj_layer &lt;- TRUE’ the layer is projected if the CRS is different. If FALSE different CRS trigger an error.</p>
</blockquote>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="model-setup-with-swatbuildr.html#cb8-1" aria-hidden="true" tabindex="-1"></a>project_layer <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span></code></pre></div>
<p>We read in and check the basin boundary and run some checks</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="model-setup-with-swatbuildr.html#cb9-1" aria-hidden="true" tabindex="-1"></a>bound <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(bound_path) <span class="sc">%&gt;%</span> <span class="fu">select</span>()</span>
<span id="cb9-2"><a href="model-setup-with-swatbuildr.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set_proj_crs</span>(bound, data_path)</span>
<span id="cb9-3"><a href="model-setup-with-swatbuildr.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">check_polygon_topology</span>(<span class="at">layer =</span> bound, <span class="at">data_path =</span>  data_path, <span class="at">label =</span> <span class="st">&#39;basin&#39;</span>, </span>
<span id="cb9-4"><a href="model-setup-with-swatbuildr.html#cb9-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">n_feat =</span> <span class="dv">1</span>, <span class="at">checks =</span> <span class="fu">c</span>(F,T,T,T,F,F,F,F))</span></code></pre></div>
<pre><code>## Running topological checks and modifications for the basin layer:
## 
## Analyzing basin layer for specific number of features...
##   ✔  Number of features correct.
## Analyzing basin layer for MULTIPOLYGON features...
##   ✔  No MULTIPOLYGON features identified.
## Analyzing basin layer for invalid features...
##   ✔  No invalid features identified.
## 
## 
##   ✔  All checks successful! Saving checked basin layer.</code></pre>
</div>
<div id="processing-the-land-layer" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Processing the Land layer<a href="model-setup-with-swatbuildr.html#processing-the-land-layer" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Our land layer is located here:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="model-setup-with-swatbuildr.html#cb11-1" aria-hidden="true" tabindex="-1"></a>land_path <span class="ot">&lt;-</span> <span class="st">&quot;model_data/input/land/CS10_LU.shp&quot;</span></span></code></pre></div>
<p>Documentation on its creation does not exist.</p>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-d4819a5e30ac579c0b13" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-d4819a5e30ac579c0b13">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":true,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addFlatGeoBuf","args":["read_sf(land_path)-KGB","read_sf(land_path) - KGB",null,true,"KGB",{"radius":6,"stroke":true,"color":"#333333","weight":0.5,"opacity":0.9,"fill":true,"fillColor":null,"fillOpacity":0.6},{"className":""},"mapview-popup",{"radius":{"to":[3,15],"from":[3,15]},"weight":{"to":[1,10],"from":[1,10]},"opacity":{"to":[0,1],"from":[0,1]},"fillOpacity":{"to":[0,1],"from":[0,1]}}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[10.8388608497841,59.5946255529268,10.9715776438156,59.7225699736982,true,"read_sf(land_path) - KGB","Zoom to read_sf(land_path) - KGB","<strong> read_sf(land_path) - KGB <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"read_sf(land_path) - KGB",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]}],"fitBounds":[59.5946255529268,10.8388608497841,59.7225699736982,10.9715776438156,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p>Interactive land use map of CS10 by Farm ID</p>
<p>We had an issue with the classification of the land uses. For the OPTAIN project, all agricultural fields must have a unique ID, and our land uses only had the ID of the given farm <code>KGB</code> (which had many different fields). To remedy this, new IDs were generated with the format <code>a_###f_#</code> where <code>a_</code> represents the farm, and <code>f_</code> represents the respective field of that farm. The farm names needed to be shortened because the SWAT+ model often cannot handle long ID names (longer than 16 characters)</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="model-setup-with-swatbuildr.html#cb12-1" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;model_data/farm_id/a_f_id.csv&quot;</span>, <span class="at">show_col_types =</span> F) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   KGB      type_fr sp_id field_ID
##   &lt;chr&gt;    &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;   
## 1 213/8/1  a_084       1 a_084f_1
## 2 213/7/6  a_083       2 a_083f_1
## 3 213/7/6  a_083       3 a_083f_2
## 4 213/7/4  a_082       4 a_082f_1
## 5 213/65/1 a_081       5 a_081f_1
## 6 213/65/1 a_081       6 a_081f_2</code></pre>
<p>This was done in a simple QGIS workflow of dissolving by farm, splitting from single part to multipart, and then adding an iterating ID per farm field. This workflow could be replicated in R, and then shown here. It is under consideration…</p>
<p>This is our map with the new <code>type</code> IDs:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="model-setup-with-swatbuildr.html#cb14-1" aria-hidden="true" tabindex="-1"></a>lu_map <span class="ot">&lt;-</span> <span class="fu">mapview</span>(<span class="fu">read_sf</span>(land_path), <span class="at">zcol =</span> <span class="st">&quot;type&quot;</span>, <span class="at">legend =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-2"><a href="model-setup-with-swatbuildr.html#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="model-setup-with-swatbuildr.html#cb14-3" aria-hidden="true" tabindex="-1"></a>lu_map</span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1ca4b0e35d610bacbdbb" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-1ca4b0e35d610bacbdbb">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":true,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addFlatGeoBuf","args":["read_sf(land_path)-type","read_sf(land_path) - type",null,true,"type",{"radius":6,"stroke":true,"color":"#333333","weight":0.5,"opacity":0.9,"fill":true,"fillColor":null,"fillOpacity":0.6},{"className":""},"mapview-popup",{"radius":{"to":[3,15],"from":[3,15]},"weight":{"to":[1,10],"from":[1,10]},"opacity":{"to":[0,1],"from":[0,1]},"fillOpacity":{"to":[0,1],"from":[0,1]}}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[10.8388608497841,59.5946255529268,10.9715776438156,59.7225699736982,true,"read_sf(land_path) - type","Zoom to read_sf(land_path) - type","<strong> read_sf(land_path) - type <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"read_sf(land_path) - type",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]}],"fitBounds":[59.5946255529268,10.8388608497841,59.7225699736982,10.9715776438156,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p>interactive land use map of CS10 by Field ID</p>
<p>BuildR will now run some checks on our land layer.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="model-setup-with-swatbuildr.html#cb15-1" aria-hidden="true" tabindex="-1"></a>land <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(land_path) <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="model-setup-with-swatbuildr.html#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">check_layer_attributes</span>(., <span class="at">type_to_lower =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="model-setup-with-swatbuildr.html#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">check_project_crs</span>(<span class="at">layer =</span> ., <span class="at">data_path =</span>  data_path, <span class="at">proj_layer =</span> project_layer, </span>
<span id="cb15-4"><a href="model-setup-with-swatbuildr.html#cb15-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">label =</span> <span class="st">&#39;land&#39;</span>, <span class="at">type =</span> <span class="st">&#39;vector&#39;</span>)</span>
<span id="cb15-5"><a href="model-setup-with-swatbuildr.html#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="model-setup-with-swatbuildr.html#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">check_polygon_topology</span>(<span class="at">layer =</span> land, <span class="at">data_path =</span>  data_path, <span class="at">label =</span> <span class="st">&#39;land&#39;</span>, </span>
<span id="cb15-7"><a href="model-setup-with-swatbuildr.html#cb15-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">area_fct =</span>  <span class="fl">0.00</span>, <span class="at">cvrg_frc =</span> <span class="fl">99.9</span>,</span>
<span id="cb15-8"><a href="model-setup-with-swatbuildr.html#cb15-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">checks =</span> <span class="fu">c</span>(T,F,T,T,T,T,T,T))</span></code></pre></div>
<pre><code>## Running topological checks and modifications for the land layer:
## 
## Intersection of land layer with basin boundary layer...
##   ✔  Intersection completed.
## Analyzing land layer for MULTIPOLYGON features...
##   ✔  No MULTIPOLYGON features identified.
## Analyzing land layer for invalid features...
##   ✔  No invalid features identified.
## Analyzing land layer for very small feature areas...
##   ✔  No small features identified.
## Analyzing land layer for features covered by other features...
##   ✔  No covered features identified.
## Analyzing land layer for overlapping features...
##   ✔  No overlapping features identified.
## Analyzing land layer coverage with basin boundary...
##   ✔  Layer coverage OK.
## 
## 
##   ✔  All checks successful! Saving intersected land layer.</code></pre>
<p>BuildR splits the land layer into HRU (land) and reservoir (water) objects</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="model-setup-with-swatbuildr.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">split_land_layer</span>(data_path)</span></code></pre></div>
</div>
<div id="processing-the-channels" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Processing the Channels<a href="model-setup-with-swatbuildr.html#processing-the-channels" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>No documentation exists on the source of the channels layer, all we know is that it is located here:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="model-setup-with-swatbuildr.html#cb18-1" aria-hidden="true" tabindex="-1"></a>channel_path <span class="ot">&lt;-</span> <span class="st">&#39;model_data/input/line/cs10_channels.shp&#39;</span></span>
<span id="cb18-2"><a href="model-setup-with-swatbuildr.html#cb18-2" aria-hidden="true" tabindex="-1"></a>channels <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(channel_path) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">&quot;type&quot;</span>)</span>
<span id="cb18-3"><a href="model-setup-with-swatbuildr.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(channels)</span></code></pre></div>
<p><img src="_main_files/figure-html/channel_plot-1.png" width="672" /></p>
<p>BuildR runs some checks:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="model-setup-with-swatbuildr.html#cb19-1" aria-hidden="true" tabindex="-1"></a> channel <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(channel_path) <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="model-setup-with-swatbuildr.html#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">check_layer_attributes</span>(., <span class="at">type_to_lower =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="model-setup-with-swatbuildr.html#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">check_project_crs</span>(<span class="at">layer =</span> ., <span class="at">data_path =</span>  data_path,</span>
<span id="cb19-4"><a href="model-setup-with-swatbuildr.html#cb19-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">proj_layer =</span> project_layer, </span>
<span id="cb19-5"><a href="model-setup-with-swatbuildr.html#cb19-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">label =</span> <span class="st">&#39;channel&#39;</span>, <span class="at">type =</span> <span class="st">&#39;vector&#39;</span>)</span>
<span id="cb19-6"><a href="model-setup-with-swatbuildr.html#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="model-setup-with-swatbuildr.html#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="fu">check_line_topology</span>(<span class="at">layer =</span> channel, <span class="at">data_path =</span> data_path,</span>
<span id="cb19-8"><a href="model-setup-with-swatbuildr.html#cb19-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">label =</span> <span class="st">&#39;channel&#39;</span>, <span class="at">length_fct =</span> <span class="dv">0</span>, <span class="at">can_cross =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Running topological checks and modifications for the channel layer:
## 
## Intersection of channel layer with basin boundary layer...
##   ✔  Intersection completed.
## Analyzing channel layer for MULTILINE features...
##   ✔  No MULTILINE features identified.
## Analyzing channel layer for invalid features...
##   ✔  No invalid features identified.
## Analyzing channel layer for very short feature lengths...
##   ✔  No small features identified.
## Analyzing channel layer for crossing features...
##   ✔  No crossing features identified.
## 
##   ✔  All checks successful! Saving intersected channel layer.</code></pre>
<p>And gives this output:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="model-setup-with-swatbuildr.html#cb21-1" aria-hidden="true" tabindex="-1"></a>channels <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;model_data/cs10_setup/optain-cs10/data/vector/channel.shp&quot;</span>)</span>
<span id="cb21-2"><a href="model-setup-with-swatbuildr.html#cb21-2" aria-hidden="true" tabindex="-1"></a>channel_map <span class="ot">&lt;-</span> <span class="fu">mapview</span>(channels, <span class="at">zcol =</span> <span class="st">&quot;type&quot;</span>)</span>
<span id="cb21-3"><a href="model-setup-with-swatbuildr.html#cb21-3" aria-hidden="true" tabindex="-1"></a>bound_map<span class="sc">+</span>channel_map</span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-8e0bdd87fc17f8c7d6f5" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-8e0bdd87fc17f8c7d6f5">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addFlatGeoBuf","args":["bound_sf","bound_sf",null,true,"CS10 Basin",{"radius":6,"stroke":true,"color":"#000000","weight":0.5,"opacity":0.9,"fill":true,"fillColor":"#FFA500","fillOpacity":0.2},{"className":"","pane":"polygon"},"mapview-popup",{"radius":{"to":[3,15],"from":[3,15]},"weight":{"to":[1,10],"from":[1,10]},"opacity":{"to":[0,1],"from":[0,1]},"fillOpacity":{"to":[0,1],"from":[0,1]}}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[10.8388608505649,59.59462555341,10.9715776438155,59.722569973813,true,"bound_sf","Zoom to bound_sf","<strong> bound_sf <\/strong>","bottomright"]},{"method":"addLegend","args":[{"colors":["#FFA500"],"labels":["CS10 Basin"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"bound_sf"}]},{"method":"createMapPane","args":["line",430]},{"method":"addFlatGeoBuf","args":["channels-type","channels - type",null,true,"type",{"radius":6,"stroke":true,"color":null,"weight":2,"opacity":0.9,"fill":false,"fillColor":null,"fillOpacity":1},{"className":"","pane":"line"},"mapview-popup",{"radius":{"to":[3,15],"from":[3,15]},"weight":{"to":[1,10],"from":[1,10]},"opacity":{"to":[0,1],"from":[0,1]},"fillOpacity":{"to":[0,1],"from":[0,1]}}]},{"method":"addHomeButton","args":[10.8413909371941,59.5954669878296,10.9651817579041,59.7197753391751,true,"channels - type","Zoom to channels - type","<strong> channels - type <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],["bound_sf","channels - type"],{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#4B0055","#FDE333"],"labels":["cha","sub"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"channels - type","extra":null,"layerId":null,"className":"info legend","group":"channels - type"}]},{"method":"addHomeButton","args":[10.8388608505649,59.59462555341,10.9715776438155,59.722569973813,true,null,"Zoom to full extent","<strong>Zoom full<\/strong>","bottomleft"]}],"fitBounds":[59.59462555341,10.8388608505649,59.722569973813,10.9715776438155,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p>BuildR then checks the connectivity between the channels and reservoirs. For this we need to define our <code>id_cha_out</code> and <code>id_res_out</code>.</p>
<blockquote>
<p>Variable <code>id_cha_out</code> sets the outlet point of the catchment. Either define a channel OR a reservoir as the final outlet. If channel then assign <code>id_cha_out</code> with the respective id from the channel layer. If reservoir then assign the respective id from the land layer to id_res_out, otherwise leave as <code>NULL</code></p>
</blockquote>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="model-setup-with-swatbuildr.html#cb22-1" aria-hidden="true" tabindex="-1"></a>id_cha_out <span class="ot">&lt;-</span> <span class="dv">37</span></span>
<span id="cb22-2"><a href="model-setup-with-swatbuildr.html#cb22-2" aria-hidden="true" tabindex="-1"></a>id_res_out <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
<p>Running connectivity checks between channels and reservoirs:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="model-setup-with-swatbuildr.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_cha_res_connectivity</span>(data_path, id_cha_out, id_res_out)</span></code></pre></div>
<pre><code>## Preparing channel and reservoir features...
##   ✔  OK!
## Analyzing connectivity of water object network...
##   ✔  No disconnected channels identified.
##   ✔  No disconnected reservoirs identified.
## 
## 
##   ✔  Water object connectivity check successful!</code></pre>
<p>Checking if any defined channel ids for drainage from land objects do not exist</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="model-setup-with-swatbuildr.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_land_drain_ids</span>(data_path)</span></code></pre></div>
</div>
<div id="processing-the-dem" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Processing the DEM<a href="model-setup-with-swatbuildr.html#processing-the-dem" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>BuildR loads and checks the DEM, and saves it.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="model-setup-with-swatbuildr.html#cb26-1" aria-hidden="true" tabindex="-1"></a>dem <span class="ot">&lt;-</span> <span class="fu">rast</span>(dem_path) <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="model-setup-with-swatbuildr.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">check_project_crs</span>(<span class="at">layer =</span> ., <span class="at">data_path =</span>  data_path, <span class="at">proj_layer =</span> project_layer, </span>
<span id="cb26-3"><a href="model-setup-with-swatbuildr.html#cb26-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">label =</span> <span class="st">&#39;dem&#39;</span>, <span class="at">type =</span> <span class="st">&#39;raster&#39;</span>)</span>
<span id="cb26-4"><a href="model-setup-with-swatbuildr.html#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="model-setup-with-swatbuildr.html#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">check_raster_coverage</span>(<span class="at">rst =</span> dem, <span class="at">vct_layer =</span> <span class="st">&#39;land&#39;</span>, <span class="at">data_path =</span> data_path, </span>
<span id="cb26-6"><a href="model-setup-with-swatbuildr.html#cb26-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">label =</span> <span class="st">&#39;dem&#39;</span>, <span class="at">cov_frc =</span> <span class="fl">0.95</span>)</span>
<span id="cb26-7"><a href="model-setup-with-swatbuildr.html#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="model-setup-with-swatbuildr.html#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="fu">save_dem_slope_raster</span>(dem, data_path)</span></code></pre></div>
<pre><code>## clip_raster_to_polygon - Elapsed Time (excluding I/O): 1min 23.521s
## slope - Elapsed Time (excluding I/O): 0.531s</code></pre>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="processing-soil-data" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Processing soil data<a href="model-setup-with-swatbuildr.html#processing-soil-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Our soil map is located here:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="model-setup-with-swatbuildr.html#cb29-1" aria-hidden="true" tabindex="-1"></a>soil_layer_path  <span class="ot">&lt;-</span> <span class="st">&#39;model_data/input/soil/soil_layer.tif&#39;</span></span></code></pre></div>
<p>No documentation exists on its creation.</p>
<p><img src="_main_files/figure-html/soilmapraster-1.png" width="672" /></p>
<p>The soil data and lookup path are located here:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="model-setup-with-swatbuildr.html#cb30-1" aria-hidden="true" tabindex="-1"></a>soil_lookup_path <span class="ot">&lt;-</span> <span class="st">&#39;model_data/input/soil/soil_lookup.csv&#39;</span></span>
<span id="cb30-2"><a href="model-setup-with-swatbuildr.html#cb30-2" aria-hidden="true" tabindex="-1"></a>soil_data_path   <span class="ot">&lt;-</span> <span class="st">&#39;model_data/input/soil/UserSoil_Krakstad.csv&#39;</span></span></code></pre></div>
<p>Not much documentation exists here either. Some can be found in the excel sheet:</p>
<pre><code>## [1] &quot;model_data/input/soil/swatsoil2.xlsx&quot;</code></pre>
<p>BuildR reads in the soil data, performs checks, processes, and saves.</p>
<p>NOTE: THIS IS CURRENTLY BROKEN, WITH ERROR MESSAGE:</p>
<blockquote>
<p>Warning: Cannot find coordinate operations from <code>EPSG:2583</code> [“unnamed”,EDATUM[“”], CS[Cartesian,2], AXIS[“(E)”, east, ORDER[1], LENGTHUNIT[“unknown”, 1]], AXIS[“(N)”, north, ORDER[2], LENGTHUNIT[“unknown”, 1]]]’ (GDAL error 6) Error: [project] Cannot do this transformation</p>
</blockquote>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="model-setup-with-swatbuildr.html#cb32-1" aria-hidden="true" tabindex="-1"></a>soil <span class="ot">&lt;-</span> <span class="fu">rast</span>(soil_layer_path) <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="model-setup-with-swatbuildr.html#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">check_project_crs</span>(<span class="at">layer =</span> ., <span class="at">data_path =</span>  data_path, <span class="at">proj_layer =</span> project_layer, </span>
<span id="cb32-3"><a href="model-setup-with-swatbuildr.html#cb32-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">label =</span> <span class="st">&#39;soil&#39;</span>, <span class="at">type =</span> <span class="st">&#39;raster&#39;</span>)</span>
<span id="cb32-4"><a href="model-setup-with-swatbuildr.html#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">check_raster_coverage</span>(<span class="at">rst =</span> soil, <span class="at">vct_layer =</span> <span class="st">&#39;hru&#39;</span>, <span class="at">data_path =</span> data_path, </span>
<span id="cb32-5"><a href="model-setup-with-swatbuildr.html#cb32-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">label =</span> <span class="st">&#39;soil&#39;</span>, <span class="at">cov_frc =</span> <span class="fl">0.75</span>)</span>
<span id="cb32-6"><a href="model-setup-with-swatbuildr.html#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># BROKEN</span></span>
<span id="cb32-7"><a href="model-setup-with-swatbuildr.html#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co">#save_soil_raster(soil, data_path)</span></span>
<span id="cb32-8"><a href="model-setup-with-swatbuildr.html#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="model-setup-with-swatbuildr.html#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># added soil.tif from back when it used to work</span></span></code></pre></div>
<p>BuildR then generates a table with aggregated elevation, slope, soil for HRU units.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="model-setup-with-swatbuildr.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># waiting on soil fix. </span></span>
<span id="cb33-2"><a href="model-setup-with-swatbuildr.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co">#aggregate_hru_dem_soil(data_path)</span></span></code></pre></div>
<p>Read and prepare the soil input tables and a soil/hru id table and write them into <code>data_path/tables.sqlite</code></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="model-setup-with-swatbuildr.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#build_soil_data(soil_lookup_path, soil_data_path, data_path)</span></span></code></pre></div>
</div>
<div id="calculating-land-unit-connectivity" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> Calculating land unit connectivity<a href="model-setup-with-swatbuildr.html#calculating-land-unit-connectivity" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Preparing raster layers based on the DEM and the surface channel objects that will be used in the calculation of the land object connectivity.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="model-setup-with-swatbuildr.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#prepare_terrain_land(data_path)</span></span></code></pre></div>
<p>The connection of each land object to neighboring land and water objects is calculated based on the flow accumulation and the D8 flow pointer along the object edge</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="model-setup-with-swatbuildr.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate_land_connectivity(data_path)</span></span></code></pre></div>
<div id="eliminate-land-object-connections-with-small-flow-fractions" class="section level3 hasAnchor" number="2.7.1">
<h3><span class="header-section-number">2.7.1</span> Eliminate land object connections with small flow fractions:<a href="model-setup-with-swatbuildr.html#eliminate-land-object-connections-with-small-flow-fractions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For each land object the flow fractions are compared to connection with the largest flow fraction of that land object. Connections are removed if their fraction is smaller than <code>frc_thres</code> relative to the largest one.</p>
<p>This is necessary to:</p>
<ol style="list-style-type: decimal">
<li><p>Simplify the connectivity network</p></li>
<li><p>To reduce the risk of circuit routing between land objects. Circuit routing will be checked.</p></li>
</ol>
<p>If an error due to circuit routing is triggered, then ‘frc_thres’ must be increased to remove connectivities that may cause this issue.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="model-setup-with-swatbuildr.html#cb37-1" aria-hidden="true" tabindex="-1"></a>frc_thres <span class="ot">&lt;-</span> <span class="fl">0.3</span></span></code></pre></div>
<p>The remaining land object connections are analyzed for infinite loop routing. For each land unit the connections are propagated and checked if the end up again in the same unit.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="model-setup-with-swatbuildr.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#reduce_land_connections(data_path, frc_thres) %&gt;% </span></span>
<span id="cb38-2"><a href="model-setup-with-swatbuildr.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  check_infinite_loops(., data_path, &#39;Land&#39;)</span></span></code></pre></div>
<p>If infinite loops were identified this routine tries to resolve the issues by selectively removing connections between land units in order to get rid of all infinite loops.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="model-setup-with-swatbuildr.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># resolve_loop_issues(data_path)</span></span></code></pre></div>
</div>
</div>
<div id="calculating-channelreservoir-connectivity" class="section level2 hasAnchor" number="2.8">
<h2><span class="header-section-number">2.8</span> Calculating channel/reservoir connectivity<a href="model-setup-with-swatbuildr.html#calculating-channelreservoir-connectivity" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="calculating-the-water-object-connectivity" class="section level3 hasAnchor" number="2.8.1">
<h3><span class="header-section-number">2.8.1</span> Calculating the water object connectivity<a href="model-setup-with-swatbuildr.html#calculating-the-water-object-connectivity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>the function returns the <code>cha</code> and <code>res</code> <code>con_out</code> tables in SWAT+ database format and writes them into <code>data_path/tables.sqlite</code></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="model-setup-with-swatbuildr.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#build_water_object_connectivity(data_path)</span></span></code></pre></div>
</div>
<div id="checking-the-water-objects-for-infinite-loops" class="section level3 hasAnchor" number="2.8.2">
<h3><span class="header-section-number">2.8.2</span> Checking the water objects for infinite loops<a href="model-setup-with-swatbuildr.html#checking-the-water-objects-for-infinite-loops" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>From the cha_res_con_out tables id_from/id_to links are generated and checked for infinite loop routing.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="model-setup-with-swatbuildr.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#prepare_water_links(data_path) %&gt;% </span></span>
<span id="cb41-2"><a href="model-setup-with-swatbuildr.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  check_infinite_loops(., data_path, &#39;Water&#39;, Inf)</span></span></code></pre></div>
</div>
</div>
<div id="terrain-properties" class="section level2 hasAnchor" number="2.9">
<h2><span class="header-section-number">2.9</span> Terrain properties<a href="model-setup-with-swatbuildr.html#terrain-properties" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Calculate terrain properties such as elevation, slope, catchment area, channel width/depth for channel and reservoir objects and write them into <code>data_path/tables.sqlite</code></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="model-setup-with-swatbuildr.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#prepare_terrain_water(data_path)</span></span></code></pre></div>
</div>
<div id="generate-land-object-swat-input-tables" class="section level2 hasAnchor" number="2.10">
<h2><span class="header-section-number">2.10</span> Generate land object SWAT+ input tables<a href="model-setup-with-swatbuildr.html#generate-land-object-swat-input-tables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Build the <code>landuse.lum</code> and a landuse/hru id table and write them into <code>data_path/tables.sqlite</code></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="model-setup-with-swatbuildr.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#build_landuse(data_path)</span></span></code></pre></div>
<p>Build the HRU SWAT+ input files and write them into <code>data_path/tables.sqlite</code></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="model-setup-with-swatbuildr.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#build_hru_input(data_path)</span></span></code></pre></div>
<p>Add wetlands to the HRUs and build the wetland input files and write them into <code>data_path/tables.sqlite</code></p>
<p>(TODO fix this!)</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="model-setup-with-swatbuildr.html#cb45-1" aria-hidden="true" tabindex="-1"></a>wetland_landuse <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;wehb&#39;</span>, <span class="st">&#39;wetf&#39;</span>, <span class="st">&#39;wetl&#39;</span>, <span class="st">&#39;wetn&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="model-setup-with-swatbuildr.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#add_wetlands(data_path, wetland_landuse)</span></span></code></pre></div>
</div>
<div id="generate-water-object-swat-input-tables" class="section level2 hasAnchor" number="2.11">
<h2><span class="header-section-number">2.11</span> Generate water object SWAT+ input tables<a href="model-setup-with-swatbuildr.html#generate-water-object-swat-input-tables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Build the SWAT+ cha input files and write them into <code>data_path/tables.sqlite</code></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="model-setup-with-swatbuildr.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#build_cha_input(data_path)</span></span></code></pre></div>
<p>Build the SWAT+ res input files and write them into <code>data_path/tables.sqlite</code></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="model-setup-with-swatbuildr.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#build_res_input(data_path)</span></span></code></pre></div>
<p>Build SWAT+ routing unit con_out based on ‘land_connect_fraction’.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="model-setup-with-swatbuildr.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#build_rout_con_out(data_path)</span></span></code></pre></div>
<p>Build the SWAT+ rout_unit input files and write them into <code>data_path/tables.sqlite</code></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="model-setup-with-swatbuildr.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">#build_rout_input(data_path)</span></span></code></pre></div>
<p>Build the SWAT+ LSU input files and write them into <code>data_path/tables.sqlite</code></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="model-setup-with-swatbuildr.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#build_ls_unit_input(data_path)</span></span></code></pre></div>
</div>
<div id="build-aquifer-input" class="section level2 hasAnchor" number="2.12">
<h2><span class="header-section-number">2.12</span> Build aquifer input<a href="model-setup-with-swatbuildr.html#build-aquifer-input" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Build the SWAT+ aquifer input files for a single aquifer for the entire catchment. The connectivity to the channels with geomorphic flow must be added after writing the txt input files. <strong>This is not implemented in the script yet.</strong></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="model-setup-with-swatbuildr.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">#build_single_aquifer_files(data_path)</span></span></code></pre></div>
</div>
<div id="add-point-source-inputs" class="section level2 hasAnchor" number="2.13">
<h2><span class="header-section-number">2.13</span> Add point source inputs<a href="model-setup-with-swatbuildr.html#add-point-source-inputs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The point source locations are provided with a point vector layer in the path ‘point_path’.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="model-setup-with-swatbuildr.html#cb53-1" aria-hidden="true" tabindex="-1"></a>point_path <span class="ot">&lt;-</span> <span class="st">&#39;model_data/input/point/cs10_pointsource.shp&#39;</span></span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="model-setup-with-swatbuildr.html#cb54-1" aria-hidden="true" tabindex="-1"></a>point_sf <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(point_path)</span>
<span id="cb54-2"><a href="model-setup-with-swatbuildr.html#cb54-2" aria-hidden="true" tabindex="-1"></a>point_map <span class="ot">&lt;-</span> <span class="fu">mapview</span>(point_sf, <span class="at">zcol =</span> <span class="st">&quot;GRAD_P&quot;</span>, <span class="at">cex =</span> <span class="st">&quot;GRAD_N&quot;</span>)</span>
<span id="cb54-3"><a href="model-setup-with-swatbuildr.html#cb54-3" aria-hidden="true" tabindex="-1"></a>point_map<span class="sc">+</span>channel_map<span class="sc">+</span>bound_map</span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1d9b8ac38e0a0c43c008" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-1d9b8ac38e0a0c43c008">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["point",440]},{"method":"addFlatGeoBuf","args":["point_sf-GRAD_P","point_sf - GRAD_P",null,true,"GRAD_P",{"radius":"GRAD_N","stroke":true,"color":"#333333","weight":1,"opacity":0.9,"fill":true,"fillColor":null,"fillOpacity":0.6},{"className":"","pane":"point"},"mapview-popup",{"radius":{"to":[3,15],"from":[5,100]},"weight":{"to":[1,10],"from":[1,10]},"opacity":{"to":[0,1],"from":[0,1]},"fillOpacity":{"to":[0,1],"from":[0,1]}}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[10.8496917856111,59.6208102275655,10.9496365206241,59.7200915132146,true,"point_sf - GRAD_P","Zoom to point_sf - GRAD_P","<strong> point_sf - GRAD_P <\/strong>","bottomright"]},{"method":"addLegend","args":[{"colors":["#4B0055 , #481A61 5.26315789473684%, #393C79 15.7894736842105%, #015C8C 26.3157894736842%, #017996 36.8421052631579%, #049496 47.3684210526316%, #07AD8B 57.8947368421053%, #39C177 68.4210526315789%, #78D15B 78.9473684210526%, #BFDD3B 89.4736842105263%, #FDE333 100%, #FDE333 "],"labels":["10","20","30","40","50","60","70","80","90","100"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"numeric","title":"point_sf - GRAD_P","extra":{"p_1":0.0526315789473684,"p_n":1},"layerId":null,"className":"info legend","group":"point_sf - GRAD_P"}]},{"method":"createMapPane","args":["line",430]},{"method":"addFlatGeoBuf","args":["channels-type","channels - type",null,true,"type",{"radius":6,"stroke":true,"color":null,"weight":2,"opacity":0.9,"fill":false,"fillColor":null,"fillOpacity":1},{"className":"","pane":"line"},"mapview-popup",{"radius":{"to":[3,15],"from":[3,15]},"weight":{"to":[1,10],"from":[1,10]},"opacity":{"to":[0,1],"from":[0,1]},"fillOpacity":{"to":[0,1],"from":[0,1]}}]},{"method":"addHomeButton","args":[10.8413909371941,59.5954669878296,10.9651817579041,59.7197753391751,true,"channels - type","Zoom to channels - type","<strong> channels - type <\/strong>","bottomright"]},{"method":"addLegend","args":[{"colors":["#4B0055","#FDE333"],"labels":["cha","sub"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"channels - type","extra":null,"layerId":null,"className":"info legend","group":"channels - type"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addFlatGeoBuf","args":["bound_sf","bound_sf",null,true,"CS10 Basin",{"radius":6,"stroke":true,"color":"#000000","weight":0.5,"opacity":0.9,"fill":true,"fillColor":"#FFA500","fillOpacity":0.2},{"className":"","pane":"polygon"},"mapview-popup",{"radius":{"to":[3,15],"from":[3,15]},"weight":{"to":[1,10],"from":[1,10]},"opacity":{"to":[0,1],"from":[0,1]},"fillOpacity":{"to":[0,1],"from":[0,1]}}]},{"method":"addHomeButton","args":[10.8388608505649,59.59462555341,10.9715776438155,59.722569973813,true,"bound_sf","Zoom to bound_sf","<strong> bound_sf <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],["point_sf - GRAD_P","channels - type","bound_sf"],{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#FFA500"],"labels":["CS10 Basin"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"bound_sf"}]},{"method":"addHomeButton","args":[10.8388608505649,59.59462555341,10.9715776438155,59.722569973813,true,null,"Zoom to full extent","<strong>Zoom full<\/strong>","bottomleft"]}],"fitBounds":[59.59462555341,10.8388608505649,59.722569973813,10.9715776438155,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p>Map of point sources, colored by (assumed) phosphorous and size by (assumed) Nitrogren</p>
<p>Maximum distance of a point source to a channel or a reservoir to be included as a point source object (recall) in the model setup:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="model-setup-with-swatbuildr.html#cb55-1" aria-hidden="true" tabindex="-1"></a>max_point_dist <span class="ot">&lt;-</span> <span class="dv">500</span> <span class="co">#meters</span></span></code></pre></div>
<p>Point source records can automatically be added from files in the same folder as the point source location layer. To be identified as point source data the files must be named as <code>&lt;name&gt;_&lt;interval&gt;.csv</code>, where <code>&lt;name&gt;</code> must be the name of a point <code>int</code> the vector layer and <code>&lt;interval&gt;</code> must be one of <code>const</code>, <code>yr</code>, <code>mon</code>, or <code>day</code> depending on the time intervals in the input data.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="model-setup-with-swatbuildr.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#add_point_sources(point_path, data_path, max_point_dist)</span></span></code></pre></div>
</div>
<div id="create-swat-sqlite-database" class="section level2 hasAnchor" number="2.14">
<h2><span class="header-section-number">2.14</span> Create SWAT+ sqlite database<a href="model-setup-with-swatbuildr.html#create-swat-sqlite-database" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="write-the-swateditor-project-database" class="section level3 hasAnchor" number="2.14.1">
<h3><span class="header-section-number">2.14.1</span> Write the SWAT+Editor project database<a href="model-setup-with-swatbuildr.html#write-the-swateditor-project-database" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The database will be located the ‘project_path’. After writing the database it can be opened and edited with the SWAT+Editor.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="model-setup-with-swatbuildr.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create_swatplus_database(project_path, project_name)</span></span></code></pre></div>
<p>The next step involves you entering the SWAT+ Editor and parameterizing the model from there. These are the steps we have taken, with screenshots since it is currently not possible to replicate this process in R.</p>
</div>
</div>
<div id="todo" class="section level2 hasAnchor" number="2.15">
<h2><span class="header-section-number">2.15</span> TODO<a href="model-setup-with-swatbuildr.html#todo" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Switch to SWAT+Editor for further model parametrization and continue with the step below after writing the SWAT+ projects’ text input files</p>
</div>
<div id="link-aquifers-and-channels-with-geomorphic-flow" class="section level2 hasAnchor" number="2.16">
<h2><span class="header-section-number">2.16</span> Link aquifers and channels with geomorphic flow<a href="model-setup-with-swatbuildr.html#link-aquifers-and-channels-with-geomorphic-flow" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A SWATbuildR model setup only has one single aquifer (in its current version). This aquifer is linked with all channels through a channel- aquifer-link file (<code>aqu_cha.lin</code>) in order to maintain recharge from the aquifer into the channels using the geomorphic flow option of SWAT+ The required input file cannot be written with the SWAT+Editor. Therefore it has to be generated in a step after writing the model text input files with the SWAT+Editor.</p>
<p>Path of the TxtInOut folder (project folder where the SWAT+ text files are written with the SWAT+Editor)</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="model-setup-with-swatbuildr.html#cb58-1" aria-hidden="true" tabindex="-1"></a>txt_path <span class="ot">&lt;-</span> <span class="st">&#39;../swat_runs/txtinouit/&#39;</span></span></code></pre></div>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="model-setup-with-swatbuildr.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">#link_aquifer_channels(txt_path)</span></span></code></pre></div>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-schürz2022" class="csl-entry">
Schürz, Christoph, Natalja Čerkasova, Csilla Farkas, Attila Nemes, Plunge, Michael Strauch, Brigitta Szabó, and Mikołaj Piniewski. 2022. <span>“SWAT+ Modeling Protocol for the Assessment of Water and Nutrient Retention Measures in Small Agricultural Catchments,”</span> December. <a href="https://doi.org/10.5281/ZENODO.7463395">https://doi.org/10.5281/ZENODO.7463395</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="model-parameterization-with-swat-edtior.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/01-buildR.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
