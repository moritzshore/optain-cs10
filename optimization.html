<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 22 Optimization | OPTAIN CS10: Kråkstad SWAT+ Modelling Workflow</title>
  <meta name="description" content="A documentation of the project setup for OPTAIN case study 10, Kråkstad" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 22 Optimization | OPTAIN CS10: Kråkstad SWAT+ Modelling Workflow" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://moritzshore.github.io/optain-cs10/figures/banner.png" />
  <meta property="og:description" content="A documentation of the project setup for OPTAIN case study 10, Kråkstad" />
  <meta name="github-repo" content="moritzshore/optain-cs10" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 22 Optimization | OPTAIN CS10: Kråkstad SWAT+ Modelling Workflow" />
  
  <meta name="twitter:description" content="A documentation of the project setup for OPTAIN case study 10, Kråkstad" />
  <meta name="twitter:image" content="https://moritzshore.github.io/optain-cs10/figures/banner.png" />

<meta name="author" content="Moritz Shore (workflow author, modelling) Csilla Farkas (lead modeller) Christoph Schürz (modelling) Doninika Krzeminska (measures &amp; stakeholders) Anne-Grete Buseth Blankenberg (measures &amp; stakeholders) Robert Barneveld (measures &amp; mapping) Attila Nemes (project lead) ..and with strong support of the OPTAIN core team" />


<meta name="date" content="2025-02-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="measure-classification.html"/>
<link rel="next" href="land-object-input-abandoned.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/tile1_rasterlayer_4608e7-1/data_stars_tile1_rasterlayer82613c.txt"></script>
<script src="libs/joda-0.0.1/joda.js"></script>
<script src="libs/joda-0.0.1/addImageQuery-bindings.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script src="libs/tile2_rasterlayer_d0b7c6-1/data_stars_tile2_rasterlayer18d403.txt"></script>
<script src="libs/dem_layer_915ecb-1/data_stars_dem_layer92e3a7.txt"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.33/datatables.js"></script>
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<script src="libs/stream_crop_39b072-1/data_stars_stream_crop2d4f69.txt"></script>
<script src="libs/ws_a1945d-1/data_stars_ws4efda1.txt"></script>
<script src="libs/rglWebGL-binding-1.3.17/rglWebGL.js"></script>
<link href="libs/rglwidgetClass-1.3.17/rgl.css" rel="stylesheet" />
<script src="libs/rglwidgetClass-1.3.17/rglClass.src.js"></script>
<script src="libs/rglwidgetClass-1.3.17/utils.src.js"></script>
<script src="libs/rglwidgetClass-1.3.17/buffer.src.js"></script>
<script src="libs/rglwidgetClass-1.3.17/subscenes.src.js"></script>
<script src="libs/rglwidgetClass-1.3.17/shaders.src.js"></script>
<script src="libs/rglwidgetClass-1.3.17/shadersrc.src.js"></script>
<script src="libs/rglwidgetClass-1.3.17/textures.src.js"></script>
<script src="libs/rglwidgetClass-1.3.17/projection.src.js"></script>
<script src="libs/rglwidgetClass-1.3.17/mouse.src.js"></script>
<script src="libs/rglwidgetClass-1.3.17/init.src.js"></script>
<script src="libs/rglwidgetClass-1.3.17/pieces.src.js"></script>
<script src="libs/rglwidgetClass-1.3.17/draw.src.js"></script>
<script src="libs/rglwidgetClass-1.3.17/controls.src.js"></script>
<script src="libs/rglwidgetClass-1.3.17/selection.src.js"></script>
<script src="libs/rglwidgetClass-1.3.17/rglTimer.src.js"></script>
<script src="libs/rglwidgetClass-1.3.17/pretty.src.js"></script>
<script src="libs/rglwidgetClass-1.3.17/axes.src.js"></script>
<script src="libs/rglwidgetClass-1.3.17/animation.src.js"></script>
<script src="libs/CanvasMatrix4-1.3.17/CanvasMatrix.src.js"></script>
<script src="libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
<link href="libs/dt-ext-scroller-1.13.6/css/scroller.dataTables.min.css" rel="stylesheet" />
<script src="libs/dt-ext-scroller-1.13.6/js/dataTables.scroller.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The OPTAIN-CS10 Project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="input-data-preparation.html"><a href="input-data-preparation.html"><i class="fa fa-check"></i><b>1</b> Input Data Preparation</a>
<ul>
<li class="chapter" data-level="1.1" data-path="input-data-preparation.html"><a href="input-data-preparation.html#digital-elevation-model"><i class="fa fa-check"></i><b>1.1</b> Digital Elevation Model</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="input-data-preparation.html"><a href="input-data-preparation.html#high-resolution-dem"><i class="fa fa-check"></i><b>1.1.1</b> High resolution DEM</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="input-data-preparation.html"><a href="input-data-preparation.html#soil-data"><i class="fa fa-check"></i><b>1.2</b> Soil Data</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="input-data-preparation.html"><a href="input-data-preparation.html#high-resolution-soil-maps"><i class="fa fa-check"></i><b>1.2.1</b> High resolution soil maps</a></li>
<li class="chapter" data-level="1.2.2" data-path="input-data-preparation.html"><a href="input-data-preparation.html#data-source"><i class="fa fa-check"></i><b>1.2.2</b> Data source</a></li>
<li class="chapter" data-level="1.2.3" data-path="input-data-preparation.html"><a href="input-data-preparation.html#combining-jordsmonn-and-loesmasser"><i class="fa fa-check"></i><b>1.2.3</b> Combining Jordsmonn and Loesmasser</a></li>
<li class="chapter" data-level="1.2.4" data-path="input-data-preparation.html"><a href="input-data-preparation.html#detailed-soil-map"><i class="fa fa-check"></i><b>1.2.4</b> Detailed Soil Map</a></li>
<li class="chapter" data-level="1.2.5" data-path="input-data-preparation.html"><a href="input-data-preparation.html#reclassification"><i class="fa fa-check"></i><b>1.2.5</b> Reclassification</a></li>
<li class="chapter" data-level="1.2.6" data-path="input-data-preparation.html"><a href="input-data-preparation.html#simplifying-geometries"><i class="fa fa-check"></i><b>1.2.6</b> Simplifying Geometries</a></li>
<li class="chapter" data-level="1.2.7" data-path="input-data-preparation.html"><a href="input-data-preparation.html#writing-vector-layer"><i class="fa fa-check"></i><b>1.2.7</b> Writing vector layer</a></li>
<li class="chapter" data-level="1.2.8" data-path="input-data-preparation.html"><a href="input-data-preparation.html#lookup-table"><i class="fa fa-check"></i><b>1.2.8</b> Lookup Table</a></li>
<li class="chapter" data-level="1.2.9" data-path="input-data-preparation.html"><a href="input-data-preparation.html#rasterization"><i class="fa fa-check"></i><b>1.2.9</b> Rasterization</a></li>
<li class="chapter" data-level="1.2.10" data-path="input-data-preparation.html"><a href="input-data-preparation.html#usersoil"><i class="fa fa-check"></i><b>1.2.10</b> Usersoil</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="input-data-preparation.html"><a href="input-data-preparation.html#watershed-boundary"><i class="fa fa-check"></i><b>1.3</b> Watershed Boundary</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="input-data-preparation.html"><a href="input-data-preparation.html#hydrological-preperation"><i class="fa fa-check"></i><b>1.3.1</b> Hydrological preperation</a></li>
<li class="chapter" data-level="1.3.2" data-path="input-data-preparation.html"><a href="input-data-preparation.html#pour-points"><i class="fa fa-check"></i><b>1.3.2</b> Pour Points</a></li>
<li class="chapter" data-level="1.3.3" data-path="input-data-preparation.html"><a href="input-data-preparation.html#streams"><i class="fa fa-check"></i><b>1.3.3</b> Streams</a></li>
<li class="chapter" data-level="1.3.4" data-path="input-data-preparation.html"><a href="input-data-preparation.html#watershed-delineation"><i class="fa fa-check"></i><b>1.3.4</b> Watershed Delineation</a></li>
<li class="chapter" data-level="1.3.5" data-path="input-data-preparation.html"><a href="input-data-preparation.html#bonus-section"><i class="fa fa-check"></i><b>1.3.5</b> Bonus Section</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="input-data-preparation.html"><a href="input-data-preparation.html#land-object-input"><i class="fa fa-check"></i><b>1.4</b> Land object input</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="input-data-preparation.html"><a href="input-data-preparation.html#data-sources"><i class="fa fa-check"></i><b>1.4.1</b> Data sources</a></li>
<li class="chapter" data-level="1.4.2" data-path="input-data-preparation.html"><a href="input-data-preparation.html#delineation-of-land-objects"><i class="fa fa-check"></i><b>1.4.2</b> Delineation of land objects</a></li>
<li class="chapter" data-level="1.4.3" data-path="input-data-preparation.html"><a href="input-data-preparation.html#standing-water-bodies-and-the-landuse-type-watr"><i class="fa fa-check"></i><b>1.4.3</b> Standing water bodies and the landuse type = ‘watr’</a></li>
<li class="chapter" data-level="1.4.4" data-path="input-data-preparation.html"><a href="input-data-preparation.html#tile-drainage-option"><i class="fa fa-check"></i><b>1.4.4</b> Tile drainage option</a></li>
<li class="chapter" data-level="1.4.5" data-path="input-data-preparation.html"><a href="input-data-preparation.html#existing-and-potential-structures-to-retain-water-and-nutrients"><i class="fa fa-check"></i><b>1.4.5</b> Existing and potential structures to retain water and nutrients</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="input-data-preparation.html"><a href="input-data-preparation.html#channel-object-input"><i class="fa fa-check"></i><b>1.5</b> Channel object input</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="input-data-preparation.html"><a href="input-data-preparation.html#data-sources-and-data-processing"><i class="fa fa-check"></i><b>1.5.1</b> Data sources and data processing</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="input-data-preparation.html"><a href="input-data-preparation.html#point-sources-locations"><i class="fa fa-check"></i><b>1.6</b> Point sources locations</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="input-data-preparation.html"><a href="input-data-preparation.html#point-source-source-data"><i class="fa fa-check"></i><b>1.6.1</b> Point source source data</a></li>
<li class="chapter" data-level="1.6.2" data-path="input-data-preparation.html"><a href="input-data-preparation.html#point-source-data-files"><i class="fa fa-check"></i><b>1.6.2</b> Point source data files</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="input-data-preparation.html"><a href="input-data-preparation.html#aquifer-objects"><i class="fa fa-check"></i><b>1.7</b> Aquifer Objects</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="model-setup-swatbuildr.html"><a href="model-setup-swatbuildr.html"><i class="fa fa-check"></i><b>2</b> Model Setup (SWATbuildR)</a>
<ul>
<li class="chapter" data-level="2.1" data-path="model-setup-swatbuildr.html"><a href="model-setup-swatbuildr.html#buildr-setup"><i class="fa fa-check"></i><b>2.1</b> BuildR Setup</a></li>
<li class="chapter" data-level="2.2" data-path="model-setup-swatbuildr.html"><a href="model-setup-swatbuildr.html#processing-input-data"><i class="fa fa-check"></i><b>2.2</b> Processing input data</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="model-setup-swatbuildr.html"><a href="model-setup-swatbuildr.html#high-resolution-digital-elevation-model-dem"><i class="fa fa-check"></i><b>2.2.1</b> High-Resolution Digital Elevation Model (DEM)</a></li>
<li class="chapter" data-level="2.2.2" data-path="model-setup-swatbuildr.html"><a href="model-setup-swatbuildr.html#processing-the-basin-boundary"><i class="fa fa-check"></i><b>2.2.2</b> Processing the Basin Boundary</a></li>
<li class="chapter" data-level="2.2.3" data-path="model-setup-swatbuildr.html"><a href="model-setup-swatbuildr.html#processing-the-land-layer"><i class="fa fa-check"></i><b>2.2.3</b> Processing the Land layer</a></li>
<li class="chapter" data-level="2.2.4" data-path="model-setup-swatbuildr.html"><a href="model-setup-swatbuildr.html#processing-the-channels"><i class="fa fa-check"></i><b>2.2.4</b> Processing the Channels</a></li>
<li class="chapter" data-level="2.2.5" data-path="model-setup-swatbuildr.html"><a href="model-setup-swatbuildr.html#processing-the-dem"><i class="fa fa-check"></i><b>2.2.5</b> Processing the DEM</a></li>
<li class="chapter" data-level="2.2.6" data-path="model-setup-swatbuildr.html"><a href="model-setup-swatbuildr.html#processing-soil-data"><i class="fa fa-check"></i><b>2.2.6</b> Processing Soil Data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="model-setup-swatbuildr.html"><a href="model-setup-swatbuildr.html#calculating-cocoa"><i class="fa fa-check"></i><b>2.3</b> Calculating COCOA</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="model-setup-swatbuildr.html"><a href="model-setup-swatbuildr.html#calculating-land-unit-connectivity"><i class="fa fa-check"></i><b>2.3.1</b> Calculating land unit connectivity</a></li>
<li class="chapter" data-level="2.3.2" data-path="model-setup-swatbuildr.html"><a href="model-setup-swatbuildr.html#calculating-channelreservoir-connectivity"><i class="fa fa-check"></i><b>2.3.2</b> Calculating channel/reservoir connectivity</a></li>
<li class="chapter" data-level="2.3.3" data-path="model-setup-swatbuildr.html"><a href="model-setup-swatbuildr.html#checking-the-water-objects-for-infinite-loops"><i class="fa fa-check"></i><b>2.3.3</b> Checking the water objects for infinite loops</a></li>
<li class="chapter" data-level="2.3.4" data-path="model-setup-swatbuildr.html"><a href="model-setup-swatbuildr.html#terrain-properties"><i class="fa fa-check"></i><b>2.3.4</b> Terrain properties</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="model-setup-swatbuildr.html"><a href="model-setup-swatbuildr.html#generate-swat-input"><i class="fa fa-check"></i><b>2.4</b> Generate SWAT+ input</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="model-setup-swatbuildr.html"><a href="model-setup-swatbuildr.html#generate-land-object-swat-input-tables"><i class="fa fa-check"></i><b>2.4.1</b> Generate land object SWAT+ input tables</a></li>
<li class="chapter" data-level="2.4.2" data-path="model-setup-swatbuildr.html"><a href="model-setup-swatbuildr.html#generate-water-object-swat-input-tables"><i class="fa fa-check"></i><b>2.4.2</b> Generate water object SWAT+ input tables</a></li>
<li class="chapter" data-level="2.4.3" data-path="model-setup-swatbuildr.html"><a href="model-setup-swatbuildr.html#build-aquifer-input"><i class="fa fa-check"></i><b>2.4.3</b> Build aquifer input</a></li>
<li class="chapter" data-level="2.4.4" data-path="model-setup-swatbuildr.html"><a href="model-setup-swatbuildr.html#add-point-source-inputs"><i class="fa fa-check"></i><b>2.4.4</b> Add point source inputs</a></li>
<li class="chapter" data-level="2.4.5" data-path="model-setup-swatbuildr.html"><a href="model-setup-swatbuildr.html#create-swat-sqlite-database"><i class="fa fa-check"></i><b>2.4.5</b> Create SWAT+ sqlite database</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="weather-input.html"><a href="weather-input.html"><i class="fa fa-check"></i><b>3</b> Weather Input</a>
<ul>
<li class="chapter" data-level="3.1" data-path="weather-input.html"><a href="weather-input.html#loading-data"><i class="fa fa-check"></i><b>3.1</b> Loading Data</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="weather-input.html"><a href="weather-input.html#required-packages"><i class="fa fa-check"></i><b>3.1.1</b> Required packages</a></li>
<li class="chapter" data-level="3.1.2" data-path="weather-input.html"><a href="weather-input.html#load-in-the-files-and-load-svatools-template"><i class="fa fa-check"></i><b>3.1.2</b> Load in the file(s) and load svatools template</a></li>
<li class="chapter" data-level="3.1.3" data-path="weather-input.html"><a href="weather-input.html#proof-the-station"><i class="fa fa-check"></i><b>3.1.3</b> Proof the station</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="weather-input.html"><a href="weather-input.html#weather-generator"><i class="fa fa-check"></i><b>3.2</b> Weather Generator</a></li>
<li class="chapter" data-level="3.3" data-path="weather-input.html"><a href="weather-input.html#adding-data-to-swat"><i class="fa fa-check"></i><b>3.3</b> Adding data to SWAT+</a></li>
<li class="chapter" data-level="3.4" data-path="weather-input.html"><a href="weather-input.html#atmospheric-deposition"><i class="fa fa-check"></i><b>3.4</b> Atmospheric Deposition</a></li>
<li class="chapter" data-level="3.5" data-path="weather-input.html"><a href="weather-input.html#re-analysis-weather"><i class="fa fa-check"></i><b>3.5</b> Re-analysis Weather</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="writing-input-files.html"><a href="writing-input-files.html"><i class="fa fa-check"></i><b>4</b> Writing Input Files</a>
<ul>
<li class="chapter" data-level="4.1" data-path="writing-input-files.html"><a href="writing-input-files.html#via-python"><i class="fa fa-check"></i><b>4.1</b> Via Python</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="writing-input-files.html"><a href="writing-input-files.html#swat-test-run"><i class="fa fa-check"></i><b>4.1.1</b> SWAT+ Test Run</a></li>
<li class="chapter" data-level="4.1.2" data-path="writing-input-files.html"><a href="writing-input-files.html#link-aquifers-and-channels-with-geomorphic-flow"><i class="fa fa-check"></i><b>4.1.2</b> Link aquifers and channels with geomorphic flow</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="writing-input-files.html"><a href="writing-input-files.html#via-swat-editor"><i class="fa fa-check"></i><b>4.2</b> Via SWAT Editor</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="writing-input-files.html"><a href="writing-input-files.html#loading-the-project-in-swat-editor"><i class="fa fa-check"></i><b>4.2.1</b> Loading the project in SWAT+ Editor</a></li>
<li class="chapter" data-level="4.2.2" data-path="writing-input-files.html"><a href="writing-input-files.html#writing-input-files-1"><i class="fa fa-check"></i><b>4.2.2</b> Writing input files</a></li>
<li class="chapter" data-level="4.2.3" data-path="writing-input-files.html"><a href="writing-input-files.html#post-write-changes"><i class="fa fa-check"></i><b>4.2.3</b> Post-write Changes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="crop-map.html"><a href="crop-map.html"><i class="fa fa-check"></i><b>5</b> Crop Map</a>
<ul>
<li class="chapter" data-level="5.1" data-path="crop-map.html"><a href="crop-map.html#calculating-field-area"><i class="fa fa-check"></i><b>5.1</b> Calculating Field Area</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="crop-map.html"><a href="crop-map.html#calculate-field-area-and-assign-ids"><i class="fa fa-check"></i><b>5.1.1</b> Calculate Field Area and Assign IDs</a></li>
<li class="chapter" data-level="5.1.2" data-path="crop-map.html"><a href="crop-map.html#calculate-field-area-and-assign-ids-1"><i class="fa fa-check"></i><b>5.1.2</b> Calculate Field area and assign IDs</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="crop-map.html"><a href="crop-map.html#generating-the-crop-rotation"><i class="fa fa-check"></i><b>5.2</b> Generating the Crop Rotation</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="crop-map.html"><a href="crop-map.html#tidy-up-the-source-data"><i class="fa fa-check"></i><b>5.2.1</b> Tidy up the source data:</a></li>
<li class="chapter" data-level="5.2.2" data-path="crop-map.html"><a href="crop-map.html#tidy-up-the-buildr-output"><i class="fa fa-check"></i><b>5.2.2</b> Tidy up the BuildR output</a></li>
<li class="chapter" data-level="5.2.3" data-path="crop-map.html"><a href="crop-map.html#field-classification"><i class="fa fa-check"></i><b>5.2.3</b> Field classification</a></li>
<li class="chapter" data-level="5.2.4" data-path="crop-map.html"><a href="crop-map.html#extrapolating-the-crop-rotation"><i class="fa fa-check"></i><b>5.2.4</b> Extrapolating the Crop Rotation</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="crop-map.html"><a href="crop-map.html#merging-with-swatbuildr"><i class="fa fa-check"></i><b>5.3</b> Merging with SWATbuildR</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="landuse-parameterization.html"><a href="landuse-parameterization.html"><i class="fa fa-check"></i><b>6</b> Landuse Parameterization</a>
<ul>
<li class="chapter" data-level="6.1" data-path="landuse-parameterization.html"><a href="landuse-parameterization.html#data-preperation"><i class="fa fa-check"></i><b>6.1</b> Data preperation</a></li>
<li class="chapter" data-level="6.2" data-path="landuse-parameterization.html"><a href="landuse-parameterization.html#assigning-landuse-values"><i class="fa fa-check"></i><b>6.2</b> Assigning landuse values</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="landuse-parameterization.html"><a href="landuse-parameterization.html#setting-cal_group"><i class="fa fa-check"></i><b>6.2.1</b> Setting <code>cal_group</code></a></li>
<li class="chapter" data-level="6.2.2" data-path="landuse-parameterization.html"><a href="landuse-parameterization.html#setting-plnt_com"><i class="fa fa-check"></i><b>6.2.2</b> Setting <code>plnt_com</code></a></li>
<li class="chapter" data-level="6.2.3" data-path="landuse-parameterization.html"><a href="landuse-parameterization.html#setting-mgt"><i class="fa fa-check"></i><b>6.2.3</b> Setting <code>mgt</code></a></li>
<li class="chapter" data-level="6.2.4" data-path="landuse-parameterization.html"><a href="landuse-parameterization.html#setting-urb_ro"><i class="fa fa-check"></i><b>6.2.4</b> Setting <code>urb_ro</code></a></li>
<li class="chapter" data-level="6.2.5" data-path="landuse-parameterization.html"><a href="landuse-parameterization.html#setting-urban"><i class="fa fa-check"></i><b>6.2.5</b> Setting <code>urban</code></a></li>
<li class="chapter" data-level="6.2.6" data-path="landuse-parameterization.html"><a href="landuse-parameterization.html#setting-mannings-n-ovn"><i class="fa fa-check"></i><b>6.2.6</b> Setting Manning’s n (<code>ovn</code>)</a></li>
<li class="chapter" data-level="6.2.7" data-path="landuse-parameterization.html"><a href="landuse-parameterization.html#setting-cn2"><i class="fa fa-check"></i><b>6.2.7</b> Setting <code>cn2</code>:</a></li>
<li class="chapter" data-level="6.2.8" data-path="landuse-parameterization.html"><a href="landuse-parameterization.html#setting-cons_prac"><i class="fa fa-check"></i><b>6.2.8</b> Setting <code>cons_prac</code></a></li>
<li class="chapter" data-level="6.2.9" data-path="landuse-parameterization.html"><a href="landuse-parameterization.html#setting-tile"><i class="fa fa-check"></i><b>6.2.9</b> Setting <code>tile</code></a></li>
<li class="chapter" data-level="6.2.10" data-path="landuse-parameterization.html"><a href="landuse-parameterization.html#setting-sep"><i class="fa fa-check"></i><b>6.2.10</b> Setting <code>sep</code></a></li>
<li class="chapter" data-level="6.2.11" data-path="landuse-parameterization.html"><a href="landuse-parameterization.html#setting-vfs"><i class="fa fa-check"></i><b>6.2.11</b> Setting <code>vfs</code></a></li>
<li class="chapter" data-level="6.2.12" data-path="landuse-parameterization.html"><a href="landuse-parameterization.html#setting-grww"><i class="fa fa-check"></i><b>6.2.12</b> Setting <code>grww</code></a></li>
<li class="chapter" data-level="6.2.13" data-path="landuse-parameterization.html"><a href="landuse-parameterization.html#setting-bmp"><i class="fa fa-check"></i><b>6.2.13</b> Setting <code>bmp</code></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="landuse-parameterization.html"><a href="landuse-parameterization.html#writing-changes"><i class="fa fa-check"></i><b>6.3</b> Writing Changes</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="field-site-loggers.html"><a href="field-site-loggers.html"><i class="fa fa-check"></i><b>7</b> Field Site Loggers</a>
<ul>
<li class="chapter" data-level="7.1" data-path="field-site-loggers.html"><a href="field-site-loggers.html#introduction-1"><i class="fa fa-check"></i><b>7.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="field-site-loggers.html"><a href="field-site-loggers.html#prerequisites"><i class="fa fa-check"></i><b>7.1.1</b> Prerequisites</a></li>
<li class="chapter" data-level="7.1.2" data-path="field-site-loggers.html"><a href="field-site-loggers.html#locations"><i class="fa fa-check"></i><b>7.1.2</b> Locations</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="field-site-loggers.html"><a href="field-site-loggers.html#data-processing"><i class="fa fa-check"></i><b>7.2</b> Data Processing</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="field-site-loggers.html"><a href="field-site-loggers.html#loading-data-1"><i class="fa fa-check"></i><b>7.2.1</b> Loading Data</a></li>
<li class="chapter" data-level="7.2.2" data-path="field-site-loggers.html"><a href="field-site-loggers.html#data-re-structuring"><i class="fa fa-check"></i><b>7.2.2</b> Data Re-structuring</a></li>
<li class="chapter" data-level="7.2.3" data-path="field-site-loggers.html"><a href="field-site-loggers.html#summarize-to-daily-means"><i class="fa fa-check"></i><b>7.2.3</b> Summarize to Daily Means</a></li>
<li class="chapter" data-level="7.2.4" data-path="field-site-loggers.html"><a href="field-site-loggers.html#including-air-temperature-and-precipitation-data"><i class="fa fa-check"></i><b>7.2.4</b> Including Air Temperature and Precipitation Data</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="field-site-loggers.html"><a href="field-site-loggers.html#data-quality-check"><i class="fa fa-check"></i><b>7.3</b> Data quality check</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="field-site-loggers.html"><a href="field-site-loggers.html#logger-600409-deep-rocky-sand"><i class="fa fa-check"></i><b>7.3.1</b> Logger 600409 “Deep Rocky Sand”</a></li>
<li class="chapter" data-level="7.3.2" data-path="field-site-loggers.html"><a href="field-site-loggers.html#logger-600410-tormods-farm"><i class="fa fa-check"></i><b>7.3.2</b> Logger 600410 “Tormods farm”</a></li>
<li class="chapter" data-level="7.3.3" data-path="field-site-loggers.html"><a href="field-site-loggers.html#logger-600411-john-ivar-lower-area"><i class="fa fa-check"></i><b>7.3.3</b> Logger 600411 “John Ivar Lower Area”</a></li>
<li class="chapter" data-level="7.3.4" data-path="field-site-loggers.html"><a href="field-site-loggers.html#logger-600413-john-ivar-behind-the-barn"><i class="fa fa-check"></i><b>7.3.4</b> Logger 600413 “John Ivar behind the barn”</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="field-site-loggers.html"><a href="field-site-loggers.html#data-cleanup"><i class="fa fa-check"></i><b>7.4</b> Data Cleanup</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="field-site-loggers.html"><a href="field-site-loggers.html#general-cleanup"><i class="fa fa-check"></i><b>7.4.1</b> General cleanup</a></li>
<li class="chapter" data-level="7.4.2" data-path="field-site-loggers.html"><a href="field-site-loggers.html#logger-specific-cleanup"><i class="fa fa-check"></i><b>7.4.2</b> Logger specific cleanup</a></li>
<li class="chapter" data-level="7.4.3" data-path="field-site-loggers.html"><a href="field-site-loggers.html#saving-the-cleaned-data"><i class="fa fa-check"></i><b>7.4.3</b> Saving the cleaned data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="field-site-properties.html"><a href="field-site-properties.html"><i class="fa fa-check"></i><b>8</b> Field Site Properties</a>
<ul>
<li class="chapter" data-level="8.1" data-path="field-site-properties.html"><a href="field-site-properties.html#determining-hsg"><i class="fa fa-check"></i><b>8.1</b> Determining HSG</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html"><i class="fa fa-check"></i><b>9</b> Antecedent Precipitation Index</a>
<ul>
<li class="chapter" data-level="9.1" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#introduction-2"><i class="fa fa-check"></i><b>9.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#pre-requirements"><i class="fa fa-check"></i><b>9.1.1</b> Pre-requirements</a></li>
<li class="chapter" data-level="9.1.2" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#setting-up-python-for-rrmarkdown"><i class="fa fa-check"></i><b>9.1.2</b> Setting up Python for R/Rmarkdown</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#antecedent-precipitation-index-1"><i class="fa fa-check"></i><b>9.2</b> Antecedent Precipitation Index</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#loading-data-2"><i class="fa fa-check"></i><b>9.2.1</b> Loading data</a></li>
<li class="chapter" data-level="9.2.2" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#calculating-the-total-water-content"><i class="fa fa-check"></i><b>9.2.2</b> Calculating the total water content</a></li>
<li class="chapter" data-level="9.2.3" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#defining-api-model"><i class="fa fa-check"></i><b>9.2.3</b> Defining API model</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="antecedent-precipitation-index.html"><a href="antecedent-precipitation-index.html#conclusions"><i class="fa fa-check"></i><b>9.3</b> Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="model-parameterization.html"><a href="model-parameterization.html"><i class="fa fa-check"></i><b>10</b> Model Parameterization</a>
<ul>
<li class="chapter" data-level="10.1" data-path="model-parameterization.html"><a href="model-parameterization.html#parameter-changes"><i class="fa fa-check"></i><b>10.1</b> Parameter Changes</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="model-parameterization.html"><a href="model-parameterization.html#channel-parameters-revised"><i class="fa fa-check"></i><b>10.1.1</b> Channel parameters revised</a></li>
<li class="chapter" data-level="10.1.2" data-path="model-parameterization.html"><a href="model-parameterization.html#crop-parameters-verified"><i class="fa fa-check"></i><b>10.1.2</b> Crop parameters verified</a></li>
<li class="chapter" data-level="10.1.3" data-path="model-parameterization.html"><a href="model-parameterization.html#soil-physical-parameters-in-final-form"><i class="fa fa-check"></i><b>10.1.3</b> Soil physical parameters in final form</a></li>
<li class="chapter" data-level="10.1.4" data-path="model-parameterization.html"><a href="model-parameterization.html#soil-chemical-parameters-in-final-form"><i class="fa fa-check"></i><b>10.1.4</b> Soil chemical parameters in final form</a></li>
<li class="chapter" data-level="10.1.5" data-path="model-parameterization.html"><a href="model-parameterization.html#impoundment-parameters-defined"><i class="fa fa-check"></i><b>10.1.5</b> Impoundment parameters defined</a></li>
<li class="chapter" data-level="10.1.6" data-path="model-parameterization.html"><a href="model-parameterization.html#water-diversions-defined"><i class="fa fa-check"></i><b>10.1.6</b> Water diversions defined</a></li>
<li class="chapter" data-level="10.1.7" data-path="model-parameterization.html"><a href="model-parameterization.html#point-sources-parameters-added"><i class="fa fa-check"></i><b>10.1.7</b> Point sources parameters added</a></li>
<li class="chapter" data-level="10.1.8" data-path="model-parameterization.html"><a href="model-parameterization.html#tile-drainage-parameters-defined"><i class="fa fa-check"></i><b>10.1.8</b> Tile drainage parameters defined</a></li>
<li class="chapter" data-level="10.1.9" data-path="model-parameterization.html"><a href="model-parameterization.html#atmospheric-deposition-defined"><i class="fa fa-check"></i><b>10.1.9</b> Atmospheric deposition defined</a></li>
<li class="chapter" data-level="10.1.10" data-path="model-parameterization.html"><a href="model-parameterization.html#additional-settings-verified"><i class="fa fa-check"></i><b>10.1.10</b> Additional settings verified</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="model-parameterization.html"><a href="model-parameterization.html#fixing-tiledrain"><i class="fa fa-check"></i><b>10.2</b> Fixing tiledrain</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="model-parameterization.html"><a href="model-parameterization.html#finding-the-problem-hrus"><i class="fa fa-check"></i><b>10.2.1</b> Finding the problem HRUs</a></li>
<li class="chapter" data-level="10.2.2" data-path="model-parameterization.html"><a href="model-parameterization.html#fixing-the-problem-hrus"><i class="fa fa-check"></i><b>10.2.2</b> Fixing the problem HRUs</a></li>
<li class="chapter" data-level="10.2.3" data-path="model-parameterization.html"><a href="model-parameterization.html#checking-changes"><i class="fa fa-check"></i><b>10.2.3</b> Checking changes</a></li>
<li class="chapter" data-level="10.2.4" data-path="model-parameterization.html"><a href="model-parameterization.html#writing-modified-changes"><i class="fa fa-check"></i><b>10.2.4</b> Writing modified changes</a></li>
<li class="chapter" data-level="10.2.5" data-path="model-parameterization.html"><a href="model-parameterization.html#re-enabling-tiledrain"><i class="fa fa-check"></i><b>10.2.5</b> Re-enabling tiledrain</a></li>
<li class="chapter" data-level="10.2.6" data-path="model-parameterization.html"><a href="model-parameterization.html#testing-swat"><i class="fa fa-check"></i><b>10.2.6</b> Testing SWAT+</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="model-parameterization.html"><a href="model-parameterization.html#soil-phosphorous"><i class="fa fa-check"></i><b>10.3</b> Soil Phosphorous</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="management-swatfarmr.html"><a href="management-swatfarmr.html"><i class="fa fa-check"></i><b>11</b> Management (SWATfarmR)</a>
<ul>
<li class="chapter" data-level="11.1" data-path="management-swatfarmr.html"><a href="management-swatfarmr.html#pre-processing-crop-rotation"><i class="fa fa-check"></i><b>11.1</b> Pre-processing crop rotation</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="management-swatfarmr.html"><a href="management-swatfarmr.html#input-files"><i class="fa fa-check"></i><b>11.1.1</b> Input files</a></li>
<li class="chapter" data-level="11.1.2" data-path="management-swatfarmr.html"><a href="management-swatfarmr.html#settings"><i class="fa fa-check"></i><b>11.1.2</b> Settings</a></li>
<li class="chapter" data-level="11.1.3" data-path="management-swatfarmr.html"><a href="management-swatfarmr.html#checks"><i class="fa fa-check"></i><b>11.1.3</b> Checks</a></li>
<li class="chapter" data-level="11.1.4" data-path="management-swatfarmr.html"><a href="management-swatfarmr.html#writing-input-data"><i class="fa fa-check"></i><b>11.1.4</b> Writing input data</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="management-swatfarmr.html"><a href="management-swatfarmr.html#initializing-farmr"><i class="fa fa-check"></i><b>11.2</b> Initializing FarmR</a></li>
<li class="chapter" data-level="11.3" data-path="management-swatfarmr.html"><a href="management-swatfarmr.html#calculating-api"><i class="fa fa-check"></i><b>11.3</b> Calculating API</a></li>
<li class="chapter" data-level="11.4" data-path="management-swatfarmr.html"><a href="management-swatfarmr.html#scheduling-operations"><i class="fa fa-check"></i><b>11.4</b> Scheduling Operations</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="management-swatfarmr.html"><a href="management-swatfarmr.html#write-operations"><i class="fa fa-check"></i><b>11.4.1</b> Write Operations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="model-verification-swatdoctr.html"><a href="model-verification-swatdoctr.html"><i class="fa fa-check"></i><b>12</b> Model Verification (SWATdoctR)</a>
<ul>
<li class="chapter" data-level="12.1" data-path="model-verification-swatdoctr.html"><a href="model-verification-swatdoctr.html#climate-variables"><i class="fa fa-check"></i><b>12.1</b> Climate Variables</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="model-verification-swatdoctr.html"><a href="model-verification-swatdoctr.html#lapse-rate"><i class="fa fa-check"></i><b>12.1.1</b> Lapse rate</a></li>
<li class="chapter" data-level="12.1.2" data-path="model-verification-swatdoctr.html"><a href="model-verification-swatdoctr.html#climate-variables-1"><i class="fa fa-check"></i><b>12.1.2</b> Climate variables</a></li>
<li class="chapter" data-level="12.1.3" data-path="model-verification-swatdoctr.html"><a href="model-verification-swatdoctr.html#snowfall-and-snowmelt"><i class="fa fa-check"></i><b>12.1.3</b> Snowfall and Snowmelt</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="model-verification-swatdoctr.html"><a href="model-verification-swatdoctr.html#management-operations"><i class="fa fa-check"></i><b>12.2</b> Management operations</a></li>
<li class="chapter" data-level="12.3" data-path="model-verification-swatdoctr.html"><a href="model-verification-swatdoctr.html#unconstrained-plant-growth"><i class="fa fa-check"></i><b>12.3</b> Unconstrained plant growth</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="soft-calibration.html"><a href="soft-calibration.html"><i class="fa fa-check"></i><b>13</b> Soft Calibration</a></li>
<li class="chapter" data-level="14" data-path="hard-calibration.html"><a href="hard-calibration.html"><i class="fa fa-check"></i><b>14</b> Hard Calibration</a></li>
<li class="chapter" data-level="15" data-path="landuse-scenarios.html"><a href="landuse-scenarios.html"><i class="fa fa-check"></i><b>15</b> Landuse Scenarios</a>
<ul>
<li class="chapter" data-level="15.1" data-path="landuse-scenarios.html"><a href="landuse-scenarios.html#scenarios"><i class="fa fa-check"></i><b>15.1</b> Scenarios</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="landuse-scenarios.html"><a href="landuse-scenarios.html#status-quo"><i class="fa fa-check"></i><b>15.1.1</b> Status Quo</a></li>
<li class="chapter" data-level="15.1.2" data-path="landuse-scenarios.html"><a href="landuse-scenarios.html#no-autumn-tillage"><i class="fa fa-check"></i><b>15.1.2</b> No Autumn Tillage</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="update-of-the-swatfarmr-input-input-files.html"><a href="update-of-the-swatfarmr-input-input-files.html"><i class="fa fa-check"></i><b>16</b> Update of the SWATfarmR input input files</a>
<ul>
<li class="chapter" data-level="16.1" data-path="update-of-the-swatfarmr-input-input-files.html"><a href="update-of-the-swatfarmr-input-input-files.html#setup"><i class="fa fa-check"></i><b>16.1</b> Setup</a></li>
<li class="chapter" data-level="16.2" data-path="update-of-the-swatfarmr-input-input-files.html"><a href="update-of-the-swatfarmr-input-input-files.html#documenting-changes-in-the-txt-inputs-files-of-calibrated-model-setup"><i class="fa fa-check"></i><b>16.2</b> Documenting changes in the txt inputs files of calibrated model setup</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="update-of-the-swatfarmr-input-input-files.html"><a href="update-of-the-swatfarmr-input-input-files.html#preparation-of-swatfarmr-management-input-files"><i class="fa fa-check"></i><b>16.2.1</b> Preparation of <code>SWATfarmR</code> management input files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="climate-scenarios.html"><a href="climate-scenarios.html"><i class="fa fa-check"></i><b>17</b> Climate Scenarios</a>
<ul>
<li class="chapter" data-level="17.1" data-path="climate-scenarios.html"><a href="climate-scenarios.html#introduction-3"><i class="fa fa-check"></i><b>17.1</b> Introduction</a></li>
<li class="chapter" data-level="17.2" data-path="climate-scenarios.html"><a href="climate-scenarios.html#setup-1"><i class="fa fa-check"></i><b>17.2</b> Setup</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="climate-scenarios.html"><a href="climate-scenarios.html#re-calculating-management"><i class="fa fa-check"></i><b>17.2.1</b> Re-Calculating Management</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="climate-scenarios.html"><a href="climate-scenarios.html#executing-model"><i class="fa fa-check"></i><b>17.3</b> Executing model</a></li>
<li class="chapter" data-level="17.4" data-path="climate-scenarios.html"><a href="climate-scenarios.html#processing-results"><i class="fa fa-check"></i><b>17.4</b> Processing Results</a></li>
<li class="chapter" data-level="17.5" data-path="climate-scenarios.html"><a href="climate-scenarios.html#output-analysis"><i class="fa fa-check"></i><b>17.5</b> Output Analysis</a>
<ul>
<li class="chapter" data-level="17.5.1" data-path="climate-scenarios.html"><a href="climate-scenarios.html#saving-rds"><i class="fa fa-check"></i><b>17.5.1</b> Saving RDS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="measures-swatmeasr.html"><a href="measures-swatmeasr.html"><i class="fa fa-check"></i><b>18</b> Measures (SWATmeasR)</a></li>
<li class="chapter" data-level="19" data-path="measure-implementation.html"><a href="measure-implementation.html"><i class="fa fa-check"></i><b>19</b> Measure Implementation</a></li>
<li class="chapter" data-level="20" data-path="measure-scenarios.html"><a href="measure-scenarios.html"><i class="fa fa-check"></i><b>20</b> Measure Scenarios</a></li>
<li class="chapter" data-level="21" data-path="measure-classification.html"><a href="measure-classification.html"><i class="fa fa-check"></i><b>21</b> Measure Classification</a>
<ul>
<li class="chapter" data-level="21.1" data-path="measure-classification.html"><a href="measure-classification.html#introduction-4"><i class="fa fa-check"></i><b>21.1</b> Introduction</a></li>
<li class="chapter" data-level="21.2" data-path="measure-classification.html"><a href="measure-classification.html#determining-classification"><i class="fa fa-check"></i><b>21.2</b> Determining Classification</a></li>
<li class="chapter" data-level="21.3" data-path="measure-classification.html"><a href="measure-classification.html#applying-classification"><i class="fa fa-check"></i><b>21.3</b> Applying Classification</a>
<ul>
<li class="chapter" data-level="21.3.1" data-path="measure-classification.html"><a href="measure-classification.html#gullies-grassed-water-ways"><i class="fa fa-check"></i><b>21.3.1</b> Gullies (grassed water ways)</a></li>
<li class="chapter" data-level="21.3.2" data-path="measure-classification.html"><a href="measure-classification.html#buffer-strips"><i class="fa fa-check"></i><b>21.3.2</b> Buffer Strips</a></li>
<li class="chapter" data-level="21.3.3" data-path="measure-classification.html"><a href="measure-classification.html#ponds"><i class="fa fa-check"></i><b>21.3.3</b> Ponds</a></li>
<li class="chapter" data-level="21.3.4" data-path="measure-classification.html"><a href="measure-classification.html#notill-management-measure"><i class="fa fa-check"></i><b>21.3.4</b> NoTill (management measure)</a></li>
</ul></li>
<li class="chapter" data-level="21.4" data-path="measure-classification.html"><a href="measure-classification.html#hru-scenario-table"><i class="fa fa-check"></i><b>21.4</b> HRU Scenario Table</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="measure-classification.html"><a href="measure-classification.html#merging-into-landuse-map"><i class="fa fa-check"></i><b>21.4.1</b> Merging into Landuse Map</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i><b>22</b> Optimization</a>
<ul>
<li class="chapter" data-level="22.1" data-path="optimization.html"><a href="optimization.html#introduction-5"><i class="fa fa-check"></i><b>22.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="22.1.1" data-path="optimization.html"><a href="optimization.html#comola"><i class="fa fa-check"></i><b>22.1.1</b> CoMOLA</a></li>
<li class="chapter" data-level="22.1.2" data-path="optimization.html"><a href="optimization.html#the-pareto-frontier"><i class="fa fa-check"></i><b>22.1.2</b> The Pareto Frontier</a></li>
<li class="chapter" data-level="22.1.3" data-path="optimization.html"><a href="optimization.html#nsga-ii"><i class="fa fa-check"></i><b>22.1.3</b> NSGA-II</a></li>
<li class="chapter" data-level="22.1.4" data-path="optimization.html"><a href="optimization.html#the-objective-space"><i class="fa fa-check"></i><b>22.1.4</b> The Objective Space</a></li>
</ul></li>
<li class="chapter" data-level="22.2" data-path="optimization.html"><a href="optimization.html#measure-implementation-1"><i class="fa fa-check"></i><b>22.2</b> Measure Implementation</a>
<ul>
<li class="chapter" data-level="22.2.1" data-path="optimization.html"><a href="optimization.html#swatmeasr-project-setup"><i class="fa fa-check"></i><b>22.2.1</b> SWATmeasR project setup</a></li>
</ul></li>
<li class="chapter" data-level="22.3" data-path="optimization.html"><a href="optimization.html#economic-model-setup"><i class="fa fa-check"></i><b>22.3</b> Economic Model Setup</a></li>
<li class="chapter" data-level="22.4" data-path="optimization.html"><a href="optimization.html#comola-setup"><i class="fa fa-check"></i><b>22.4</b> CoMOLA Setup</a>
<ul>
<li class="chapter" data-level="22.4.1" data-path="optimization.html"><a href="optimization.html#python-installation"><i class="fa fa-check"></i><b>22.4.1</b> Python Installation</a></li>
<li class="chapter" data-level="22.4.2" data-path="optimization.html"><a href="optimization.html#comola-files"><i class="fa fa-check"></i><b>22.4.2</b> CoMOLA Files</a></li>
</ul></li>
<li class="chapter" data-level="22.5" data-path="optimization.html"><a href="optimization.html#running-comola"><i class="fa fa-check"></i><b>22.5</b> Running CoMOLA</a></li>
<li class="chapter" data-level="22.6" data-path="optimization.html"><a href="optimization.html#results-visualization"><i class="fa fa-check"></i><b>22.6</b> Results Visualization</a>
<ul>
<li class="chapter" data-level="22.6.1" data-path="optimization.html"><a href="optimization.html#references"><i class="fa fa-check"></i><b>22.6.1</b> References</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="23" data-path="land-object-input-abandoned.html"><a href="land-object-input-abandoned.html"><i class="fa fa-check"></i><b>23</b> Land Object Input (abandoned)</a>
<ul>
<li class="chapter" data-level="23.0.1" data-path="land-object-input-abandoned.html"><a href="land-object-input-abandoned.html#data-sources-1"><i class="fa fa-check"></i><b>23.0.1</b> Data sources</a></li>
<li class="chapter" data-level="23.0.2" data-path="land-object-input-abandoned.html"><a href="land-object-input-abandoned.html#delineation-of-land-objects-1"><i class="fa fa-check"></i><b>23.0.2</b> Delineation of land objects</a></li>
<li class="chapter" data-level="23.0.3" data-path="land-object-input-abandoned.html"><a href="land-object-input-abandoned.html#standing-water-bodies-and-the-land-use-type-watr"><i class="fa fa-check"></i><b>23.0.3</b> Standing water bodies and the land use type = ‘watr’</a></li>
<li class="chapter" data-level="23.0.4" data-path="land-object-input-abandoned.html"><a href="land-object-input-abandoned.html#tile-drainage-option-1"><i class="fa fa-check"></i><b>23.0.4</b> Tile drainage option</a></li>
<li class="chapter" data-level="23.0.5" data-path="land-object-input-abandoned.html"><a href="land-object-input-abandoned.html#ar5"><i class="fa fa-check"></i><b>23.0.5</b> AR5</a></li>
<li class="chapter" data-level="23.0.6" data-path="land-object-input-abandoned.html"><a href="land-object-input-abandoned.html#manual-simplification"><i class="fa fa-check"></i><b>23.0.6</b> Manual Simplification</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="overview-maps.html"><a href="overview-maps.html"><i class="fa fa-check"></i><b>24</b> Overview Maps</a></li>
<li class="chapter" data-level="" data-path="annex.html"><a href="annex.html"><i class="fa fa-check"></i>Annex</a>
<ul>
<li class="chapter" data-level="24.1" data-path="annex.html"><a href="annex.html#packages"><i class="fa fa-check"></i><b>24.1</b> Packages</a></li>
<li class="chapter" data-level="24.2" data-path="annex.html"><a href="annex.html#computer-specs"><i class="fa fa-check"></i><b>24.2</b> Computer Specs</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://www.optain.eu/" target="blank">optain.eu</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">OPTAIN CS10: Kråkstad SWAT+ Modelling Workflow</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="optimization" class="section level1 hasAnchor" number="22">
<h1><span class="header-section-number">Section 22</span> Optimization<a href="optimization.html#optimization" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>WP5 of the OPTAIN project is concerned with optimizing the implementation of NSWRMs in the landscape. to perform this optimization, “CoMOLA” will be used which uses NSGA2, a genetic optimization algorithm. This setup follows the D5.1 protocol <span class="citation">Strauch and Schürz (<a href="#ref-strauch_2024_11473793">2024</a>)</span>.</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb608-1"><a href="optimization.html#cb608-1" tabindex="-1"></a>RECALC_MANAGEMENT_SCEN <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb608-2"><a href="optimization.html#cb608-2" tabindex="-1"></a>RECALC_MEASR_SCEN <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb608-3"><a href="optimization.html#cb608-3" tabindex="-1"></a>OUTPUT_VIS <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb608-4"><a href="optimization.html#cb608-4" tabindex="-1"></a><span class="cf">if</span>(<span class="cn">TRUE</span>){<span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Chapter last run:&quot;</span>, <span class="fu">Sys.Date</span>()))}</span></code></pre></div>
<pre><code>## [1] &quot;Chapter last run: 2025-02-28&quot;</code></pre>
<div id="introduction-5" class="section level2 hasAnchor" number="22.1">
<h2><span class="header-section-number">22.1</span> Introduction<a href="optimization.html#introduction-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="comola" class="section level3 hasAnchor" number="22.1.1">
<h3><span class="header-section-number">22.1.1</span> CoMOLA<a href="optimization.html#comola" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>CoMOLA (Strauch et al., 2019) is an optimization algorithm, and we are using a modified version of it. The base version can be found <a href="https://github.com/michstrauch/CoMOLA">here</a>, and the reference publication <a href="https://www.sciencedirect.com/science/article/pii/S1364815218311204?via%3Dihub">here</a>. The version we are using is hosted on <a href="https://git.ufz.de/optain/wp5-optimisation/comola">UFZ gitlab</a>, and our CS10 implementation of it will be hosted on the UFZ gitlab as well, under <a href="https://git.ufz.de/optain/wp5-optimisation/comola-cs-10">COMOLA-cs10</a>. Once it has been succesfully setup there and passed UFZ approval, it will be hosted and executed domestically on our GitLab.</p>
</div>
<div id="the-pareto-frontier" class="section level3 hasAnchor" number="22.1.2">
<h3><span class="header-section-number">22.1.2</span> The Pareto Frontier<a href="optimization.html#the-pareto-frontier" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<center>
<img src="figures/clipboard-2409556421.png" />
</center>
<p>The only catchment management solutions (CMS) we are interested are those that, when measured by our objective functions (OFs), lie on our “Pareto Frontier”. ie. they are <a href="https://en.wikipedia.org/wiki/Pareto_efficiency">pareto efficient</a>. This will give us a “tradeoff spectrum” that stake holderrs can use to make choices.</p>
</div>
<div id="nsga-ii" class="section level3 hasAnchor" number="22.1.3">
<h3><span class="header-section-number">22.1.3</span> NSGA-II<a href="optimization.html#nsga-ii" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>CoMOLA uses NSGAII (Non-dominated Sorting Genetic Algorithm – Deb et al., 2002) as an optimization algorithm. It is very widely used, however slightly outdated. The main thing that makes this algorithm outdated is that it can only handle 4 objective functions. However this is not really an issue for us as we only really need four, and if we need more than four, we can create an integrated indicator that sums up multiple values (the drawback of this is that the weighting needs to be figured out).</p>
<p>NSGAII is based on non-dominated sorting and crowding distance.</p>
<center>
<p><img src="figures/clipboard-3493444178.png" /></p>
<p><img src="images/clipboard-2703941573.png" /></p>
</center>
</div>
<div id="the-objective-space" class="section level3 hasAnchor" number="22.1.4">
<h3><span class="header-section-number">22.1.4</span> The Objective Space<a href="optimization.html#the-objective-space" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To define the pareto frontier, we need to decide on our objectives. These are extremely important as they detetermine the results of the optimization, which will take <em>weeks</em> to run. We want to optimize for:</p>
<ol style="list-style-type: decimal">
<li>Water Retention (Maximize)</li>
<li>Nutrient Retention (Maximize)</li>
<li>Agricultural Production (Maximize)</li>
<li>Implementation costs of NSWRMs (Minimize)</li>
</ol>
<p>The numerical implementation of these objectives will be done by each case study. It is therefore our task to decide on these. This is being tracked in issue <a href="https://gitlab.nibio.no/moritzshore/swat-cs10/-/issues/109">#109</a>.</p>
</div>
</div>
<div id="measure-implementation-1" class="section level2 unumbered hasAnchor" number="22.2">
<h2><span class="header-section-number">22.2</span> Measure Implementation<a href="optimization.html#measure-implementation-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the previous chapter, our measures were classified, resulting in the creation of the <code>measure_location.csv</code> file. It is now time to read this data into <code>SWATmeasR</code> and to prepare our SWAT setup for optimization.</p>
<p><a href="https://www.optain.eu/sites/default/files/delivrables/OPTAIN%20D5.1%20-%20Common%20optimisation%20protocol.pdf#page=15.62"><img src="figures/measure_workflow.png" alt="Figure 3.1 from Deliverable 5.1" /></a></p>
<div id="swatmeasr-project-setup" class="section level3 hasAnchor" number="22.2.1">
<h3><span class="header-section-number">22.2.1</span> SWATmeasR project setup<a href="optimization.html#swatmeasr-project-setup" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="libraries" class="section level4 hasAnchor" number="22.2.1.1">
<h4><span class="header-section-number">22.2.1.1</span> Libraries<a href="optimization.html#libraries" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="optimization.html#cb610-1" tabindex="-1"></a><span class="co"># remotes::install_github(&quot;chrisschuerz/SWATfarmR&quot;)</span></span>
<span id="cb610-2"><a href="optimization.html#cb610-2" tabindex="-1"></a><span class="co"># remotes::install_git(&#39;https://git.ufz.de/schuerz/SWATmeasR&#39;)</span></span>
<span id="cb610-3"><a href="optimization.html#cb610-3" tabindex="-1"></a><span class="fu">require</span>(SWATmeasR)</span>
<span id="cb610-4"><a href="optimization.html#cb610-4" tabindex="-1"></a><span class="fu">require</span>(SWATfarmR)</span>
<span id="cb610-5"><a href="optimization.html#cb610-5" tabindex="-1"></a><span class="fu">require</span>(sf)</span>
<span id="cb610-6"><a href="optimization.html#cb610-6" tabindex="-1"></a><span class="fu">require</span>(dplyr)</span>
<span id="cb610-7"><a href="optimization.html#cb610-7" tabindex="-1"></a><span class="fu">require</span>(stringr)</span>
<span id="cb610-8"><a href="optimization.html#cb610-8" tabindex="-1"></a><span class="fu">require</span>(DT)</span>
<span id="cb610-9"><a href="optimization.html#cb610-9" tabindex="-1"></a><span class="fu">require</span>(readr)</span></code></pre></div>
<p>We will create a new directory in our SWAT setups folder to contain the optimization setups. For now, I will just paste in the calibrated setup, in the future hopefully we will be able to copy from the documented calibration sections. For now this is <code>txt_best_cal</code>.</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb611-1"><a href="optimization.html#cb611-1" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;model_data/cs10_setup/optimization&quot;</span>, <span class="at">showWarnings =</span> F)</span>
<span id="cb611-2"><a href="optimization.html#cb611-2" tabindex="-1"></a>txt_path <span class="ot">=</span> <span class="st">&quot;model_data/cs10_setup/optimization/txt/&quot;</span></span></code></pre></div>
<p>Restting and deleting the measure project (this CS10_MSR_v8.measr is from the measure scenarios) (is this necessary?)</p>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb612-1"><a href="optimization.html#cb612-1" tabindex="-1"></a><span class="co"># load_measr(paste0(txt_path, &quot;CS10_MSR_v8.measr&quot;))</span></span>
<span id="cb612-2"><a href="optimization.html#cb612-2" tabindex="-1"></a><span class="co"># CS10_MSR_v8$reset()</span></span>
<span id="cb612-3"><a href="optimization.html#cb612-3" tabindex="-1"></a><span class="co"># rm(CS10_MSR_v8)</span></span>
<span id="cb612-4"><a href="optimization.html#cb612-4" tabindex="-1"></a><span class="co"># file.remove(list.files(txt_path, pattern = &quot;*.measr&quot;, full.names = T))</span></span></code></pre></div>
</div>
<div id="prepare-management-inputs" class="section level4 hasAnchor" number="22.2.1.2">
<h4><span class="header-section-number">22.2.1.2</span> Prepare management inputs<a href="optimization.html#prepare-management-inputs" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>“The definition of management related NSWRMs requires to prepare a R data object which provides all scenarios in a list structure. To prepare the data all SWATfarmR projects which provide the management for management related NSWRMs must be available in the SWAT+ project folder. Be careful with other SWATfarmR projects which are not the status quo case or one of the scenarios. If these are included and do not fit the status quo this can trigger an error. But you can also specifically define the scenario farmR projects (as done below).”</p>
<p>TODO: we need to get the newest farmR. See issue <a href="https://gitlab.nibio.no/moritzshore/swat-cs10/-/issues/116">#116</a></p>
<div class="sourceCode" id="cb613"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb613-1"><a href="optimization.html#cb613-1" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co"> make sure the farmR is updated</span></span></code></pre></div>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb614-1"><a href="optimization.html#cb614-1" tabindex="-1"></a><span class="co"># The name of the status quo farmR project must be defined.</span></span>
<span id="cb614-2"><a href="optimization.html#cb614-2" tabindex="-1"></a>stat_quo_farmR <span class="ot">&lt;-</span> <span class="st">&#39;status_quo&#39;</span></span></code></pre></div>
<p>“You can also specifically define the scenario farmR projects. If not all farmR projects in the project folder will be considered. The scenario farmR projects in the SWAT+ project folder must have the same name as the scenario is then called in the NSWRMs. Be careful to rename the .farm AND the .mgts objects in the project folder.”</p>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb615-1"><a href="optimization.html#cb615-1" tabindex="-1"></a>scenario_farmR <span class="ot">&lt;-</span> <span class="st">&#39;notill&#39;</span></span></code></pre></div>
<p>“The management preparation routine adjusts the dates of operations in the scenarios which are the same as in the status quo but were assigned different dates due to the random sampling in SWATfarmR. But only operations which are newly introduced in the scenarios should have different dates.</p>
<p>If operations in the status quo and the scenarios should be treated as the same (so they are the same operation type), but they have different op_data1 you can define synonyms, so that e.g. tillage operations with different tillage types are still treated as the same operation and the dates will be corrected in the scenario.”</p>
<blockquote>
<p>should add more detail on what this does</p>
</blockquote>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb616-1"><a href="optimization.html#cb616-1" tabindex="-1"></a> syns <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">status_quo =</span> <span class="fu">c</span>(<span class="st">&#39;fldcult&#39;</span>, <span class="st">&#39;harrow&#39;</span>, <span class="st">&#39;rowcult&#39;</span>, <span class="st">&#39;fallplow&#39;</span>),</span>
<span id="cb616-2"><a href="optimization.html#cb616-2" tabindex="-1"></a>                      <span class="at">scenario   =</span> <span class="fu">c</span>(<span class="st">&#39;notill&#39;</span>, <span class="st">&#39;notill&#39;</span>, <span class="st">&#39;notill&#39;</span>, <span class="st">&#39;notill&#39;</span>))</span></code></pre></div>
<p>“If start and end year are not already adjusted in the project folder you can do that now for the status quo and all scenarios to ensure that all managements cover the same time period.”</p>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="optimization.html#cb617-1" tabindex="-1"></a>start_year <span class="ot">&lt;-</span> <span class="dv">2013</span> <span class="co"># Optional, set value if needed</span></span>
<span id="cb617-2"><a href="optimization.html#cb617-2" tabindex="-1"></a>end_year <span class="ot">&lt;-</span> <span class="dv">2020</span> <span class="co"># Optional, set value if needed</span></span></code></pre></div>
<p>“The following function might give an error if you have more than one land use class without management schedules</p>
<ul>
<li><p>solution 1: define mgt operations for those classes and run farmr again</p></li>
<li><p>solution 2: re-install the farmr using <code>remotes::install_github("chrisschuerz/SWATfarmR/tree/dev_ms")</code>and run <code>farmr</code> again”</p></li>
</ul>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb618-1"><a href="optimization.html#cb618-1" tabindex="-1"></a>mgt_scen_write_path <span class="ot">=</span> <span class="st">&quot;model_data/input/measure/management_scenario_inputs&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb619-1"><a href="optimization.html#cb619-1" tabindex="-1"></a><span class="fu">prepare_management_scenario_inputs</span>(</span>
<span id="cb619-2"><a href="optimization.html#cb619-2" tabindex="-1"></a>  <span class="at">project_path =</span> txt_path,</span>
<span id="cb619-3"><a href="optimization.html#cb619-3" tabindex="-1"></a>  <span class="at">status_quo   =</span> stat_quo_farmR,</span>
<span id="cb619-4"><a href="optimization.html#cb619-4" tabindex="-1"></a>  <span class="at">scenarios    =</span> scenario_farmR,</span>
<span id="cb619-5"><a href="optimization.html#cb619-5" tabindex="-1"></a>  <span class="at">synonyms =</span> syns,</span>
<span id="cb619-6"><a href="optimization.html#cb619-6" tabindex="-1"></a>  <span class="at">start_year =</span> start_year,</span>
<span id="cb619-7"><a href="optimization.html#cb619-7" tabindex="-1"></a>  <span class="at">end_year =</span> end_year,</span>
<span id="cb619-8"><a href="optimization.html#cb619-8" tabindex="-1"></a>  <span class="at">write_path =</span> mgt_scen_write_path,</span>
<span id="cb619-9"><a href="optimization.html#cb619-9" tabindex="-1"></a>  <span class="at">write_csv_mgts =</span> <span class="cn">TRUE</span></span>
<span id="cb619-10"><a href="optimization.html#cb619-10" tabindex="-1"></a>)</span></code></pre></div>
<p>The prepared management files are always saved with a time stamp in the file name. This routine identifies the most recent one which is then used as input in the NSWRM definition. Define the file name manually if another file should be used.</p>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb620-1"><a href="optimization.html#cb620-1" tabindex="-1"></a>mgt_def_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(mgt_scen_write_path, <span class="at">pattern =</span> <span class="st">&#39;.rds&#39;</span>)</span>
<span id="cb620-2"><a href="optimization.html#cb620-2" tabindex="-1"></a>time_stamps <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&#39;_&#39;</span>, <span class="st">&#39;&#39;</span>, <span class="fu">substr</span>(mgt_def_files, <span class="dv">1</span>, <span class="dv">13</span>)))</span>
<span id="cb620-3"><a href="optimization.html#cb620-3" tabindex="-1"></a>last_mgt <span class="ot">&lt;-</span> <span class="fu">which.max</span>(time_stamps)</span>
<span id="cb620-4"><a href="optimization.html#cb620-4" tabindex="-1"></a>mgt_path  <span class="ot">&lt;-</span> <span class="fu">paste0</span>(mgt_scen_write_path, <span class="st">&#39;/&#39;</span>, mgt_def_files[last_mgt])</span>
<span id="cb620-5"><a href="optimization.html#cb620-5" tabindex="-1"></a>mgt_path</span></code></pre></div>
<pre><code>## [1] &quot;model_data/input/measure/management_scenario_inputs/20241121_1424_mgt_scenarios.rds&quot;</code></pre>
</div>
<div id="creating-a-new-measr-project" class="section level4 hasAnchor" number="22.2.1.3">
<h4><span class="header-section-number">22.2.1.3</span> Creating a new measR project<a href="optimization.html#creating-a-new-measr-project" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb622-1"><a href="optimization.html#cb622-1" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">&quot;model_data/cs10_setup/optimization/txt&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;.measr&quot;</span>, <span class="at">full.names =</span> T))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb624-1"><a href="optimization.html#cb624-1" tabindex="-1"></a><span class="fu">new_measr</span>(<span class="st">&quot;cs10_comola&quot;</span>, <span class="at">project_path =</span> txt_path)</span></code></pre></div>
<pre><code>## Input files read from the SWAT+ project located in
##  model_data/cs10_setup/optimization/txt/ 
## SWATmeasR object saved as &#39;cs10_comola.measr&#39; in this path.</code></pre>
</div>
<div id="load-measure-definitions" class="section level4 hasAnchor" number="22.2.1.4">
<h4><span class="header-section-number">22.2.1.4</span> Load measure definitions<a href="optimization.html#load-measure-definitions" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>“The required input file, which provides all necessary parametric inputs, is provided with the input argument <code>file_path</code>. To indicate which type of NSWRM is defined the correct <code>type</code> must be passed with the argument type. The optional argument <code>overwrite</code> gives the option to overwrite already existing NSWRM definitions <strong>of the same type</strong>. By default <code>overwrite = FALSE</code>. Therefore, if for example a definition of land use type NSWRMs already exists, but a new one should be loaded, overwrite has to be set to overwrite = TRUE. The five possible NSWRM types require different definition input files, which will be explained in the following.”</p>
<div id="land-use-definitions" class="section level5 hasAnchor" number="22.2.1.4.1">
<h5><span class="header-section-number">22.2.1.4.1</span> Land use definitions<a href="optimization.html#land-use-definitions" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The following are our land use definitions.</p>
<div class="sourceCode" id="cb626"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb626-1"><a href="optimization.html#cb626-1" tabindex="-1"></a>luse_path <span class="ot">&lt;-</span> <span class="st">&quot;model_data/input/measure/parameterisation/measure_landuse_CS10.csv&quot;</span></span>
<span id="cb626-2"><a href="optimization.html#cb626-2" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">read_csv</span>(luse_path, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">datatable</span>()</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-1a9e8801d60aebecf54f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1a9e8801d60aebecf54f">{"x":{"filter":"none","vertical":false,"data":[["1","2"],["buffer","grassslope"],["rngb_com","past_com"],["_012f_6_rn_2_mgt","_012f_6_rn_2_mgt"],["pasth","pasth"],["rngb_cons","past_cons"],["densegrass","densegrass"],[null,null],[null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>nswrm<\/th>\n      <th>plnt_com<\/th>\n      <th>mgt<\/th>\n      <th>cn2<\/th>\n      <th>cons_prac<\/th>\n      <th>ov_mann<\/th>\n      <th>tile<\/th>\n      <th>lum_dtl<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"nswrm","targets":1},{"name":"plnt_com","targets":2},{"name":"mgt","targets":3},{"name":"cn2","targets":4},{"name":"cons_prac","targets":5},{"name":"ov_mann","targets":6},{"name":"tile","targets":7},{"name":"lum_dtl","targets":8}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>The strange thing you might notice about the management is that it is using the schedules of a seemingly random agricultural field in the model setup. However, this is nor a random schedule, it is one picked out specifically because it only has grass stuff scheduled.</p>
<p>Lessons Learned: It would probably be better to define a specific management for our measures.</p>
<p>Lets add it to the measure Project:</p>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="optimization.html#cb627-1" tabindex="-1"></a>cs10_comola<span class="sc">$</span><span class="fu">load_nswrm_definition</span>(<span class="at">file_path =</span> luse_path,</span>
<span id="cb627-2"><a href="optimization.html#cb627-2" tabindex="-1"></a>                                  <span class="at">type =</span> <span class="st">&#39;land_use&#39;</span>,</span>
<span id="cb627-3"><a href="optimization.html#cb627-3" tabindex="-1"></a>                                  <span class="at">overwrite =</span> T)</span></code></pre></div>
</div>
<div id="wetland-definitions" class="section level5 hasAnchor" number="22.2.1.4.2">
<h5><span class="header-section-number">22.2.1.4.2</span> Wetland Definitions<a href="optimization.html#wetland-definitions" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Our wetlands are technically Retention Ponds, however in the model it makes the most sense to call them “wetlands”. The provided definition file is here:</p>
<div class="sourceCode" id="cb628"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb628-1"><a href="optimization.html#cb628-1" tabindex="-1"></a>wetl_path <span class="ot">&lt;-</span><span class="st">&#39;model_data/input/measure/parameterisation/measure_wetland_CS10.csv&#39;</span></span>
<span id="cb628-2"><a href="optimization.html#cb628-2" tabindex="-1"></a><span class="fu">read_csv</span>(wetl_path, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">datatable</span>()</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-6238d8345c59711c8a60" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6238d8345c59711c8a60">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30"],[5611,5612,5613,5614,5615,5616,5617,5641,5642,5643,5644,5645,5646,5647,5648,5657,5658,5659,5660,5708,350,351,352,353,1838,1839,1935,1936,1937,1938],["wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum","wetf_lum"],[376,376,376,376,376,376,376,376,376,376,376,376,376,376,376,376,376,376,376,376,null,null,null,null,74,74,74,74,74,74],[0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5],[500,500,500,500,500,500,500,500,500,500,500,500,500,500,500,500,500,500,500,500,500,500,500,500,500,500,500,500,500,500],[0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95,0.95],[650,650,650,650,650,650,650,650,650,650,650,650,650,650,650,650,650,650,650,650,650,650,650,650,650,650,650,650,650,650],[5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],[0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96,0.96],["wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland","wetland"],["sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1","sedwet1"],["nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1","nutwet1"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>hru_id<\/th>\n      <th>lu_mgt<\/th>\n      <th>cha_to_id<\/th>\n      <th>hru_ps<\/th>\n      <th>dp_ps<\/th>\n      <th>hru_es<\/th>\n      <th>dp_es<\/th>\n      <th>k<\/th>\n      <th>evap<\/th>\n      <th>vol_area_co<\/th>\n      <th>vol_dp_a<\/th>\n      <th>vol_dp_b<\/th>\n      <th>hru_frac<\/th>\n      <th>rel<\/th>\n      <th>sed<\/th>\n      <th>nut<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3,4,5,6,7,8,9,13]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"hru_id","targets":1},{"name":"lu_mgt","targets":2},{"name":"cha_to_id","targets":3},{"name":"hru_ps","targets":4},{"name":"dp_ps","targets":5},{"name":"hru_es","targets":6},{"name":"dp_es","targets":7},{"name":"k","targets":8},{"name":"evap","targets":9},{"name":"vol_area_co","targets":10},{"name":"vol_dp_a","targets":11},{"name":"vol_dp_b","targets":12},{"name":"hru_frac","targets":13},{"name":"rel","targets":14},{"name":"sed","targets":15},{"name":"nut","targets":16}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>These are mostly the default parameters and could be improved. See issue <a href="https://gitlab.nibio.no/moritzshore/swat-cs10/-/issues/117">#117</a></p>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="optimization.html#cb629-1" tabindex="-1"></a>cs10_comola<span class="sc">$</span><span class="fu">load_nswrm_definition</span>(wetl_path, <span class="st">&#39;wetland&#39;</span>, <span class="at">overwrite =</span> T)</span></code></pre></div>
</div>
<div id="management-definitions" class="section level5 hasAnchor" number="22.2.1.4.3">
<h5><span class="header-section-number">22.2.1.4.3</span> Management Definitions<a href="optimization.html#management-definitions" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb630"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb630-1"><a href="optimization.html#cb630-1" tabindex="-1"></a>cs10_comola<span class="sc">$</span><span class="fu">load_nswrm_definition</span>(mgt_path,  <span class="st">&#39;management&#39;</span>, <span class="at">overwrite =</span> T)</span></code></pre></div>
</div>
<div id="constructed-wetlands-and-floodplains" class="section level5 hasAnchor" number="22.2.1.4.4">
<h5><span class="header-section-number">22.2.1.4.4</span> Constructed Wetlands and Floodplains<a href="optimization.html#constructed-wetlands-and-floodplains" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Also present in our potential measure map, these measures were not implemented.</p>
</div>
</div>
<div id="load-measure-locations" class="section level4 hasAnchor" number="22.2.1.5">
<h4><span class="header-section-number">22.2.1.5</span> Load Measure Locations<a href="optimization.html#load-measure-locations" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This file was created in the previous section <a href="measure-classification.html#measure-classification">21</a>.</p>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="optimization.html#cb631-1" tabindex="-1"></a>loca_path <span class="ot">&lt;-</span> <span class="st">&quot;model_data/input/measure/parameterisation/measure_location_CS10.csv&quot;</span></span>
<span id="cb631-2"><a href="optimization.html#cb631-2" tabindex="-1"></a>cs10_comola<span class="sc">$</span><span class="fu">load_nswrm_location</span>(loca_path, <span class="at">overwrite =</span> T)</span></code></pre></div>
</div>
<div id="saving-results" class="section level4 hasAnchor" number="22.2.1.6">
<h4><span class="header-section-number">22.2.1.6</span> Saving Results<a href="optimization.html#saving-results" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb632-1"><a href="optimization.html#cb632-1" tabindex="-1"></a>cs10_comola<span class="sc">$</span><span class="fu">save</span>()</span>
<span id="cb632-2"><a href="optimization.html#cb632-2" tabindex="-1"></a><span class="fu">rm</span>(cs10_comola)</span></code></pre></div>
</div>
<div id="testing-scenarios" class="section level4 hasAnchor" number="22.2.1.7">
<h4><span class="header-section-number">22.2.1.7</span> Testing Scenarios<a href="optimization.html#testing-scenarios" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Micha Code:</p>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb633-1"><a href="optimization.html#cb633-1" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;model_data/input/measure/calc_Indis.R&#39;</span>)</span>
<span id="cb633-2"><a href="optimization.html#cb633-2" tabindex="-1"></a><span class="fu">foo1</span>(<span class="fu">c</span>(<span class="st">&#39;dplyr&#39;</span> , <span class="st">&#39;readr&#39;</span> , <span class="st">&#39;tidyverse&#39;</span>, <span class="st">&#39;data.table&#39;</span>, <span class="st">&#39;remotes&#39;</span>, <span class="st">&#39;devtools&#39;</span>,</span>
<span id="cb633-3"><a href="optimization.html#cb633-3" tabindex="-1"></a>       <span class="st">&#39;xts&#39;</span>, <span class="st">&#39;dygraphs&#39;</span>, <span class="st">&#39;R.utils&#39;</span>, <span class="st">&#39;foreach&#39;</span>, <span class="st">&#39;doParallel&#39;</span>, <span class="st">&#39;data.table&#39;</span>,</span>
<span id="cb633-4"><a href="optimization.html#cb633-4" tabindex="-1"></a>       <span class="st">&#39;ggplot2&#39;</span>, <span class="st">&#39;fmsb&#39;</span>, <span class="st">&#39;patchwork&#39;</span>))</span>
<span id="cb633-5"><a href="optimization.html#cb633-5" tabindex="-1"></a><span class="fu">foo2</span>(<span class="st">&#39;SWATmeasR&#39;</span>)</span>
<span id="cb633-6"><a href="optimization.html#cb633-6" tabindex="-1"></a><span class="fu">foo3</span>(<span class="st">&#39;hydroGOF&#39;</span>)</span></code></pre></div>
<p>Define paths and settings:</p>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb634-1"><a href="optimization.html#cb634-1" tabindex="-1"></a>measr_name <span class="ot">&lt;-</span> <span class="st">&#39;cs10_comola&#39;</span> </span>
<span id="cb634-2"><a href="optimization.html#cb634-2" tabindex="-1"></a>scen_out <span class="ot">&lt;-</span> <span class="st">&#39;scenario_outputs&#39;</span></span>
<span id="cb634-3"><a href="optimization.html#cb634-3" tabindex="-1"></a>cha_id <span class="ot">&lt;-</span> <span class="dv">37</span> </span>
<span id="cb634-4"><a href="optimization.html#cb634-4" tabindex="-1"></a>wd <span class="ot">&lt;-</span> <span class="st">&quot;model_data/cs10_setup/optimization&quot;</span></span></code></pre></div>
<p>Grabbing measures:</p>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb635-1"><a href="optimization.html#cb635-1" tabindex="-1"></a>project_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(wd,<span class="st">&#39;/txt&#39;</span>)</span>
<span id="cb635-2"><a href="optimization.html#cb635-2" tabindex="-1"></a>cal_files <span class="ot">&lt;-</span> <span class="fu">dir</span>(<span class="fu">paste0</span>(wd,<span class="st">&#39;/cal_files&#39;</span>), <span class="at">full.names =</span> T)</span>
<span id="cb635-3"><a href="optimization.html#cb635-3" tabindex="-1"></a><span class="fu">load_measr</span>(<span class="fu">paste0</span>(project_path, <span class="st">&#39;/&#39;</span>, measr_name,<span class="st">&#39;.measr&#39;</span>))</span>
<span id="cb635-4"><a href="optimization.html#cb635-4" tabindex="-1"></a><span class="fu">assign</span>(<span class="st">&#39;measr&#39;</span>, <span class="fu">get</span>(<span class="fu">gsub</span>(<span class="st">&#39;.measr&#39;</span>, <span class="st">&#39;&#39;</span>, measr_name)))</span>
<span id="cb635-5"><a href="optimization.html#cb635-5" tabindex="-1"></a>loca <span class="ot">&lt;-</span> measr<span class="sc">$</span>.data<span class="sc">$</span>nswrm_definition<span class="sc">$</span>nswrm_locations</span>
<span id="cb635-6"><a href="optimization.html#cb635-6" tabindex="-1"></a>measr.list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;statusquo&#39;</span>,<span class="fu">unique</span>(loca<span class="sc">$</span>nswrm),<span class="st">&#39;all&#39;</span>)</span>
<span id="cb635-7"><a href="optimization.html#cb635-7" tabindex="-1"></a>measr.list</span></code></pre></div>
<pre><code>## [1] &quot;statusquo&quot;  &quot;buffer&quot;     &quot;grassslope&quot; &quot;notill&quot;     &quot;wetland&quot;   
## [6] &quot;all&quot;</code></pre>
<p>Creating the <code>hru_agr.txt</code> requires detecting agricultural fields. in our case this can be done with the janky prefixes <code>_0, a_, _1, _2</code> . They are janky because the SWATxxxxR packages kept truncating them :(. This file is important for indicator calculation.</p>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb637-1"><a href="optimization.html#cb637-1" tabindex="-1"></a>agri_prefix <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;_0&quot;</span>, <span class="st">&quot;a_&quot;</span>, <span class="st">&quot;_1&quot;</span>, <span class="st">&quot;_2&quot;</span>)</span>
<span id="cb637-2"><a href="optimization.html#cb637-2" tabindex="-1"></a>hru_dat <span class="ot">&lt;-</span> <span class="fu">read_tbl</span>(<span class="st">&#39;hru-data.hru&#39;</span>, project_path, <span class="at">n_skip =</span> <span class="dv">2</span>)</span>
<span id="cb637-3"><a href="optimization.html#cb637-3" tabindex="-1"></a>hru_agr <span class="ot">&lt;-</span> hru_dat <span class="sc">%&gt;%</span> </span>
<span id="cb637-4"><a href="optimization.html#cb637-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">substring</span>(lu_mgt, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">%in%</span> agri_prefix) <span class="sc">%&gt;%</span></span>
<span id="cb637-5"><a href="optimization.html#cb637-5" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">hru_id =</span> id)</span>
<span id="cb637-6"><a href="optimization.html#cb637-6" tabindex="-1"></a><span class="fu">write.table</span>(hru_agr, <span class="fu">paste0</span>(project_path, <span class="st">&#39;/hru_agr.txt&#39;</span>),</span>
<span id="cb637-7"><a href="optimization.html#cb637-7" tabindex="-1"></a>            <span class="at">quote =</span> F, <span class="at">row.names =</span> F)</span></code></pre></div>
<p>Running the scenarios: (code modified from Micha source)</p>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb638-1"><a href="optimization.html#cb638-1" tabindex="-1"></a><span class="fu">run_scenarios</span>(<span class="at">swat_exe =</span> <span class="st">&#39;Rev_61_0_64rel.exe&#39;</span>, </span>
<span id="cb638-2"><a href="optimization.html#cb638-2" tabindex="-1"></a>  <span class="at">base_path =</span> <span class="st">&quot;model_data/cs10_setup/optimization/&quot;</span>,</span>
<span id="cb638-3"><a href="optimization.html#cb638-3" tabindex="-1"></a>  <span class="at">scen_output =</span> <span class="st">&quot;model_data/cs10_setup/optimization/measure_scenario_output&quot;</span>,</span>
<span id="cb638-4"><a href="optimization.html#cb638-4" tabindex="-1"></a>  <span class="at">measure.list =</span> measr.list,</span>
<span id="cb638-5"><a href="optimization.html#cb638-5" tabindex="-1"></a>  <span class="at">outflow_reach =</span> cha_id</span>
<span id="cb638-6"><a href="optimization.html#cb638-6" tabindex="-1"></a>)</span></code></pre></div>
<div id="calculating-indicators" class="section level5 hasAnchor" number="22.2.1.7.1">
<h5><span class="header-section-number">22.2.1.7.1</span> Calculating Indicators<a href="optimization.html#calculating-indicators" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>In case an ensemble of calibration files is provided (in folder cal_files), set <code>ensemble=T</code> The resulting dataframe will provide you the ensemble mean as well as the ensemble minimum (lower) and maximum (upper) of the respective indicator. If no cal file ensemble can be provided, set <code>ensemble=F</code> (but then make sure you have a <code>calibration.cal</code> with fitted parameters in the <code>txt</code> folder)</p>
<div class="sourceCode" id="cb639"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb639-1"><a href="optimization.html#cb639-1" tabindex="-1"></a>scen_out <span class="ot">=</span> <span class="st">&quot;measure_scenario_output&quot;</span></span>
<span id="cb639-2"><a href="optimization.html#cb639-2" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">paste</span>(wd, scen_out, measr.list[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(measr.list))], <span class="at">sep=</span><span class="st">&#39;/&#39;</span>)</span>
<span id="cb639-3"><a href="optimization.html#cb639-3" tabindex="-1"></a>channel <span class="ot">&lt;-</span> <span class="st">&#39;cha037&#39;</span></span>
<span id="cb639-4"><a href="optimization.html#cb639-4" tabindex="-1"></a></span>
<span id="cb639-5"><a href="optimization.html#cb639-5" tabindex="-1"></a>cha_aa_all <span class="ot">&lt;-</span> <span class="fu">ind_cha_aa</span>(<span class="at">path =</span> path, <span class="at">channel=</span>channel, <span class="at">ensemble=</span>F) </span>
<span id="cb639-6"><a href="optimization.html#cb639-6" tabindex="-1"></a></span>
<span id="cb639-7"><a href="optimization.html#cb639-7" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(cal_files)<span class="sc">&gt;</span><span class="dv">0</span>){</span>
<span id="cb639-8"><a href="optimization.html#cb639-8" tabindex="-1"></a>  Q_metrics_sq <span class="ot">&lt;-</span> <span class="fu">get_ens_Q_metrics</span>()</span>
<span id="cb639-9"><a href="optimization.html#cb639-9" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb639-10"><a href="optimization.html#cb639-10" tabindex="-1"></a>  Q_metrics_sq <span class="ot">&lt;-</span> <span class="fu">ind_cha_dayII</span>(path, <span class="at">channel =</span> channel, <span class="at">ind =</span> <span class="st">&#39;all&#39;</span>, </span>
<span id="cb639-11"><a href="optimization.html#cb639-11" tabindex="-1"></a>                                <span class="at">ensemble =</span> F)[<span class="dv">1</span>, <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">12</span>)]</span>
<span id="cb639-12"><a href="optimization.html#cb639-12" tabindex="-1"></a>}</span>
<span id="cb639-13"><a href="optimization.html#cb639-13" tabindex="-1"></a></span>
<span id="cb639-14"><a href="optimization.html#cb639-14" tabindex="-1"></a>Q_p05_sq <span class="ot">&lt;-</span> Q_metrics_sq<span class="sc">$</span>Q_p05</span>
<span id="cb639-15"><a href="optimization.html#cb639-15" tabindex="-1"></a>Q_p95_sq <span class="ot">&lt;-</span> Q_metrics_sq<span class="sc">$</span>Q_p95</span>
<span id="cb639-16"><a href="optimization.html#cb639-16" tabindex="-1"></a></span>
<span id="cb639-17"><a href="optimization.html#cb639-17" tabindex="-1"></a>cha_day_all <span class="ot">&lt;-</span> <span class="fu">ind_cha_dayII</span>(path, <span class="at">channel=</span>channel, <span class="st">&#39;all&#39;</span>,</span>
<span id="cb639-18"><a href="optimization.html#cb639-18" tabindex="-1"></a>                             <span class="at">ensemble=</span>F,</span>
<span id="cb639-19"><a href="optimization.html#cb639-19" tabindex="-1"></a>                             <span class="at">threshold_lowQ =</span> Q_p05_sq,   <span class="co">#adjust if appropriate</span></span>
<span id="cb639-20"><a href="optimization.html#cb639-20" tabindex="-1"></a>                             <span class="at">threshold_highQ =</span> Q_p95_sq,  <span class="co">#adjust if appropriate</span></span>
<span id="cb639-21"><a href="optimization.html#cb639-21" tabindex="-1"></a>                             <span class="at">threshold_N =</span> <span class="fl">0.775</span>,         <span class="co">#adjust if appropriate</span></span>
<span id="cb639-22"><a href="optimization.html#cb639-22" tabindex="-1"></a>                             <span class="at">threshold_P =</span> <span class="fl">0.06</span>,          <span class="co">#adjust if appropriate</span></span>
<span id="cb639-23"><a href="optimization.html#cb639-23" tabindex="-1"></a>                             <span class="at">threshold_Sed=</span> <span class="dv">50</span>)           <span class="co">#adjust if appropriate</span></span>
<span id="cb639-24"><a href="optimization.html#cb639-24" tabindex="-1"></a></span>
<span id="cb639-25"><a href="optimization.html#cb639-25" tabindex="-1"></a><span class="do">###  collect HRU-based indicators related to water quality (average annual losses)</span></span>
<span id="cb639-26"><a href="optimization.html#cb639-26" tabindex="-1"></a>hru_aa_nb_all <span class="ot">&lt;-</span> <span class="fu">ind_hru_aa_nb</span>(path, <span class="at">a=</span><span class="st">&#39;agr&#39;</span>, <span class="at">ensemble=</span>F)</span>
<span id="cb639-27"><a href="optimization.html#cb639-27" tabindex="-1"></a></span>
<span id="cb639-28"><a href="optimization.html#cb639-28" tabindex="-1"></a><span class="do">###  collect HRU-based indicators related to  water quantity (average annual value)</span></span>
<span id="cb639-29"><a href="optimization.html#cb639-29" tabindex="-1"></a>hru_aa_wb_all <span class="ot">&lt;-</span> <span class="fu">ind_hru_aa_wb</span>(path, <span class="at">a=</span><span class="st">&#39;agr&#39;</span>, <span class="at">ensemble=</span>F)</span>
<span id="cb639-30"><a href="optimization.html#cb639-30" tabindex="-1"></a></span>
<span id="cb639-31"><a href="optimization.html#cb639-31" tabindex="-1"></a><span class="do">###  collect HRU-based indicators related to  water quantity (aa for spec. months)</span></span>
<span id="cb639-32"><a href="optimization.html#cb639-32" tabindex="-1"></a><span class="do">## please specify start and end months of interest for the soil water analysis</span></span>
<span id="cb639-33"><a href="optimization.html#cb639-33" tabindex="-1"></a><span class="co"># this is an example for printing sw for the period May to September and also</span></span>
<span id="cb639-34"><a href="optimization.html#cb639-34" tabindex="-1"></a><span class="co"># for each single month in that period</span></span>
<span id="cb639-35"><a href="optimization.html#cb639-35" tabindex="-1"></a>sw_periods <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">9</span>), <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)</span>
<span id="cb639-36"><a href="optimization.html#cb639-36" tabindex="-1"></a>hru_mon_all <span class="ot">&lt;-</span> <span class="fu">ind_hru_mon_wb</span>(path, <span class="at">period =</span> sw_periods, <span class="at">a=</span><span class="st">&#39;agr&#39;</span>, <span class="at">ensemble=</span>F)</span>
<span id="cb639-37"><a href="optimization.html#cb639-37" tabindex="-1"></a></span>
<span id="cb639-38"><a href="optimization.html#cb639-38" tabindex="-1"></a><span class="co"># collect cropping information for all scenarios - grain units and cultivated</span></span>
<span id="cb639-39"><a href="optimization.html#cb639-39" tabindex="-1"></a><span class="co"># hectare average annual</span></span>
<span id="cb639-40"><a href="optimization.html#cb639-40" tabindex="-1"></a></span>
<span id="cb639-41"><a href="optimization.html#cb639-41" tabindex="-1"></a><span class="co"># define 1) path, 2) crop selection, 3) type of output: a) yield, b) ha, 4)</span></span>
<span id="cb639-42"><a href="optimization.html#cb639-42" tabindex="-1"></a><span class="co"># specify grain units equivalent for all of the selected crops (if you just keep</span></span>
<span id="cb639-43"><a href="optimization.html#cb639-43" tabindex="-1"></a><span class="co"># the parameter &#39;grain_units&#39;, there is already a parameterisation for &#39;wwht&#39;,</span></span>
<span id="cb639-44"><a href="optimization.html#cb639-44" tabindex="-1"></a><span class="co"># &#39;akgs&#39;, &#39;wbar&#39;, &#39;wira&#39;, &#39;csil&#39;, &#39;wiry&#39;, &#39;sgbt&#39;,&#39;barl&#39;. The measure list</span></span>
<span id="cb639-45"><a href="optimization.html#cb639-45" tabindex="-1"></a><span class="co"># (measr.list) can be adapted to the measures you want to compare</span></span>
<span id="cb639-46"><a href="optimization.html#cb639-46" tabindex="-1"></a></span>
<span id="cb639-47"><a href="optimization.html#cb639-47" tabindex="-1"></a>crop_sel <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;wwht&#39;</span>, <span class="st">&#39;oats&#39;</span>, <span class="st">&#39;swht&#39;</span>, <span class="st">&#39;pota&#39;</span>, <span class="st">&#39;barl&#39;</span>) <span class="co">#adjust</span></span>
<span id="cb639-48"><a href="optimization.html#cb639-48" tabindex="-1"></a></span>
<span id="cb639-49"><a href="optimization.html#cb639-49" tabindex="-1"></a><span class="co"># If you want to use grain units to normalize the basin wide sum of crop yields</span></span>
<span id="cb639-50"><a href="optimization.html#cb639-50" tabindex="-1"></a><span class="co"># by crop-specific nutritional values, please specify grain units for relevant</span></span>
<span id="cb639-51"><a href="optimization.html#cb639-51" tabindex="-1"></a><span class="co"># crops The grain units must be applicable to dry mass!!!</span></span>
<span id="cb639-52"><a href="optimization.html#cb639-52" tabindex="-1"></a>grain_units <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&#39;barl&#39;</span> <span class="ot">=</span> <span class="fl">1.163</span>,</span>
<span id="cb639-53"><a href="optimization.html#cb639-53" tabindex="-1"></a>                          <span class="st">&#39;wwht&#39;</span> <span class="ot">=</span> <span class="fl">1.209</span>,</span>
<span id="cb639-54"><a href="optimization.html#cb639-54" tabindex="-1"></a>                          <span class="st">&#39;oats&#39;</span> <span class="ot">=</span> <span class="fl">0.682</span>,</span>
<span id="cb639-55"><a href="optimization.html#cb639-55" tabindex="-1"></a>                          <span class="st">&#39;swht&#39;</span> <span class="ot">=</span> <span class="fl">1.174</span>,</span>
<span id="cb639-56"><a href="optimization.html#cb639-56" tabindex="-1"></a>                          <span class="st">&#39;pota&#39;</span> <span class="ot">=</span> <span class="dv">1</span>)</span>
<span id="cb639-57"><a href="optimization.html#cb639-57" tabindex="-1"></a></span>
<span id="cb639-58"><a href="optimization.html#cb639-58" tabindex="-1"></a><span class="do">### collect basin-wide area of cropland</span></span>
<span id="cb639-59"><a href="optimization.html#cb639-59" tabindex="-1"></a>crop_aa_ha <span class="ot">&lt;-</span> <span class="fu">ind_bsn_aa_crp</span>(path, crop_sel, <span class="at">out_type =</span> <span class="st">&quot;ha&quot;</span>, grain_units, <span class="at">ensemble=</span>F)</span>
<span id="cb639-60"><a href="optimization.html#cb639-60" tabindex="-1"></a></span>
<span id="cb639-61"><a href="optimization.html#cb639-61" tabindex="-1"></a><span class="do">### collect sum of grain units for whole basin</span></span>
<span id="cb639-62"><a href="optimization.html#cb639-62" tabindex="-1"></a><span class="co">#run next line only if you want to calculate yield based on grain units</span></span>
<span id="cb639-63"><a href="optimization.html#cb639-63" tabindex="-1"></a>crop_aa_gu <span class="ot">&lt;-</span> <span class="fu">ind_bsn_aa_crp</span>(path, crop_sel, <span class="at">out_type =</span> <span class="st">&quot;yield&quot;</span>, grain_units, <span class="at">ensemble=</span>F)</span>
<span id="cb639-64"><a href="optimization.html#cb639-64" tabindex="-1"></a></span>
<span id="cb639-65"><a href="optimization.html#cb639-65" tabindex="-1"></a></span>
<span id="cb639-66"><a href="optimization.html#cb639-66" tabindex="-1"></a><span class="do">### collect cropping information for all scenarios - Crop specific average annual yield and ha</span></span>
<span id="cb639-67"><a href="optimization.html#cb639-67" tabindex="-1"></a>crop_aa_all <span class="ot">&lt;-</span> <span class="fu">ind_bsn_aa_crp_ha_Y</span>(path, crop_sel, <span class="at">ensemble=</span>F)</span></code></pre></div>
</div>
<div id="plotting-results" class="section level5 hasAnchor" number="22.2.1.7.2">
<h5><span class="header-section-number">22.2.1.7.2</span> Plotting Results<a href="optimization.html#plotting-results" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb640"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb640-1"><a href="optimization.html#cb640-1" tabindex="-1"></a>ens_results <span class="ot">&lt;-</span> <span class="fu">get_all_ens_results</span>()</span>
<span id="cb640-2"><a href="optimization.html#cb640-2" tabindex="-1"></a></span>
<span id="cb640-3"><a href="optimization.html#cb640-3" tabindex="-1"></a><span class="co"># calculate percentage changes to status quo and derive statistics</span></span>
<span id="cb640-4"><a href="optimization.html#cb640-4" tabindex="-1"></a><span class="co"># (mean, median, min, max) in case a cal file ensemble has been used</span></span>
<span id="cb640-5"><a href="optimization.html#cb640-5" tabindex="-1"></a>ens_stats_all <span class="ot">&lt;-</span> <span class="fu">calc_ens_stats</span>()</span>
<span id="cb640-6"><a href="optimization.html#cb640-6" tabindex="-1"></a></span>
<span id="cb640-7"><a href="optimization.html#cb640-7" tabindex="-1"></a><span class="co"># plot the scenario results as stacked bars</span></span>
<span id="cb640-8"><a href="optimization.html#cb640-8" tabindex="-1"></a><span class="co"># default here is to plot the median values (perhaps more robust than mean)</span></span>
<span id="cb640-9"><a href="optimization.html#cb640-9" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(cal_files)<span class="sc">&gt;</span><span class="dv">0</span>){</span>
<span id="cb640-10"><a href="optimization.html#cb640-10" tabindex="-1"></a>  df <span class="ot">&lt;-</span> ens_stats_all <span class="sc">%&gt;%</span></span>
<span id="cb640-11"><a href="optimization.html#cb640-11" tabindex="-1"></a>    <span class="fu">filter</span>(stats <span class="sc">==</span> <span class="st">&#39;median&#39;</span>, scen_name <span class="sc">!=</span> <span class="st">&#39;statusquo&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb640-12"><a href="optimization.html#cb640-12" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>stats)</span>
<span id="cb640-13"><a href="optimization.html#cb640-13" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb640-14"><a href="optimization.html#cb640-14" tabindex="-1"></a>  df <span class="ot">&lt;-</span> ens_stats_all[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb640-15"><a href="optimization.html#cb640-15" tabindex="-1"></a>}</span>
<span id="cb640-16"><a href="optimization.html#cb640-16" tabindex="-1"></a></span>
<span id="cb640-17"><a href="optimization.html#cb640-17" tabindex="-1"></a>df_plot_long <span class="ot">&lt;-</span> <span class="fu">melt</span>(<span class="fu">setDT</span>(df), <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;scen_name&quot;</span>), <span class="at">variable.name =</span> <span class="st">&quot;indi&quot;</span>)</span>
<span id="cb640-18"><a href="optimization.html#cb640-18" tabindex="-1"></a></span>
<span id="cb640-19"><a href="optimization.html#cb640-19" tabindex="-1"></a><span class="co">#plot_indicators(df_plot_long, separate=F)</span></span>
<span id="cb640-20"><a href="optimization.html#cb640-20" tabindex="-1"></a></span>
<span id="cb640-21"><a href="optimization.html#cb640-21" tabindex="-1"></a><span class="fu">plot_indicators</span>(df_plot_long, <span class="at">separate=</span>T)</span>
<span id="cb640-22"><a href="optimization.html#cb640-22" tabindex="-1"></a></span>
<span id="cb640-23"><a href="optimization.html#cb640-23" tabindex="-1"></a><span class="co"># save as pdf</span></span>
<span id="cb640-24"><a href="optimization.html#cb640-24" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&#39;model_data/results/plot_indicators_all_median.pdf&#39;</span>, <span class="at">width=</span><span class="fl">7.5</span>, <span class="at">height =</span> <span class="dv">10</span>)</span>
<span id="cb640-25"><a href="optimization.html#cb640-25" tabindex="-1"></a><span class="fu">plot_indicators</span>(df_plot_long, <span class="at">separate=</span>F)</span>
<span id="cb640-26"><a href="optimization.html#cb640-26" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb640-27"><a href="optimization.html#cb640-27" tabindex="-1"></a></span>
<span id="cb640-28"><a href="optimization.html#cb640-28" tabindex="-1"></a><span class="co"># save as pdf</span></span>
<span id="cb640-29"><a href="optimization.html#cb640-29" tabindex="-1"></a><span class="fu">png</span>(<span class="st">&#39;model_data/results/plot_indicators_all_median.png&#39;</span>, <span class="at">width =</span> <span class="fl">7.5</span>, <span class="at">height =</span> <span class="dv">10</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>, <span class="at">res =</span> <span class="dv">72</span>)</span>
<span id="cb640-30"><a href="optimization.html#cb640-30" tabindex="-1"></a><span class="fu">plot_indicators</span>(df_plot_long, <span class="at">separate=</span>F)</span>
<span id="cb640-31"><a href="optimization.html#cb640-31" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb640-32"><a href="optimization.html#cb640-32" tabindex="-1"></a></span>
<span id="cb640-33"><a href="optimization.html#cb640-33" tabindex="-1"></a><span class="co"># generate results table</span></span>
<span id="cb640-34"><a href="optimization.html#cb640-34" tabindex="-1"></a><span class="co"># In case cal file ensemble was used the table shows median, min, and max values</span></span>
<span id="cb640-35"><a href="optimization.html#cb640-35" tabindex="-1"></a><span class="co"># for % changes to status quo. The status quo itself is shown in absolute values</span></span>
<span id="cb640-36"><a href="optimization.html#cb640-36" tabindex="-1"></a><span class="co"># in SWAT model units.</span></span>
<span id="cb640-37"><a href="optimization.html#cb640-37" tabindex="-1"></a></span>
<span id="cb640-38"><a href="optimization.html#cb640-38" tabindex="-1"></a><span class="fu">write_results_table</span>(<span class="at">outfile =</span> <span class="st">&quot;model_data/cs10_setup/optimization/measure_scenario_output/ind_scenario_results.csv&quot;</span>)</span></code></pre></div>
</div>
</div>
</div>
</div>
<div id="economic-model-setup" class="section level2 hasAnchor" number="22.3">
<h2><span class="header-section-number">22.3</span> Economic Model Setup<a href="optimization.html#economic-model-setup" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To account for the implementation costs of our measures, we need to set up the Economic model</p>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb641-1"><a href="optimization.html#cb641-1" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span></span></code></pre></div>
</div>
<div id="comola-setup" class="section level2 hasAnchor" number="22.4">
<h2><span class="header-section-number">22.4</span> CoMOLA Setup<a href="optimization.html#comola-setup" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="python-installation" class="section level3 hasAnchor" number="22.4.1">
<h3><span class="header-section-number">22.4.1</span> Python Installation<a href="optimization.html#python-installation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>CoMOLA runs on Python which means we need to make sure python is installed (which it should be from the API chapter <a href="antecedent-precipitation-index.html#setting-up-python-for-rrmarkdown">9.1.2</a> However, we will create a new CoMOLA environment.</p>
<div class="sourceCode" id="cb642"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb642-1"><a href="optimization.html#cb642-1" tabindex="-1"></a><span class="fu">require</span>(reticulate)</span>
<span id="cb642-2"><a href="optimization.html#cb642-2" tabindex="-1"></a><span class="fu">conda_create</span>(<span class="st">&quot;comola&quot;</span>, <span class="co"># environment name </span></span>
<span id="cb642-3"><a href="optimization.html#cb642-3" tabindex="-1"></a>              <span class="at">packages =</span> <span class="fu">c</span>(<span class="st">&quot;numpy&quot;</span>), <span class="co"># required packages</span></span>
<span id="cb642-4"><a href="optimization.html#cb642-4" tabindex="-1"></a>              <span class="at">conda =</span> <span class="st">&quot;auto&quot;</span>, <span class="co"># auto-locate the conda exe</span></span>
<span id="cb642-5"><a href="optimization.html#cb642-5" tabindex="-1"></a>              <span class="at">python_version =</span> <span class="st">&quot;3.11.9&quot;</span>)</span>
<span id="cb642-6"><a href="optimization.html#cb642-6" tabindex="-1"></a></span>
<span id="cb642-7"><a href="optimization.html#cb642-7" tabindex="-1"></a>python_path <span class="ot">=</span> <span class="fu">conda_python</span>(<span class="st">&quot;comola&quot;</span>)</span>
<span id="cb642-8"><a href="optimization.html#cb642-8" tabindex="-1"></a></span>
<span id="cb642-9"><a href="optimization.html#cb642-9" tabindex="-1"></a><span class="co"># you need to change your R environment path in this file</span></span>
<span id="cb642-10"><a href="optimization.html#cb642-10" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">edit_r_environ</span>()</span>
<span id="cb642-11"><a href="optimization.html#cb642-11" tabindex="-1"></a></span>
<span id="cb642-12"><a href="optimization.html#cb642-12" tabindex="-1"></a><span class="co"># RETICULATE_PYTHON=&quot;YOUR ENVIRONMENT PATH/python.exe&quot;</span></span>
<span id="cb642-13"><a href="optimization.html#cb642-13" tabindex="-1"></a></span>
<span id="cb642-14"><a href="optimization.html#cb642-14" tabindex="-1"></a><span class="co"># restart your R session.</span></span>
<span id="cb642-15"><a href="optimization.html#cb642-15" tabindex="-1"></a></span>
<span id="cb642-16"><a href="optimization.html#cb642-16" tabindex="-1"></a><span class="fu">py_config</span>()</span>
<span id="cb642-17"><a href="optimization.html#cb642-17" tabindex="-1"></a></span>
<span id="cb642-18"><a href="optimization.html#cb642-18" tabindex="-1"></a><span class="co"># If everything is right, you should get something like:</span></span>
<span id="cb642-19"><a href="optimization.html#cb642-19" tabindex="-1"></a></span>
<span id="cb642-20"><a href="optimization.html#cb642-20" tabindex="-1"></a><span class="co"># python: YOUR ENVIRONMENT PATH/python.exe libpython: YOUR ENVIRONMENT</span></span>
<span id="cb642-21"><a href="optimization.html#cb642-21" tabindex="-1"></a><span class="co"># PATH/python39.dll pythonhome: YOUR ENVIRONMENT PATH version: 3.9.7 (default,</span></span>
<span id="cb642-22"><a href="optimization.html#cb642-22" tabindex="-1"></a><span class="co"># Sep 16 2021, 16:59:28) [MSC v.1916 64 bit (AMD64)] Architecture: 64bit numpy:</span></span>
<span id="cb642-23"><a href="optimization.html#cb642-23" tabindex="-1"></a><span class="co"># YOUR ENVIRONMENT PATH\lib\site-packages\numpy numpy_version: 1.21.2</span></span>
<span id="cb642-24"><a href="optimization.html#cb642-24" tabindex="-1"></a></span>
<span id="cb642-25"><a href="optimization.html#cb642-25" tabindex="-1"></a><span class="co"># After this it should work :)</span></span></code></pre></div>
<p>Note: the Numpy version is different from protocol, issue?</p>
</div>
<div id="comola-files" class="section level3 hasAnchor" number="22.4.2">
<h3><span class="header-section-number">22.4.2</span> CoMOLA Files<a href="optimization.html#comola-files" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We acquire the COMOLA project setup from project partners UFZ:</p>
<p><a href="https://github.com/michstrauch/CoMOLA_SWATplus" class="uri">https://github.com/michstrauch/CoMOLA_SWATplus</a></p>
<p>Which is located here in our repository:</p>
<blockquote>
<p><code>model_data/comola/CoMOLA_SWATplus</code></p>
</blockquote>
<p>The file structure of this setup looks like this:</p>
<div class="figure"><span style="display:block;" id="fig:comolafilestructure"></span>
<img src="figures/comola_file_struc.png" alt="COMOLA File structure" width="392" />
<p class="caption">
Figure 22.1: COMOLA File structure
</p>
</div>
<p>The files we need to modify are colored red.</p>
<ol style="list-style-type: decimal">
<li>The txt folder requires our SWAT setup + the measr project we created earlier in this section</li>
<li>SWAT.R file needs to be modified with our desired objective functions</li>
<li>config.ini needs to be updated with the path to R.exe and Python.exe. Here we also define the population and generation size of our optimization runs.</li>
</ol>
<div id="optimization-txt" class="section level4 hasAnchor" number="22.4.2.1">
<h4><span class="header-section-number">22.4.2.1</span> Optimization TXT<a href="optimization.html#optimization-txt" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We will import our TXT folder to the COMOLA txt folder. The <code>.measr</code> file in this txt is vital to the optimisation, and was the one generated in <a href="optimization.html#creating-a-new-measr-project">22.2.1.3</a>.</p>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb643-1"><a href="optimization.html#cb643-1" tabindex="-1"></a>R.utils<span class="sc">::</span><span class="fu">copyDirectory</span>(<span class="at">from =</span> <span class="st">&quot;model_data/cs10_setup/optimization/txt&quot;</span>, </span>
<span id="cb643-2"><a href="optimization.html#cb643-2" tabindex="-1"></a>                       <span class="at">to =</span> <span class="st">&quot;model_data/comola/CoMOLA_SWATplus/models/SWAT/txt&quot;</span>,</span>
<span id="cb643-3"><a href="optimization.html#cb643-3" tabindex="-1"></a>                       <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>And adjust the run periods and warming up period (skip printing length)</p>
<div class="sourceCode" id="cb644"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb644-1"><a href="optimization.html#cb644-1" tabindex="-1"></a><span class="co"># start, end, and warm-up period:</span></span>
<span id="cb644-2"><a href="optimization.html#cb644-2" tabindex="-1"></a>yrc_start <span class="ot">=</span> <span class="dv">2013</span></span>
<span id="cb644-3"><a href="optimization.html#cb644-3" tabindex="-1"></a>yrc_end <span class="ot">=</span> <span class="dv">2022</span></span>
<span id="cb644-4"><a href="optimization.html#cb644-4" tabindex="-1"></a>nskip <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb644-5"><a href="optimization.html#cb644-5" tabindex="-1"></a></span>
<span id="cb644-6"><a href="optimization.html#cb644-6" tabindex="-1"></a>time.sim <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">&quot;model_data/comola/CoMOLA_SWATplus/models/SWAT/txt/time.sim&quot;</span>)</span>
<span id="cb644-7"><a href="optimization.html#cb644-7" tabindex="-1"></a>time.sim[<span class="dv">3</span>] <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&quot;         1      &quot;</span>,yrc_start,<span class="st">&quot;       366      &quot;</span>,yrc_end,<span class="st">&quot;         0&quot;</span>)</span>
<span id="cb644-8"><a href="optimization.html#cb644-8" tabindex="-1"></a>time.sim[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [1] &quot;day_start  yrc_start   day_end   yrc_end      step  &quot;
## [2] &quot;         1      2013       366      2022         0&quot;</code></pre>
<div class="sourceCode" id="cb646"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb646-1"><a href="optimization.html#cb646-1" tabindex="-1"></a><span class="fu">writeLines</span>(time.sim, <span class="st">&quot;model_data/comola/CoMOLA_SWATplus/models/SWAT/txt/time.sim&quot;</span>)</span>
<span id="cb646-2"><a href="optimization.html#cb646-2" tabindex="-1"></a></span>
<span id="cb646-3"><a href="optimization.html#cb646-3" tabindex="-1"></a>print.prt <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">&quot;model_data/comola/CoMOLA_SWATplus/models/SWAT/txt/print.prt&quot;</span>)</span>
<span id="cb646-4"><a href="optimization.html#cb646-4" tabindex="-1"></a>print.prt[<span class="dv">3</span>] <span class="ot">=</span> <span class="fu">paste0</span>(nskip, <span class="st">&quot;          1          &quot;</span>,yrc_start,<span class="st">&quot;       0          0          1          &quot;</span>)</span>
<span id="cb646-5"><a href="optimization.html#cb646-5" tabindex="-1"></a>print.prt[<span class="dv">33</span>] <span class="ot">=</span> <span class="st">&quot;hru_wb                       n             y             n             n&quot;</span></span>
<span id="cb646-6"><a href="optimization.html#cb646-6" tabindex="-1"></a>print.prt[<span class="dv">41</span>] <span class="ot">=</span> <span class="st">&quot;channel                      n             n             n             n&quot;</span></span>
<span id="cb646-7"><a href="optimization.html#cb646-7" tabindex="-1"></a>print.prt[<span class="dv">42</span>] <span class="ot">=</span> <span class="st">&quot;channel_sd                   y             n             n             y&quot;</span></span>
<span id="cb646-8"><a href="optimization.html#cb646-8" tabindex="-1"></a></span>
<span id="cb646-9"><a href="optimization.html#cb646-9" tabindex="-1"></a><span class="fu">writeLines</span>(print.prt, <span class="st">&quot;model_data/comola/CoMOLA_SWATplus/models/SWAT/txt/print.prt&quot;</span>)</span></code></pre></div>
<p>Note, the <code>object.prt</code> file should look like this, if it doesn’t already from <a href="measure-implementation.html#measure-implementation">19</a>. Where “37” is the outlet channel of the catchment.</p>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb647-1"><a href="optimization.html#cb647-1" tabindex="-1"></a><span class="co"># object.prt: written by the OPTAIN measure scenario workflow 2024-11-05 00:44:04.143794</span></span>
<span id="cb647-2"><a href="optimization.html#cb647-2" tabindex="-1"></a><span class="co">#           ID      OBJ_TYP   OBJ_TYP_NO      HYD_TYP             FILENAME</span></span>
<span id="cb647-3"><a href="optimization.html#cb647-3" tabindex="-1"></a><span class="co">#            1          sdc           37          tot          cha_day.out</span></span></code></pre></div>
</div>
<div id="path-updates" class="section level4 hasAnchor" number="22.4.2.2">
<h4><span class="header-section-number">22.4.2.2</span> Path updates:<a href="optimization.html#path-updates" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Next, we will update our <code>SWAT.R</code> File. The following changes were made: (commented out was original code)</p>
<div class="sourceCode" id="cb648"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb648-1"><a href="optimization.html#cb648-1" tabindex="-1"></a><span class="co">#setwd(&quot;S:/comola/models/SWAT&quot;)</span></span>
<span id="cb648-2"><a href="optimization.html#cb648-2" tabindex="-1"></a><span class="co">#sink(&quot;S:/comola/models/SWAT/console.txt&quot;, append=FALSE)</span></span>
<span id="cb648-3"><a href="optimization.html#cb648-3" tabindex="-1"></a>SWAT_PATH <span class="ot">=</span> <span class="st">&quot;C:/Users/mosh/Documents/GIT/swat-cs10/model_data/comola/CoMOLA_SWATplus/models/SWAT&quot;</span></span>
<span id="cb648-4"><a href="optimization.html#cb648-4" tabindex="-1"></a><span class="fu">setwd</span>(SWAT_PATH)</span>
<span id="cb648-5"><a href="optimization.html#cb648-5" tabindex="-1"></a><span class="fu">sink</span>(<span class="fu">paste0</span>(SWAT_PATH, <span class="st">&quot;/console.txt&quot;</span>), <span class="at">append=</span><span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<div id="grain-units" class="section level4 hasAnchor" number="22.4.2.3">
<h4><span class="header-section-number">22.4.2.3</span> <strong>Grain Units:</strong><a href="optimization.html#grain-units" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Updating grain units to match our use-case. Read more about these in <a href="climate-scenarios.html#processing-results">17.4</a>.</p>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb649-1"><a href="optimization.html#cb649-1" tabindex="-1"></a><span class="co"># grain_units &lt;- data.frame(&#39;wbar&#39; = 1.163, </span></span>
<span id="cb649-2"><a href="optimization.html#cb649-2" tabindex="-1"></a><span class="co">#                           &#39;csil&#39; = 1.071, </span></span>
<span id="cb649-3"><a href="optimization.html#cb649-3" tabindex="-1"></a><span class="co">#                           &#39;wwht&#39; = 1.209, </span></span>
<span id="cb649-4"><a href="optimization.html#cb649-4" tabindex="-1"></a><span class="co">#                           &#39;wira&#39; = 1.429,</span></span>
<span id="cb649-5"><a href="optimization.html#cb649-5" tabindex="-1"></a><span class="co">#                           &#39;barl&#39; = 1.163,</span></span>
<span id="cb649-6"><a href="optimization.html#cb649-6" tabindex="-1"></a><span class="co">#                           &#39;akgs&#39; = 0.682, </span></span>
<span id="cb649-7"><a href="optimization.html#cb649-7" tabindex="-1"></a><span class="co">#                           &#39;wiry&#39; = 1.174, </span></span>
<span id="cb649-8"><a href="optimization.html#cb649-8" tabindex="-1"></a><span class="co">#                           &#39;sgbt&#39; = 1)</span></span>
<span id="cb649-9"><a href="optimization.html#cb649-9" tabindex="-1"></a></span>
<span id="cb649-10"><a href="optimization.html#cb649-10" tabindex="-1"></a>grain_units <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb649-11"><a href="optimization.html#cb649-11" tabindex="-1"></a>  <span class="st">&#39;wwht&#39;</span> <span class="ot">=</span> <span class="fl">1.209</span>,</span>
<span id="cb649-12"><a href="optimization.html#cb649-12" tabindex="-1"></a>  <span class="st">&#39;barl&#39;</span> <span class="ot">=</span> <span class="fl">1.163</span>,</span>
<span id="cb649-13"><a href="optimization.html#cb649-13" tabindex="-1"></a>  <span class="st">&quot;oats&quot;</span> <span class="ot">=</span> .<span class="dv">84</span>,</span>
<span id="cb649-14"><a href="optimization.html#cb649-14" tabindex="-1"></a>  <span class="st">&quot;swht&quot;</span> <span class="ot">=</span> <span class="fl">1.04</span>,</span>
<span id="cb649-15"><a href="optimization.html#cb649-15" tabindex="-1"></a>  <span class="st">&quot;pota&quot;</span> <span class="ot">=</span> .<span class="dv">22</span></span>
<span id="cb649-16"><a href="optimization.html#cb649-16" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>Objective Functions:</strong></p>
<div class="sourceCode" id="cb650"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb650-1"><a href="optimization.html#cb650-1" tabindex="-1"></a><span class="co"># total n load (kg/yr)</span></span>
<span id="cb650-2"><a href="optimization.html#cb650-2" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">ind_cha_aa</span>(txt_path, <span class="st">&#39;cha037&#39;</span>)[<span class="dv">2</span>] <span class="sc">*</span> <span class="sc">-</span><span class="dv">1</span> <span class="co">#loads should be minimized</span></span>
<span id="cb650-3"><a href="optimization.html#cb650-3" tabindex="-1"></a><span class="co"># min max ratio</span></span>
<span id="cb650-4"><a href="optimization.html#cb650-4" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">ind_cha_day</span>(txt_path, <span class="at">channel =</span> <span class="st">&quot;cha037&quot;</span>)[<span class="dv">11</span>] <span class="sc">*</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb650-5"><a href="optimization.html#cb650-5" tabindex="-1"></a><span class="co"># average annual sum of grain units in whole basin (be very careful with ind parameter)</span></span>
<span id="cb650-6"><a href="optimization.html#cb650-6" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">ind_bsn_aa_crp</span>(txt_path, <span class="at">crop_sel =</span> <span class="fu">names</span>(grain_units), <span class="at">ind =</span> <span class="st">&quot;grain_units&quot;</span>, <span class="at">grain_units =</span> grain_units)</span>
<span id="cb650-7"><a href="optimization.html#cb650-7" tabindex="-1"></a><span class="co"># frequency total N conc lower than threshold</span></span>
<span id="cb650-8"><a href="optimization.html#cb650-8" tabindex="-1"></a>fit4 <span class="ot">&lt;-</span> <span class="fu">ind_cha_day</span>(<span class="at">path =</span> txt_path, <span class="at">channel =</span> <span class="st">&#39;cha037&#39;</span>, <span class="at">ind =</span> <span class="st">&quot;Nconc_days&quot;</span>, <span class="at">threshold_N =</span> <span class="fl">0.775</span>)[<span class="dv">14</span>]</span></code></pre></div>
<p><strong>Updating Config.ini:</strong></p>
<p>We need to update the following:</p>
<ol style="list-style-type: decimal">
<li><code>file_path_r</code>, which can be found using the <code>R.home("bin")</code> command.</li>
<li><code>file_path_python</code> , which can be found using the <code>conda_python()</code> command</li>
<li><code>pop_size</code>, which control the amount of mutants in each generation.</li>
<li><code>max_generations</code> which controls the amount of repetitions the algorithm performs</li>
</ol>
<p>The total number of runs to do will be <code>pop_size</code> * <code>max_generations</code>. For optain, this will be 100x200?</p>
<div class="sourceCode" id="cb651"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb651-1"><a href="optimization.html#cb651-1" tabindex="-1"></a>r_path <span class="ot">=</span> <span class="fu">R.home</span>(<span class="st">&quot;bin&quot;</span>)</span>
<span id="cb651-2"><a href="optimization.html#cb651-2" tabindex="-1"></a>python_path <span class="ot">=</span> reticulate<span class="sc">::</span><span class="fu">conda_python</span>(<span class="st">&quot;comola&quot;</span>)</span>
<span id="cb651-3"><a href="optimization.html#cb651-3" tabindex="-1"></a>python_path <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">&quot;</span>, <span class="st">&quot;/&quot;</span>, python_path, <span class="at">fixed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb651-4"><a href="optimization.html#cb651-4" tabindex="-1"></a>pop_size <span class="ot">=</span> <span class="dv">64</span></span>
<span id="cb651-5"><a href="optimization.html#cb651-5" tabindex="-1"></a>max_generations <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb651-6"><a href="optimization.html#cb651-6" tabindex="-1"></a></span>
<span id="cb651-7"><a href="optimization.html#cb651-7" tabindex="-1"></a>config.ini <span class="ot">=</span> <span class="fu">readLines</span>(<span class="st">&quot;model_data/comola/CoMOLA_SWATplus/config.ini&quot;</span>)</span>
<span id="cb651-8"><a href="optimization.html#cb651-8" tabindex="-1"></a>config.ini[<span class="dv">66</span>] <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&quot;file_path_R = &quot;</span>,r_path,<span class="st">&quot;/R.exe&quot;</span>)</span>
<span id="cb651-9"><a href="optimization.html#cb651-9" tabindex="-1"></a>config.ini[<span class="dv">67</span>] <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&quot;file_path_Python = &quot;</span>,python_path,<span class="st">&quot;&quot;</span>)</span>
<span id="cb651-10"><a href="optimization.html#cb651-10" tabindex="-1"></a>config.ini[<span class="dv">81</span>] <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&quot;pop_size = &quot;</span>,pop_size,<span class="st">&quot; &quot;</span>)</span>
<span id="cb651-11"><a href="optimization.html#cb651-11" tabindex="-1"></a>config.ini[<span class="dv">82</span>] <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&quot;max_generations = &quot;</span>,max_generations,<span class="st">&quot;&quot;</span>)</span>
<span id="cb651-12"><a href="optimization.html#cb651-12" tabindex="-1"></a><span class="fu">writeLines</span>(config.ini,<span class="st">&quot;model_data/comola/CoMOLA_SWATplus/config.ini&quot;</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="running-comola" class="section level2 hasAnchor" number="22.5">
<h2><span class="header-section-number">22.5</span> Running CoMOLA<a href="optimization.html#running-comola" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now we are set to run CoMOLA, we do this by running the <code>run_comola.bat</code> file and entering the amount of cores we need.</p>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb652-1"><a href="optimization.html#cb652-1" tabindex="-1"></a><span class="co"># We do this outside of R. </span></span></code></pre></div>
</div>
<div id="results-visualization" class="section level2 hasAnchor" number="22.6">
<h2><span class="header-section-number">22.6</span> Results Visualization<a href="optimization.html#results-visualization" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can use code provided by Micha to visualize the output of our optimization. We need to adjust the following variables:</p>
<div class="sourceCode" id="cb653"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb653-1"><a href="optimization.html#cb653-1" tabindex="-1"></a><span class="do">## Define path to your CoMOLA output folder</span></span>
<span id="cb653-2"><a href="optimization.html#cb653-2" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="st">&#39;model_data/comola/CoMOLA_SWATplus/output&#39;</span></span>
<span id="cb653-3"><a href="optimization.html#cb653-3" tabindex="-1"></a></span>
<span id="cb653-4"><a href="optimization.html#cb653-4" tabindex="-1"></a><span class="do">## Define names of objectives (fit1, fit2, etc. must correspond with your </span></span>
<span id="cb653-5"><a href="optimization.html#cb653-5" tabindex="-1"></a><span class="do">## specifications in models/SWAT.R)</span></span>
<span id="cb653-6"><a href="optimization.html#cb653-6" tabindex="-1"></a><span class="do">## Think about including a line break (\n) for long names when indicator should be displayed as color or point size</span></span>
<span id="cb653-7"><a href="optimization.html#cb653-7" tabindex="-1"></a></span>
<span id="cb653-8"><a href="optimization.html#cb653-8" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="st">&quot;total n load &quot;</span></span>
<span id="cb653-9"><a href="optimization.html#cb653-9" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="st">&#39;minmaxratio&#39;</span></span>
<span id="cb653-10"><a href="optimization.html#cb653-10" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="st">&quot;yield&quot;</span></span>
<span id="cb653-11"><a href="optimization.html#cb653-11" tabindex="-1"></a>fit4 <span class="ot">&lt;-</span> <span class="st">&quot;n conc thres&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb654"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb654-1"><a href="optimization.html#cb654-1" tabindex="-1"></a><span class="do">## Execute the code below (do not modify) (oopsie)</span></span>
<span id="cb654-2"><a href="optimization.html#cb654-2" tabindex="-1"></a></span>
<span id="cb654-3"><a href="optimization.html#cb654-3" tabindex="-1"></a><span class="co"># get functions</span></span>
<span id="cb654-4"><a href="optimization.html#cb654-4" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;model_data/comola/CoMOLA_SWATplus/output_analysis/functions_postprocessing.R&#39;</span>)</span>
<span id="cb654-5"><a href="optimization.html#cb654-5" tabindex="-1"></a></span>
<span id="cb654-6"><a href="optimization.html#cb654-6" tabindex="-1"></a><span class="fu">foo1</span>(<span class="fu">c</span>(<span class="st">&#39;mco&#39;</span>, <span class="st">&#39;dplyr&#39;</span>, <span class="st">&#39;tidyverse&#39;</span>, <span class="st">&#39;ggplot2&#39;</span>, <span class="st">&#39;viridis&#39;</span>))</span></code></pre></div>
<pre><code>## Loading required package: mco</code></pre>
<pre><code>## Loading required package: viridis</code></pre>
<pre><code>## Loading required package: viridisLite</code></pre>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb658-1"><a href="optimization.html#cb658-1" tabindex="-1"></a><span class="do">## extract pareto results</span></span>
<span id="cb658-2"><a href="optimization.html#cb658-2" tabindex="-1"></a>pareto <span class="ot">&lt;-</span> <span class="fu">get_pareto</span>(path)</span>
<span id="cb658-3"><a href="optimization.html#cb658-3" tabindex="-1"></a></span>
<span id="cb658-4"><a href="optimization.html#cb658-4" tabindex="-1"></a><span class="do">## write status quo fitness values</span></span>
<span id="cb658-5"><a href="optimization.html#cb658-5" tabindex="-1"></a><span class="fu">write_sq</span>(path)</span>
<span id="cb658-6"><a href="optimization.html#cb658-6" tabindex="-1"></a></span>
<span id="cb658-7"><a href="optimization.html#cb658-7" tabindex="-1"></a><span class="do">## calculate hypervolume development</span></span>
<span id="cb658-8"><a href="optimization.html#cb658-8" tabindex="-1"></a>HV <span class="ot">&lt;-</span> <span class="fu">hv_generations</span>(path)</span>
<span id="cb658-9"><a href="optimization.html#cb658-9" tabindex="-1"></a></span>
<span id="cb658-10"><a href="optimization.html#cb658-10" tabindex="-1"></a><span class="do">## plot hypervolumes for each generation</span></span>
<span id="cb658-11"><a href="optimization.html#cb658-11" tabindex="-1"></a>hv_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(HV, <span class="fu">aes</span>(Generation, HV)) <span class="sc">+</span></span>
<span id="cb658-12"><a href="optimization.html#cb658-12" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb658-13"><a href="optimization.html#cb658-13" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb658-14"><a href="optimization.html#cb658-14" tabindex="-1"></a></span>
<span id="cb658-15"><a href="optimization.html#cb658-15" tabindex="-1"></a><span class="do">## plot Pareto solutions</span></span>
<span id="cb658-16"><a href="optimization.html#cb658-16" tabindex="-1"></a><span class="co"># plot_2D(mode=1)</span></span>
<span id="cb658-17"><a href="optimization.html#cb658-17" tabindex="-1"></a></span>
<span id="cb658-18"><a href="optimization.html#cb658-18" tabindex="-1"></a>sol <span class="ot">&lt;-</span> pareto<span class="sc">$</span>fitness</span>
<span id="cb658-19"><a href="optimization.html#cb658-19" tabindex="-1"></a><span class="fu">names</span>(sol) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;n_load&quot;</span>, <span class="st">&quot;sw_content&quot;</span>, <span class="st">&quot;yield&quot;</span>, <span class="st">&quot;n_thres&quot;</span>)</span>
<span id="cb658-20"><a href="optimization.html#cb658-20" tabindex="-1"></a>opt_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sol, <span class="fu">aes</span>(<span class="at">x =</span> yield, <span class="at">y =</span> sw_content)) <span class="sc">+</span></span>
<span id="cb658-21"><a href="optimization.html#cb658-21" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> <span class="fu">abs</span>(n_load), <span class="at">fill =</span> n_thres),</span>
<span id="cb658-22"><a href="optimization.html#cb658-22" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb658-23"><a href="optimization.html#cb658-23" tabindex="-1"></a>             <span class="at">col =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb658-24"><a href="optimization.html#cb658-24" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">viridis</span>(<span class="fu">length</span>(sol))) <span class="sc">+</span></span>
<span id="cb658-25"><a href="optimization.html#cb658-25" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> fit1, <span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">&quot;black&quot;</span>)),</span>
<span id="cb658-26"><a href="optimization.html#cb658-26" tabindex="-1"></a>         <span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> fit4)) <span class="sc">+</span></span>
<span id="cb658-27"><a href="optimization.html#cb658-27" tabindex="-1"></a>  <span class="fu">xlab</span>(fit3) <span class="sc">+</span></span>
<span id="cb658-28"><a href="optimization.html#cb658-28" tabindex="-1"></a>  <span class="fu">ylab</span>(fit2)</span>
<span id="cb658-29"><a href="optimization.html#cb658-29" tabindex="-1"></a></span>
<span id="cb658-30"><a href="optimization.html#cb658-30" tabindex="-1"></a><span class="fu">print</span>(opt_plot)</span></code></pre></div>
<p><img src="_main_files/figure-html/opt17_optplot-1.png" width="672" /></p>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb659-1"><a href="optimization.html#cb659-1" tabindex="-1"></a><span class="fu">print</span>(hv_plot)</span></code></pre></div>
<p><img src="_main_files/figure-html/opt17_optplot-2.png" width="672" /></p>
<div class="sourceCode" id="cb660"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb660-1"><a href="optimization.html#cb660-1" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">&quot;model_data/results/opt_plot.png&quot;</span>, <span class="at">plot =</span> opt_plot)</span></code></pre></div>
<pre><code>## Saving 7 x 5 in image</code></pre>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb662-1"><a href="optimization.html#cb662-1" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">&quot;model_data/results/hv_plot.png&quot;</span>, <span class="at">plot =</span> hv_plot)</span></code></pre></div>
<pre><code>## Saving 7 x 5 in image</code></pre>
<div id="references" class="section level3 unumbered hasAnchor" number="22.6.1">
<h3><span class="header-section-number">22.6.1</span> References<a href="optimization.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Deb, K., Pratap, A., Agarwal, S., &amp; Meyarivan, T. A. M. T. (2002). A fast and elitist multiobjective genetic algorithm: NSGA-II. <em>IEEE transactions on evolutionary computation</em>, <em>6</em>(2), 182-197.</p>
<p>Strauch, M., Cord, A. F., Pätzold, C., Lautenbach, S., Kaim, A., Schweitzer, C., … &amp; Volk, M. (2019). Constraints in multi-objective optimization of land use allocation–Repair or penalize?. <em>Environmental Modelling &amp; Software</em>, <em>118</em>, 241-251.</p>

</div>
</div>
</div>
<h3>References<a href="references-1.html#references-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-strauch_2024_11473793" class="csl-entry">
Strauch, Michael, and Christoph Schürz. 2024. <span>“<span class="nocase">Common optimisation protocol. Deliverable D5.1 of the EU Horizon 2020 project OPTAIN.</span>”</span> Zenodo. <a href="https://doi.org/10.5281/zenodo.11473793">https://doi.org/10.5281/zenodo.11473793</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="measure-classification.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="land-object-input-abandoned.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://gitlab.nibio.no/moritzshore/swat-cs10/-/edit/main/17-Optimization.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://gitlab.nibio.no/moritzshore/swat-cs10/blob/main/17-Optimization.Rmd",
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
